edition: 1.0.0
name: agentcraft
services:
  aigc-admin-py:
    component: fc
    props:
      region: '{{region}}'
      service:
        logConfig: auto
        nasConfig: auto
        description: chat service middleware
        internetAccess: true
        name: '{{serviceName}}'
      function:
        handler: index.handler
        description: admin service middleware
        timeout: 7200
        caPort: 8000
        layers:
          - acs:fc:cn-hangzhou:1431999136518149:layers/NLP-Python310/versions/1
          - acs:fc:cn-hangzhou:1431999136518149:layers/FastAPI-Python310/versions/6
        customRuntimeConfig:
          command:
            - python3
            - '-u'
            - app/main.py
        instanceType: c1
        runtime: custom.debian10
        instanceConcurrency: 10
        cpu: 8
        memorySize: 16384
        diskSize: 10240
        environmentVariables:
          PATH: >-
            /var/fc/lang/python3.10/bin::/usr/local/bin/apache-maven/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/ruby/bin:/opt/bin:/code:/code/bin
          PYTHONPATH: /opt/python:/code
          # AK: ${env.AK}
          # SK: ${env.SK}
          POSTGRES_USER: '{{POSTGRES_USER}}'
          # REDIS_HOST: '{{REDIS_HOST}}'
          EMBEDDING_TIMEOUT: '600'
          POSTGRES_HOST: '{{POSTGRES_HOST}}'
          WORKERS: '1'
          POSTGRES_DATABASE: '{{POSTGRES_DATABASE}}'
          POSTGRES_PASSWORD: '{{POSTGRES_PASSWORD}}'
          EMBEDDING_TOKEN: ''
          CREATE_TABLES: '1' # 是否建表
          EMBEDDING_URL: >-  # embedding 服务地址
            '{{EMBEDDING_URL}}' 
          EMBEDDING_DIM: '{{EMBEDDING_DIM}}' # 向量维度
          JWT_SECRET: {{JWT_SECRET}}
          # REDIS_PASSWORD: {{REDIS_PASSWORD}}
          # REDIS_USER: {{REDIS_USER}}
          # USE_GREEN_CLIENT: 1
        name: agentcraft
        asyncConfiguration: {}
        codeUri: '.'
      triggers:
        - name: httpTrigger
          description: ''
          type: http
          config:
            methods:
              - GET
              - POST
              - PUT
              - DELETE
              - HEAD
              - OPTIONS
            authType: anonymous
            disableURLInternet: false
      customDomains:
        - domainName: auto
          protocol: HTTP
          routeConfigs:
            - path: /*
