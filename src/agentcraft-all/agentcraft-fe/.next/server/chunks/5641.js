"use strict";exports.id=5641,exports.ids=[5641],exports.modules={7109:(t,e,n)=>{n.d(e,{ZP:()=>s});let r={Error:{Unauthorized:"无权限"}},o={cn:r},a=Object.keys(o),i=o[function(){let t=function(t){try{return localStorage.getItem(t)}catch{return null}}("lang");if(a.includes(t??""))return t;let e=function(){try{return navigator.language.toLowerCase()}catch{return"cn"}}();for(let t of a)if(e.includes(t))return t;return"cn"}()];!function merge(t,e){Object.keys(e).forEach(function(n){if(e[n]&&"object"==typeof e[n]){merge(t[n]=t[n]||{},e[n]);return}t[n]=e[n]})}(r,i);let s=r},5641:(t,e,n)=>{n.a(t,async(t,r)=>{try{n.d(e,{Ag:()=>getChatList,aK:()=>d,dr:()=>chatStream});var o=n(4827),a=n(7109),i=n(9890),s=n(6105),c=n(3062),l=n(3602),u=n(2393),h=t([o,i,l,u]);[o,i,l,u]=h.then?(await h)():h;let d=(0,i.create)()((0,l.devtools)(t=>({chatList:[],open:!1,loading:!1,isEdit:!1,currentChatItem:{},updateCurrentChatItem:e=>t(t=>({currentChatItem:e})),setEditStatus:e=>t(t=>({isEdit:e})),setLoading:e=>t(t=>({loading:e})),setOpen:e=>t(t=>({open:e})),updateChatList:e=>t(t=>({chatList:e}))})));async function getChatList(t){let e=d.getState(),n=e.updateChatList,r=await (0,u.W)(`/api/chat/chatlist?id=${t}`),o=r.data;o&&n(o)}function chatStream(t,e){let n=new AbortController;t.onController?.(n);let r={method:"POST",headers:{"Content-Type":"application/json"},signal:n.signal,body:JSON.stringify(Object.assign({stream:!0},t,{token:e}))},i=setTimeout(()=>n.abort(),s.tb),l="",u=!1,finish=()=>{u||(t.onFinish(l),u=!0)};n.signal.onabort=finish,(0,o.fetchEventSource)("/api/chat",{...r,async onopen(t){clearTimeout(i);let e=t.headers.get("content-type");if(console.log("AgentCraft request response content type: ",e),e?.startsWith("text/plain"))return l=await t.clone().text(),finish();if(!t.ok||!t.headers.get("content-type")?.startsWith("application/octet-stream")||200!==t.status){let e=[l],n=await t.clone().text();try{let e=await t.clone().json();n=(0,c.Bs)(e)}catch(t){console.log(t)}return 401===t.status&&e.push(a.ZP.Error.Unauthorized),n&&e.push(n),l=e.join("\n\n"),finish()}},onmessage(e){if("[DONE]"===e.data||u)return finish();let n=e.data;try{let e=JSON.parse(n),r=e.choices[0].delta.content;r&&(l+=r,t.onUpdate?.(l,r))}catch(t){console.error("[Request] parse error",n,e)}},onclose(){finish()},onerror(e){throw t.onError?.(e),e},openWhenHidden:!0})}r()}catch(t){r(t)}})},3062:(t,e,n)=>{function unicodeDecode(t){let e=t;try{e=JSON.parse(t)}catch(t){console.error("Invalid URI sequence",t)}return e}function prettyObject(t){let e=t;return("string"!=typeof t&&(t=JSON.stringify(t,null,"  ")),"{}"===t)?e.toString():t.startsWith("```json")?t:["```json",t,"```"].join("\n")}n.d(e,{Bs:()=>prettyObject,pI:()=>unicodeDecode})}};