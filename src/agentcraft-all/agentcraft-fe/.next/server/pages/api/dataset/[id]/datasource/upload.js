"use strict";(()=>{var e={};e.id=7671,e.ids=[7671],e.modules={1738:e=>{e.exports=require("multer")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7284:e=>{e.exports=require("pdfjs-dist")},9648:e=>{e.exports=import("axios")},9170:e=>{e.exports=import("langchain/text_splitter")},5616:e=>{e.exports=import("next-connect")},1017:e=>{e.exports=require("path")},8471:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>c,routeModule:()=>p});var s=a(1802),o=a(7153),i=a(6249),n=a(3909),l=e([n]);n=(l.then?(await l)():l)[0];let c=(0,i.l)(n,"default"),u=(0,i.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/dataset/[id]/datasource/upload",pathname:"/api/dataset/[id]/datasource/upload",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},3909:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>g});var s=a(5616),o=a(1738),i=a.n(o),n=a(1017),l=a(7284),c=a(9170),u=a(15),p=e([s,c,u]);[s,c,u]=p.then?(await p)():p;let d={api:{bodyParser:!1}},m=i()({storage:i().memoryStorage()}),f=(0,s.createRouter)();f.use(m.single("file")),f.post(async(e,t)=>{var a;let r=e.query.id,s=e.file,o=e.body,i=(a=s.originalname,(0,n.extname)(a)),p=parseInt(o.chunk_size);u.Z.defaults.headers.common.Authorization=e.headers.authorization;let d=[];if(".txt"===i){let e=new c.CharacterTextSplitter({chunkSize:p,chunkOverlap:100});d=await e.createDocuments([s.buffer.toString()])}if(".md"===i){let e=c.RecursiveCharacterTextSplitter.fromLanguage("markdown",{chunkSize:p,chunkOverlap:100});d=await e.createDocuments([s.buffer.toString()])}if(".html"===i){let e=c.RecursiveCharacterTextSplitter.fromLanguage("html",{chunkSize:p,chunkOverlap:100});d=await e.createDocuments([s.buffer.toString()])}if(".pdf"===i){let e=l.getDocument(new Uint8Array(s.buffer)),t=await e.promise,a="",r=t._pdfInfo.numPages;for(let e=1;e<=r;e++){let r=await t.getPage(e),s=await r.getTextContent();a+=s.items.map(e=>e.str).join("")}let o=new c.CharacterTextSplitter({chunkSize:p,chunkOverlap:0,keepSeparator:!1,separator:""});d=await o.createDocuments([a.trim()])}for(let e of d){let t=e.pageContent,a={title:o.title,url:o.url,tag:r,ext:i.replace(".",""),content:t,chunk_size:p};await u.Z.post("/document/add",a)}t.json({status:"success"})});let g=f.handler({onError:(e,t,a)=>{console.error(e.stack),a.status(e.statusCode||500).end(e.message)}});r()}catch(e){r(e)}})},15:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>n});var s=a(9648),o=e([s]);s=(o.then?(await o)():o)[0];let i=s.default.create({baseURL:process.env.baseUrl||"",headers:{"Content-Type":"application/json"}});i.interceptors.response.use(e=>Promise.resolve(e),e=>{if(e?.response?.status){console.log("from backend server:",e);let{status:t,data:a}=e.response;return Promise.resolve({status:t,data:{code:t,message:a.detail}})}});let n=i;r()}catch(e){r(e)}})}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(8471));module.exports=a})();