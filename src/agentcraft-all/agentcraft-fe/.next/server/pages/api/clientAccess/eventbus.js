"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={8439:e=>{e.exports=require("@alicloud/eventbridge20200401")},8113:e=>{e.exports=require("@alicloud/fc-open20210406")},7416:e=>{e.exports=require("@alicloud/fc20230330")},3272:e=>{e.exports=require("@alicloud/openapi-client")},487:e=>{e.exports=require("@alicloud/ram20150501")},78:e=>{e.exports=require("@alicloud/serverless20210924")},319:e=>{e.exports=require("@alicloud/sts20150401")},2151:e=>{e.exports=require("@alicloud/tea-util")},2807:e=>{e.exports=require("@alicloud/vpc20160428")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5611:e=>{e.exports=import("nanoid")},905:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var r=a(1802),s=a(7153),c=a(6249),n=a(6945),o=e([n]);n=(o.then?(await o)():o)[0];let l=(0,c.l)(n,"default"),u=(0,c.l)(n,"config"),d=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/clientAccess/eventbus",pathname:"/api/clientAccess/eventbus",bundlePath:"",filename:""},userland:n});i()}catch(e){i(e)}})},6945:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{default:()=>handler});var r=a(8723),s=a(7354),c=e([r]);async function handler(e,t){let a;let{headers:i,body:c}=e,{region:n="cn-hangzhou",functionName:o,webhook:l,token:u}=c,d=i["x-fc-access-key-id"]||"",p=i["x-fc-access-key-secret"]||"",v=i["x-fc-security-token"],x=i["x-fc-account-id"]||process.env.FC_ACCOUNT_ID;d&&(a={accessKeyId:d,accessKeySecret:p,securityToken:v});let y=new r.G(a,x);try{await y.serverlessBridgeRam.attactRolePolicy({policyType:"System",policyName:"AliyunEventBridgeFullAccess",roleName:"AliyunFCDefaultRole"})}catch(e){}let f=await y.getEventBus(s.Iz);f&&!f?.body?.data?.eventBusName&&await y.createEventBus({EventBusName:s.Iz,Description:"【勿删】AGENTCRAFT桥接钉钉机器人服务"});let m=await y.creatEventRule({webhook:l,token:u,region:n,functionName:o,uid:x});await y.serverlessBridgeFcV3.putAsyncInvokeConfig(o,{destinationConfig:{onSuccess:{destination:`acs:eventbridge:${n}:${x}:eventbus/${s.Iz}`},onFailure:{destination:""}}}),t.status(200).json({Code:m?.body?.code})}r=(c.then?(await c)():c)[0],i()}catch(e){i(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,8723],()=>__webpack_exec__(905));module.exports=a})();