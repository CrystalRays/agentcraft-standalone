"use strict";(()=>{var e={};e.id=9470,e.ids=[9470,2888,660],e.modules={5727:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>_,default:()=>h,getServerSideProps:()=>u,getStaticPaths:()=>m,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>b,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>I,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>j});var i=s(7093),a=s(5244),l=s(1323),n=s(9209),o=s.n(n),d=s(5913),p=s(9713),c=e([d,p]);[d,p]=c.then?(await c)():c;let h=(0,l.l)(p,"default"),x=(0,l.l)(p,"getStaticProps"),m=(0,l.l)(p,"getStaticPaths"),u=(0,l.l)(p,"getServerSideProps"),_=(0,l.l)(p,"config"),g=(0,l.l)(p,"reportWebVitals"),j=(0,l.l)(p,"unstable_getStaticProps"),y=(0,l.l)(p,"unstable_getStaticPaths"),w=(0,l.l)(p,"unstable_getStaticParams"),f=(0,l.l)(p,"unstable_getServerProps"),I=(0,l.l)(p,"unstable_getServerSideProps"),b=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/app/[id]/knowledgeBase",pathname:"/app/[id]/knowledgeBase",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:p});r()}catch(e){r(e)}})},5194:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{JS:()=>KnowledgeBasePage});var i,a=s(997),l=s(6689),n=s(1664),o=s.n(n),d=s(2247),p=s(9445),c=s(1280),h=s(4888),x=s(1939),m=s(1494),u=s(5288),_=s(3962),g=s(2394),j=s(9235),y=s(6105),w=s(4222),f=s(918),I=s(5509),b=e([x,m,j,I]);function KnowledgeBaseForm({appId:e,containerType:t}){let s=(0,j.I1)().setOpen,r=(0,j.I1)().isEdit,i=(0,j.I1)().currentKnowledgeBase,n=(0,j.I1)().setLoading,o=(0,x.s6)().modelList,c=(0,m.s6)().dataSetList,u=(0,p.useForm)({initialValues:{name:"",description:"",prompt_template:y.Gf,app_id:parseInt(e),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:w.$$,exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"智能体名必填"}});(0,l.useEffect)(()=>{if((0,x.fZ)(),(0,m.ln)(),r){let e=i?.datasets;u.setValues({id:i?.id,name:i?.name,description:i?.description,prompt_template:i?.prompt_template,app_id:i?.app_id,exact_datasets:e?.filter(e=>e.dataset_type===_.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:e?.filter(e=>e.dataset_type===_.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:i?.exact_search_similarity,fuzzy_search_similarity:i?.fuzzy_search_similarity,temperature:i?.temperature,top_p:i?.top_p,n_sequences:i?.n_sequences,max_tokens:i?.max_tokens,stop:i?.stop,presence_penalty:i?.presence_penalty,frequency_penalty:i?.frequency_penalty,logit_bias:i?.logit_bias,model_id:i?.model_id,redis_ip_ex:i?.redis_ip_ex,redis_history_ex:i?.redis_history_ex,model_ip_limit:i?.model_ip_limit,llm_history_len:i?.llm_history_len,system_message:i?.system_message,exact_search_limit:i?.exact_search_limit,fuzzy_search_limit:i?.fuzzy_search_limit})}},[i]);let g=o.map(e=>({label:e.name_alias,value:e.id})),f=c.filter(e=>e.dataset_type==_.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),I=c.filter(e=>e.dataset_type==_.I.QUESTION).map(e=>({label:e.name,value:e.id})),b=2!==t?"25%":"33.33%";return(0,a.jsxs)(d.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,a.jsxs)(d.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",style:{alignItems:"stretch"},children:[2!==t?(0,a.jsxs)(d.Paper,{shadow:"xs",p:"md",withBorder:!0,style:{width:b},children:[a.jsx(d.Title,{order:5,size:"h5",children:"智能体信息"}),(0,a.jsxs)(d.Box,{pl:4,pr:4,children:[a.jsx(d.TextInput,{withAsterisk:!0,label:"名称",placeholder:"输入智能体名称",...u.getInputProps("name")}),a.jsx(d.Textarea,{label:"描述",placeholder:"输入应用描述",description:"请输入智能体的描述信息",...u.getInputProps("description"),minRows:22})]})]}):null,(0,a.jsxs)(d.Paper,{shadow:"xs",p:"md",withBorder:!0,style:{width:b},children:[a.jsx(d.Title,{order:5,size:"h5",children:"调试指令"}),(0,a.jsxs)(d.Box,{pl:4,pr:4,children:[a.jsx(d.Select,{data:w.Ti,description:"",defaultValue:w.$$,...u.getInputProps("system_message"),label:"指令示例",placeholder:"",onChange:e=>{u.setValues({system_message:e})}}),a.jsx(d.Textarea,{withAsterisk:!0,label:"系统提示词",placeholder:"输入系统提示词",...u.getInputProps("system_message"),minRows:22,description:"系统提示词可以作为对大语言模型的约束指令"})]})]}),(0,a.jsxs)(d.Paper,{shadow:"xs",p:"md",withBorder:!0,style:{width:b},children:[(0,a.jsxs)(d.Flex,{justify:"space-between",align:"center",children:[a.jsx(d.Title,{order:5,size:"h5",children:"LLM服务"}),a.jsx(h.Z,{cursor:"pointer",onClick:x.fZ})]}),a.jsx(d.Box,{pl:4,pr:4,mb:12,children:a.jsx(d.Select,{withAsterisk:!0,data:g,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...u.getInputProps("model_id")})}),a.jsx(d.Divider,{my:"sm"}),a.jsx(d.Title,{order:5,size:"h5",children:"LLM参数"}),(0,a.jsxs)(d.Box,{pl:4,pr:4,mt:4,children:[(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.TextInput,{withAsterisk:!0,label:"temperature",placeholder:"",...u.getInputProps("temperature")}),a.jsx(d.TextInput,{withAsterisk:!0,label:"top_p",placeholder:"",...u.getInputProps("top_p")})]}),(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.TextInput,{withAsterisk:!0,label:"n_sequences",placeholder:"",...u.getInputProps("n_sequences")}),a.jsx(d.TextInput,{withAsterisk:!0,label:"max_tokens",placeholder:"",...u.getInputProps("max_tokens")})]}),(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.TextInput,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...u.getInputProps("presence_penalty")}),a.jsx(d.TextInput,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...u.getInputProps("frequency_penalty")})]}),a.jsx(d.TextInput,{label:"logit_bias",placeholder:"",...u.getInputProps("logit_bias"),width:"50%"})]})]}),(0,a.jsxs)(d.Paper,{shadow:"xs",p:"md",withBorder:!0,style:{width:b},children:[(0,a.jsxs)(d.Flex,{justify:"space-between",align:"center",children:[a.jsx(d.Title,{order:5,size:"h5",children:"数据召回"}),a.jsx(h.Z,{cursor:"pointer",onClick:m.ln})]}),a.jsx(d.Box,{pl:4,pr:4,children:a.jsx(d.Textarea,{label:"召回提示词模板",placeholder:"",...u.getInputProps("prompt_template"),minRows:2!==t?6:8,description:"召回提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})}),a.jsx(d.Divider,{my:"sm"}),a.jsx(d.Title,{order:5,size:"h6",children:"召回数据集"}),a.jsx(d.Box,{pl:4,pr:4,children:(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.MultiSelect,{data:f,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...u.getInputProps("fuzzy_datasets")}),a.jsx(d.MultiSelect,{data:I,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...u.getInputProps("exact_datasets")})]})}),a.jsx(d.Divider,{my:"sm"}),a.jsx(d.Title,{order:5,size:"h6",children:"召回参数"}),(0,a.jsxs)(d.Box,{pl:4,pr:4,mt:4,children:[(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.TextInput,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...u.getInputProps("fuzzy_search_similarity")}),a.jsx(d.TextInput,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...u.getInputProps("exact_search_similarity")})]}),(0,a.jsxs)(d.Group,{grow:!0,children:[a.jsx(d.NumberInput,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...u.getInputProps("fuzzy_search_limit")}),a.jsx(d.NumberInput,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...u.getInputProps("exact_search_limit")})]})]})]})]}),a.jsx(d.Box,{pt:4,style:{textAlign:"center",width:"100%"},children:a.jsx(d.Button,{style:{width:"100%"},onClick:async()=>{if(u.validate(),u.isValid()){n(!0);let t=u.values;r?await (0,j.CH)(t.id,t):await (0,j.uA)(t),await (0,j.Co)(e),s(!1),n(!1)}},children:"确认"})})]})}function AddOrUpdate({appId:e}){let t=(0,j.I1)().open,s=(0,j.I1)().setOpen,r=(0,j.I1)().isEdit,i=(0,j.I1)().setEditStatus;return a.jsx(d.Modal,{opened:t,onClose:()=>{i(!1),s(!1)},title:r?"编辑智能体":"创建智能体",centered:!0,size:"90%",children:a.jsx(KnowledgeBaseForm,{appId:e})})}function ChatDrawer({appId:e}){let t=(0,j.I1)().chatDrawer,s=(0,j.I1)().setChatDrawer,[r,i]=(0,l.useState)(!0);return a.jsx(d.Drawer,{opened:t,onClose:()=>{s(!1)},title:(0,a.jsxs)("div",{children:[a.jsx(d.Text,{fz:"xl",children:"智能体调试"}),a.jsx(d.Text,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整智能体问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,a.jsxs)(d.Flex,{mih:50,direction:"row",children:[(0,a.jsxs)("div",{style:{flex:"none",width:"64%",overflow:"hidden",borderRight:"1px solid #eee",paddingRight:8,marginRight:12,display:r?"block":"none"},children:[a.jsx("div",{style:{marginBottom:12},children:a.jsx(d.Badge,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体参数设置"})}),a.jsx(KnowledgeBaseForm,{appId:e,containerType:2})]}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsxs)(d.Flex,{justify:"space-between",children:[a.jsx(d.Badge,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体问答"}),a.jsx(d.Switch,{label:r?"关闭智能体参数配置":"开启智能体参数配置",checked:r,onChange:e=>i(e.currentTarget.checked)})]}),a.jsx(I.Z,{})]})]})})}function List({appId:e}){let t=(0,j.I1)().knowledgeBaseList,s=(0,j.I1)().setLoading,r=(0,j.I1)().updateCurrentKnowledgeBase,i=(0,j.I1)().setEditStatus,n=(0,j.I1)().setOpen,p=(0,j.I1)().setChatDrawer,generateToken=async t=>{try{s(!0),await (0,j.g$)(t),await (0,j.Co)(e)}catch(e){console.log(e)}finally{s(!1)}},removeKnowledgeBase=t=>{let{id:r,name:i}=t,l=`确定删除 ${i}?`;c.modals.openConfirmModal({title:"删除知识智能体",centered:!0,children:a.jsx(d.Text,{size:"sm",children:a.jsx(d.Highlight,{highlight:i,children:l})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{s(!0),await (0,j.eV)(r),await (0,j.Co)(e),s(!1)}})},h=t.map(t=>(0,a.jsxs)("tr",{children:[a.jsx("td",{style:{width:20},children:t.id}),a.jsx("td",{style:{width:120},children:a.jsx(o(),{href:`/app/${e}/knowledgeBase/${t.id}/detail`,children:t.name})}),a.jsx("td",{style:{width:180},children:t.description}),a.jsx("td",{style:{width:200},children:t.system_message?a.jsx(f.Z,{value:t.system_message,content:a.jsx(d.Spoiler,{maxHeight:80,showLabel:"显示更多",hideLabel:"隐藏",children:t.system_message}),width:300}):null}),a.jsx("td",{style:{width:300},children:t.prompt_template?a.jsx(f.Z,{value:t.prompt_template,content:t.prompt_template,width:300}):null}),a.jsx("td",{children:t.token?a.jsx(f.Z,{value:t.token,content:t.token,truncate:!0,width:160}):a.jsx(d.Button,{color:"lime",size:"xs",compact:!0,onClick:()=>generateToken(t.id),children:"生成访问令牌"})}),a.jsx("td",{children:(0,u.o0)(t.created)}),(0,a.jsxs)("td",{style:{width:220},children:[t.token?a.jsx(d.Button,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{i(!0);let e=await (0,j.IV)(t.id);r(e),p(!0)},mr:4,children:"问答测试"}):a.jsx(d.Tooltip,{label:"需要成访问令牌才可以访问此能力",children:a.jsx(d.Button,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),a.jsx(d.Button,{variant:"filled",size:"xs",onClick:async()=>{i(!0);let e=await (0,j.IV)(t.id);r(e),n(!0)},mr:4,children:"编辑"}),a.jsx(d.Button,{variant:"filled",color:"red",size:"xs",onClick:()=>{removeKnowledgeBase(t)},children:"删除"})]})]},t.id)),getKonwledgeBase=async()=>{s(!0);try{await (0,j.Co)(e)}catch(e){console.log(e)}s(!1)};return(0,l.useEffect)(()=>{getKonwledgeBase()},[e]),(0,a.jsxs)(a.Fragment,{children:[a.jsx(ChatDrawer,{appId:e}),(0,a.jsxs)(d.Table,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"编号"}),a.jsx("th",{children:"名称"}),a.jsx("th",{children:"描述"}),a.jsx("th",{children:"系统提示词"}),a.jsx("th",{children:"完整提示词"}),a.jsx("th",{children:"访问token"}),a.jsx("th",{children:"创建时间"}),a.jsx("th",{children:"操作"})]})}),a.jsx("tbody",{children:h})]})]})}function KnowledgeBasePage({appId:e}){let t=(0,j.I1)().loading,s=[{title:"应用列表",href:"/app"},{title:"智能体",href:`/app/${e}/knowledgeBase`}].map((e,t)=>a.jsx(d.Anchor,{href:e.href,children:e.title},t)),r=(0,j.I1)().setOpen,i=(0,j.I1)().setEditStatus;return(0,a.jsxs)("div",{style:{position:"relative"},children:[a.jsx(d.LoadingOverlay,{visible:t,overlayOpacity:.3}),a.jsx(d.Breadcrumbs,{children:s}),a.jsx(g.Z,{title:"领域知识智能体",description:"领域知识智能体专注于传授知识，利用LLM对自然语言进行认知，结合RAG(Retrieval-Augmented Generation 检索增强生成)技术来将领域的信息进行有效的整合，然后通过图片，视频，可交互组件完成知识交付，"}),a.jsx(d.Box,{children:a.jsx(d.Button,{onClick:()=>{i(!1),r(!0)},children:"新建领域知识智能体"})}),a.jsx(AddOrUpdate,{appId:e}),a.jsx(List,{appId:e})]})}[x,m,j,I]=b.then?(await b)():b,function(e){e[e.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",e[e.CHAT=2]="CHAT"}(i||(i={})),r()}catch(e){r(e)}})},9713:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>IndexPage,getServerSideProps:()=>getServerSideProps});var i=s(997),a=s(5194),l=e([a]);function getServerSideProps(e){let{params:t}=e,s=t.id;return{props:{appId:s}}}function IndexPage({appId:e}){return i.jsx(a.JS,{appId:e})}a=(l.then?(await l)():l)[0],r()}catch(e){r(e)}})},2247:e=>{e.exports=require("@mantine/core")},9445:e=>{e.exports=require("@mantine/form")},32:e=>{e.exports=require("@mantine/hooks")},1280:e=>{e.exports=require("@mantine/modals")},914:e=>{e.exports=require("@mantine/notifications")},6722:e=>{e.exports=require("@mdx-js/runtime")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},580:e=>{e.exports=require("prop-types")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},727:e=>{e.exports=require("react-syntax-highlighter")},4794:e=>{e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},997:e=>{e.exports=require("react/jsx-runtime")},4827:e=>{e.exports=import("@fortaine/fetch-event-source")},3536:e=>{e.exports=import("@mdx-js/mdx")},7834:e=>{e.exports=import("@mdx-js/react")},5611:e=>{e.exports=import("nanoid")},3135:e=>{e.exports=import("react-markdown")},4921:e=>{e.exports=import("rehype-highlight")},9521:e=>{e.exports=import("rehype-katex")},1871:e=>{e.exports=import("rehype-raw")},7984:e=>{e.exports=import("remark-breaks")},6809:e=>{e.exports=import("remark-gfm")},9832:e=>{e.exports=import("remark-math")},9890:e=>{e.exports=import("zustand")},3602:e=>{e.exports=import("zustand/middleware")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[2761,5464,9209,8450,1664,5948,5913,2394,918,9235,1939,249,5641,107],()=>__webpack_exec__(5727));module.exports=s})();