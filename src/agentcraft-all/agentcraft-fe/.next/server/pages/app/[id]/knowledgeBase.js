"use strict";(()=>{var e={};e.id=9470,e.ids=[9470,2888,660],e.modules={5727:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>_,default:()=>x,getServerSideProps:()=>u,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>j,routeModule:()=>v,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>g});var i=r(7093),a=r(5244),l=r(1323),n=r(9209),d=r.n(n),o=r(5913),p=r(9713),c=e([o,p]);[o,p]=c.then?(await c)():c;let x=(0,l.l)(p,"default"),h=(0,l.l)(p,"getStaticProps"),m=(0,l.l)(p,"getStaticPaths"),u=(0,l.l)(p,"getServerSideProps"),_=(0,l.l)(p,"config"),j=(0,l.l)(p,"reportWebVitals"),g=(0,l.l)(p,"unstable_getStaticProps"),y=(0,l.l)(p,"unstable_getStaticPaths"),w=(0,l.l)(p,"unstable_getStaticParams"),f=(0,l.l)(p,"unstable_getServerProps"),b=(0,l.l)(p,"unstable_getServerSideProps"),v=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/app/[id]/knowledgeBase",pathname:"/app/[id]/knowledgeBase",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:p});s()}catch(e){s(e)}})},5194:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{JS:()=>KnowledgeBasePage});var i,a=r(997),l=r(6689),n=r(1664),d=r.n(n),o=r(2247),p=r(9445),c=r(1939),x=r(1494),h=r(5288),m=r(3962),u=r(2394),_=r(9235),j=r(6105),g=r(918),y=r(5509),w=e([c,x,_,y]);function KnowledgeBaseForm({appId:e,containerType:t}){let r=(0,_.s6)().setOpen,s=(0,_.s6)().isEdit,i=(0,_.s6)().currentKnowledgeBase,n=(0,_.s6)().setLoading,d=(0,c.s6)().modelList,h=(0,x.s6)().dataSetList,u=(0,p.useForm)({initialValues:{name:"",description:"",prompt_template:j.Gf,app_id:parseInt(e),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:j.cl,exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"知识库名必填"}});(0,l.useEffect)(()=>{if((0,c.fZ)(),(0,x.ln)(),s){let e=i?.datasets;u.setValues({id:i?.id,name:i?.name,description:i?.description,prompt_template:i?.prompt_template,app_id:i?.app_id,exact_datasets:e?.filter(e=>e.dataset_type===m.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:e?.filter(e=>e.dataset_type===m.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:i?.exact_search_limit,fuzzy_search_similarity:i?.fuzzy_search_similarity,temperature:i?.temperature,top_p:i?.top_p,n_sequences:i?.n_sequences,max_tokens:i?.max_tokens,stop:i?.stop,presence_penalty:i?.presence_penalty,frequency_penalty:i?.frequency_penalty,logit_bias:i?.logit_bias,model_id:i?.model_id,redis_ip_ex:i?.redis_ip_ex,redis_history_ex:i?.redis_history_ex,model_ip_limit:i?.model_ip_limit,llm_history_len:i?.llm_history_len,system_message:i?.system_message,exact_search_limit:i?.exact_search_limit,fuzzy_search_limit:i?.fuzzy_search_limit})}},[i]);let g=d.map(e=>({label:e.name_alias,value:e.id})),y=h.filter(e=>e.dataset_type==m.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),w=h.filter(e=>e.dataset_type==m.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,a.jsxs)(o.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,a.jsxs)(o.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[(0,a.jsxs)("div",{style:{width:"50%"},children:[2!==t?a.jsx(o.Title,{order:4,mb:8,children:"基础设置"}):null,(0,a.jsxs)(o.Paper,{shadow:"xs",p:"md",withBorder:!0,children:[2!==t?(0,a.jsxs)(a.Fragment,{children:[a.jsx(o.Title,{order:5,size:"h5",children:"知识库"}),(0,a.jsxs)(o.Box,{maw:j.cy,pl:4,pr:4,children:[a.jsx(o.TextInput,{withAsterisk:!0,label:"名称",placeholder:"输入知识库名称",...u.getInputProps("name")}),a.jsx(o.Textarea,{label:"描述",placeholder:"输入应用描述",...u.getInputProps("description")})]}),a.jsx(o.Divider,{my:"sm"})]}):null,a.jsx(o.Title,{order:5,size:"h5",children:"提示词"}),(0,a.jsxs)(o.Box,{maw:j.cy,pl:4,pr:4,children:[a.jsx(o.Textarea,{label:"系统提示词",placeholder:"输入系统提示词",...u.getInputProps("system_message"),description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),a.jsx(o.Textarea,{label:"提示词模板",placeholder:"",...u.getInputProps("prompt_template"),minRows:6,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),a.jsx(o.Divider,{my:"sm"}),a.jsx(o.Title,{order:5,size:"h5",children:"数据集"}),a.jsx(o.Box,{maw:j.cy,pl:4,pr:4,children:(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.MultiSelect,{data:y,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...u.getInputProps("fuzzy_datasets")}),a.jsx(o.MultiSelect,{data:w,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...u.getInputProps("exact_datasets")})]})}),a.jsx(o.Divider,{my:"sm"}),a.jsx(o.Title,{order:5,size:"h5",children:"基础模型"}),a.jsx(o.Box,{maw:j.cy,pl:4,pr:4,mb:12,children:a.jsx(o.Select,{withAsterisk:!0,data:g,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...u.getInputProps("model_id")})}),a.jsx(o.Divider,{my:"sm"})]})]}),(0,a.jsxs)("div",{style:{width:"50%"},children:[2!==t?a.jsx(o.Title,{order:4,mb:8,children:"高级设置"}):null,(0,a.jsxs)(o.Paper,{shadow:"xs",p:"md",withBorder:!0,children:[a.jsx(o.Title,{order:5,size:"h5",children:"答案召回"}),(0,a.jsxs)(o.Box,{maw:j.cy,pl:4,pr:4,children:[(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.TextInput,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...u.getInputProps("fuzzy_search_similarity")}),a.jsx(o.TextInput,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...u.getInputProps("exact_search_similarity")})]}),(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.NumberInput,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...u.getInputProps("fuzzy_search_limit")}),a.jsx(o.NumberInput,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...u.getInputProps("exact_search_limit")})]})]}),a.jsx(o.Divider,{my:"sm"}),a.jsx(o.Title,{order:5,size:"h5",children:"大语言模型参数"}),(0,a.jsxs)(o.Box,{maw:j.cy,pl:4,pr:4,children:[(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.TextInput,{withAsterisk:!0,label:"temperature",placeholder:"",...u.getInputProps("temperature")}),a.jsx(o.TextInput,{withAsterisk:!0,label:"top_p",placeholder:"",...u.getInputProps("top_p")})]}),(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.TextInput,{withAsterisk:!0,label:"n_sequences",placeholder:"",...u.getInputProps("n_sequences")}),a.jsx(o.TextInput,{withAsterisk:!0,label:"max_tokens",placeholder:"",...u.getInputProps("max_tokens")})]}),(0,a.jsxs)(o.Group,{grow:!0,children:[a.jsx(o.TextInput,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...u.getInputProps("presence_penalty")}),a.jsx(o.TextInput,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...u.getInputProps("frequency_penalty")})]}),a.jsx(o.TextInput,{label:"logit_bias",placeholder:"",...u.getInputProps("logit_bias"),width:"50%"})]}),a.jsx(o.Divider,{my:"sm"})]})]})]}),a.jsx(o.Box,{maw:j.cy,pt:4,style:{textAlign:"center",width:"100%"},children:a.jsx(o.Button,{style:{width:"100%"},onClick:async()=>{if(u.validate(),u.isValid()){n(!0);let t=u.values;s?await (0,_.CH)(t.id,t):await (0,_.uA)(t),await (0,_.Co)(e),r(!1),n(!1)}},children:"确认"})})]})}function AddOrUpdate({appId:e}){let t=(0,_.s6)().open,r=(0,_.s6)().setOpen,s=(0,_.s6)().isEdit,i=(0,_.s6)().setEditStatus;return a.jsx(o.Modal,{opened:t,onClose:()=>{i(!1),r(!1)},title:s?"编辑知识库":"创建知识库",centered:!0,size:"55%",children:a.jsx(KnowledgeBaseForm,{appId:e})})}function ChatDrawer({appId:e}){let t=(0,_.s6)().chatDrawer,r=(0,_.s6)().setChatDrawer;return a.jsx(o.Drawer,{opened:t,onClose:()=>{r(!1)},title:(0,a.jsxs)("div",{children:[a.jsx(o.Text,{fz:"xl",children:"知识库调试"}),a.jsx(o.Text,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整知识库问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,a.jsxs)(o.Flex,{mih:50,direction:"row",children:[(0,a.jsxs)("div",{style:{width:"60%"},children:[a.jsx("div",{style:{marginBottom:12},children:a.jsx(o.Badge,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"知识库参数设置"})}),a.jsx(KnowledgeBaseForm,{appId:e,containerType:2})]}),(0,a.jsxs)("div",{style:{marginLeft:12,borderLeft:"1px solid #eee",paddingLeft:8,width:"40%"},children:[a.jsx("div",{children:a.jsx(o.Badge,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"知识库问答"})}),a.jsx(y.Z,{})]})]})})}function List({appId:e}){let t=(0,_.s6)().knowledgeBaseList,r=(0,_.s6)().setLoading,s=(0,_.s6)().updateCurrentKnowledgeBase,i=(0,_.s6)().setEditStatus,n=(0,_.s6)().setOpen,p=(0,_.s6)().setChatDrawer,generateToken=async t=>{try{r(!0),await (0,_.g$)(t),await (0,_.Co)(e)}catch(e){console.log(e)}finally{r(!1)}},c=t.map(t=>(0,a.jsxs)("tr",{children:[a.jsx("td",{style:{width:20},children:t.id}),a.jsx("td",{style:{width:100},children:a.jsx(d(),{href:`/app/${e}/knowledgeBase/${t.id}/detail`,children:t.name})}),a.jsx("td",{style:{width:100},children:t.description}),a.jsx("td",{style:{width:200},children:t.system_message}),a.jsx("td",{style:{width:300},children:a.jsx(g.Z,{value:t.prompt_template,content:t.prompt_template})}),a.jsx("td",{children:t.token?a.jsx(g.Z,{value:t.token,content:t.token,truncate:!0}):a.jsx(o.Button,{color:"lime",size:"xs",compact:!0,onClick:()=>generateToken(t.id),children:"生成访问令牌"})}),a.jsx("td",{children:(0,h.o0)(t.created)}),(0,a.jsxs)("td",{children:[t.token?a.jsx(o.Button,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{i(!0);let e=await (0,_.IV)(t.id);s(e),p(!0)},mr:4,children:"问答测试"}):a.jsx(o.Tooltip,{label:"需要成访问令牌才可以访问此能力",children:a.jsx(o.Button,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),a.jsx(o.Button,{variant:"filled",size:"xs",onClick:async()=>{i(!0);let e=await (0,_.IV)(t.id);s(e),n(!0)},mr:4,children:"编辑"}),a.jsx(o.Button,{variant:"filled",color:"red",size:"xs",onClick:()=>{},children:"删除"})]})]},t.id)),getKonwledgeBase=async()=>{r(!0);try{await (0,_.Co)(e)}catch(e){console.log(e)}r(!1)};return(0,l.useEffect)(()=>{getKonwledgeBase()},[e]),(0,a.jsxs)(a.Fragment,{children:[a.jsx(ChatDrawer,{appId:e}),(0,a.jsxs)(o.Table,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"编号"}),a.jsx("th",{children:"名称"}),a.jsx("th",{children:"描述"}),a.jsx("th",{children:"系统提示词"}),a.jsx("th",{children:"完整提示词"}),a.jsx("th",{children:"访问token"}),a.jsx("th",{children:"创建时间"}),a.jsx("th",{children:"操作"})]})}),a.jsx("tbody",{children:c})]})]})}function KnowledgeBasePage({appId:e}){let t=(0,_.s6)().loading,r=[{title:"应用列表",href:"/app"},{title:"知识库",href:`/app/${e}/knowledgeBase`}].map((e,t)=>a.jsx(o.Anchor,{href:e.href,children:e.title},t)),s=(0,_.s6)().setOpen;return(0,a.jsxs)("div",{style:{position:"relative"},children:[a.jsx(o.LoadingOverlay,{visible:t,overlayOpacity:.3}),a.jsx(o.Breadcrumbs,{children:r}),a.jsx(u.Z,{title:"知识库",description:"知识库使用RAG(Retrieval-Augmented Generation 检索增强生成)技术来将大语言模型跟数据进行结合，以实现更准确的预测"}),a.jsx(o.Box,{children:a.jsx(o.Button,{onClick:()=>s(!0),children:"新建知识库"})}),a.jsx(AddOrUpdate,{appId:e}),a.jsx(List,{appId:e})]})}[c,x,_,y]=w.then?(await w)():w,function(e){e[e.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",e[e.CHAT=2]="CHAT"}(i||(i={})),s()}catch(e){s(e)}})},9713:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>IndexPage,getServerSideProps:()=>getServerSideProps});var i=r(997),a=r(5194),l=e([a]);function getServerSideProps(e){let{params:t}=e,r=t.id;return{props:{appId:r}}}function IndexPage({appId:e}){return i.jsx(a.JS,{appId:e})}a=(l.then?(await l)():l)[0],s()}catch(e){s(e)}})},2247:e=>{e.exports=require("@mantine/core")},9445:e=>{e.exports=require("@mantine/form")},32:e=>{e.exports=require("@mantine/hooks")},1280:e=>{e.exports=require("@mantine/modals")},914:e=>{e.exports=require("@mantine/notifications")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},580:e=>{e.exports=require("prop-types")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},727:e=>{e.exports=require("react-syntax-highlighter")},4794:e=>{e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},997:e=>{e.exports=require("react/jsx-runtime")},4827:e=>{e.exports=import("@fortaine/fetch-event-source")},1024:e=>{e.exports=import("mermaid")},5611:e=>{e.exports=import("nanoid")},3135:e=>{e.exports=import("react-markdown")},4921:e=>{e.exports=import("rehype-highlight")},9521:e=>{e.exports=import("rehype-katex")},1871:e=>{e.exports=import("rehype-raw")},7984:e=>{e.exports=import("remark-breaks")},6809:e=>{e.exports=import("remark-gfm")},9832:e=>{e.exports=import("remark-math")},9890:e=>{e.exports=import("zustand")},3602:e=>{e.exports=import("zustand/middleware")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[2761,5021,9209,8450,1664,5913,2394,918,1939,249,5641,4105],()=>__webpack_exec__(5727));module.exports=r})();