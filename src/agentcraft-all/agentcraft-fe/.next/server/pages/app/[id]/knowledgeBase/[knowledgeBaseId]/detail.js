"use strict";(()=>{var e={};e.id=8159,e.ids=[8159,2888,660],e.modules={900:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>_,default:()=>x,getServerSideProps:()=>u,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>j,routeModule:()=>P,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>g});var i=r(7093),a=r(5244),l=r(1323),n=r(9209),p=r.n(n),o=r(5913),d=r(8791),c=e([o,d]);[o,d]=c.then?(await c)():c;let x=(0,l.l)(d,"default"),h=(0,l.l)(d,"getStaticProps"),m=(0,l.l)(d,"getStaticPaths"),u=(0,l.l)(d,"getServerSideProps"),_=(0,l.l)(d,"config"),j=(0,l.l)(d,"reportWebVitals"),g=(0,l.l)(d,"unstable_getStaticProps"),y=(0,l.l)(d,"unstable_getStaticPaths"),w=(0,l.l)(d,"unstable_getStaticParams"),f=(0,l.l)(d,"unstable_getServerProps"),b=(0,l.l)(d,"unstable_getServerSideProps"),P=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/app/[id]/knowledgeBase/[knowledgeBaseId]/detail",pathname:"/app/[id]/knowledgeBase/[knowledgeBaseId]/detail",bundlePath:"",filename:""},components:{App:o.default,Document:p()},userland:d});s()}catch(e){s(e)}})},3478:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Hb:()=>DetailPage});var i,a=r(997),l=r(6689),n=r(2247),p=r(9445),o=r(5509),d=r(1939),c=r(1494),x=r(3962),h=r(9235),m=r(6105),u=r(2394),_=r(918),j=r(3274),g=e([o,d,c,h,j]);function KnowledgeBaseForm({appId:e,containerType:t}){(0,h.s6)().setOpen;let r=(0,h.s6)().currentKnowledgeBase,s=(0,h.s6)().setLoading,i=(0,d.s6)().modelList,o=(0,c.s6)().dataSetList,u=(0,p.useForm)({initialValues:{name:"",description:"",prompt_template:`已知信息：【{context}】。你需要积极，简洁和专业地来回答\`\`\`中的问题。如果问题和已知信息没有关系，或者问题存在争议性，请说 “抱歉，无法回答该问题”，不允许编造。问题是：\`\`\`{query}\`\`\``,app_id:parseInt(e),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:"",exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"知识库名必填"}});(0,l.useEffect)(()=>{(0,d.fZ)(),(0,c.ln)();let e=r?.datasets;u.setValues({id:r?.id,name:r?.name,description:r?.description,prompt_template:r?.prompt_template,app_id:r?.app_id,exact_datasets:e?.filter(e=>e.dataset_type===x.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:e?.filter(e=>e.dataset_type===x.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:r?.exact_search_limit,fuzzy_search_similarity:r?.fuzzy_search_similarity,temperature:r?.temperature,top_p:r?.top_p,n_sequences:r?.n_sequences,max_tokens:r?.max_tokens,stop:r?.stop,presence_penalty:r?.presence_penalty,frequency_penalty:r?.frequency_penalty,logit_bias:r?.logit_bias,model_id:r?.model_id,redis_ip_ex:r?.redis_ip_ex,redis_history_ex:r?.redis_history_ex,model_ip_limit:r?.model_ip_limit,llm_history_len:r?.llm_history_len,system_message:r?.system_message,exact_search_limit:r?.exact_search_limit,fuzzy_search_limit:r?.fuzzy_search_limit})},[r]);let _=i.map(e=>({label:e.name_alias,value:e.id})),j=o.filter(e=>e.dataset_type==x.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),g=o.filter(e=>e.dataset_type==x.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{width:"33%"},children:[2!==t?a.jsx(n.Title,{order:4,mb:8,children:"基础设置"}):null,(0,a.jsxs)(n.Paper,{shadow:"xs",p:"md",withBorder:!0,children:[2!==t?(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.Title,{order:5,size:"h5",children:"知识库"}),(0,a.jsxs)(n.Box,{maw:m.cy,pl:4,pr:4,children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"名称",placeholder:"输入知识库名称",...u.getInputProps("name")}),a.jsx(n.Textarea,{label:"描述",placeholder:"输入应用描述",...u.getInputProps("description")})]}),a.jsx(n.Divider,{my:"sm"})]}):null,a.jsx(n.Title,{order:5,size:"h5",children:"提示词"}),(0,a.jsxs)(n.Box,{maw:m.cy,pl:4,pr:4,children:[a.jsx(n.Textarea,{label:"系统提示词",placeholder:"输入系统提示词",...u.getInputProps("system_message"),description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),a.jsx(n.Textarea,{label:"提示词模板",placeholder:"",...u.getInputProps("prompt_template"),minRows:6,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),a.jsx(n.Divider,{my:"sm"}),a.jsx(n.Title,{order:5,size:"h5",children:"数据集"}),a.jsx(n.Box,{maw:m.cy,pl:4,pr:4,children:(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.MultiSelect,{data:j,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...u.getInputProps("fuzzy_datasets")}),a.jsx(n.MultiSelect,{data:g,description:"问答数据集用来做问题精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...u.getInputProps("exact_datasets")})]})}),a.jsx(n.Divider,{my:"sm"}),a.jsx(n.Title,{order:5,size:"h5",children:"模型"}),a.jsx(n.Box,{maw:m.cy,pl:4,pr:4,mb:12,children:a.jsx(n.Select,{withAsterisk:!0,data:_,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...u.getInputProps("model_id")})}),a.jsx(n.Divider,{my:"sm"})]})]}),(0,a.jsxs)("div",{style:{width:"33%"},children:[2!==t?a.jsx(n.Title,{order:4,mb:8,children:"高级设置"}):null,(0,a.jsxs)(n.Paper,{shadow:"xs",p:"md",withBorder:!0,children:[a.jsx(n.Title,{order:5,size:"h5",children:"答案召回"}),(0,a.jsxs)(n.Box,{maw:m.cy,pl:4,pr:4,children:[(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.TextInput,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...u.getInputProps("fuzzy_search_similarity")}),a.jsx(n.TextInput,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...u.getInputProps("exact_search_similarity")})]}),(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.NumberInput,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...u.getInputProps("fuzzy_search_limit")}),a.jsx(n.NumberInput,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...u.getInputProps("exact_search_limit")})]})]}),a.jsx(n.Divider,{my:"sm"}),a.jsx(n.Title,{order:5,size:"h5",children:"大语言模型参数"}),(0,a.jsxs)(n.Box,{maw:m.cy,pl:4,pr:4,children:[(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"temperature",placeholder:"",...u.getInputProps("temperature")}),a.jsx(n.TextInput,{withAsterisk:!0,label:"top_p",placeholder:"",...u.getInputProps("top_p")})]}),(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"n_sequences",placeholder:"",...u.getInputProps("n_sequences")}),a.jsx(n.TextInput,{withAsterisk:!0,label:"max_tokens",placeholder:"",...u.getInputProps("max_tokens")})]}),(0,a.jsxs)(n.Group,{grow:!0,children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...u.getInputProps("presence_penalty")}),a.jsx(n.TextInput,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...u.getInputProps("frequency_penalty")})]}),a.jsx(n.TextInput,{label:"logit_bias",placeholder:"",...u.getInputProps("logit_bias"),width:"50%"})]}),a.jsx(n.Divider,{my:"sm"})]}),a.jsx(n.Box,{maw:m.cy,pt:24,style:{textAlign:"center",width:"100%"},children:a.jsx(n.Button,{style:{width:"100%"},onClick:async()=>{if(u.validate(),u.isValid()){s(!0);let e=u.values;await (0,h.CH)(e.id,e),s(!1)}},children:"确认修改"})})]})]})}function ChatDrawer(){let e=(0,h.s6)().chatDrawer,t=(0,h.s6)().setChatDrawer;return a.jsx(n.Drawer,{opened:e,onClose:()=>{t(!1)},title:(0,a.jsxs)("div",{children:[a.jsx(n.Text,{fz:"xl",children:"知识库调试"}),a.jsx(n.Text,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整知识库问答的效果"})]}),position:"right",size:"30%",overlayProps:{opacity:.5,blur:4},children:a.jsx(n.Flex,{mih:50,direction:"row",children:(0,a.jsxs)("div",{children:[a.jsx("div",{children:a.jsx(n.Badge,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"知识库问答"})}),a.jsx(o.Z,{})]})})})}function APIAccess(){let e=(0,h.s6)().currentKnowledgeBase,t=(0,h.s6)().accessUrl,r=(0,h.s6)().setAccessUrl,s=(0,h.s6)().setChatDrawer;(0,l.useEffect)(()=>{(async()=>{let e=await (0,h.Sk)(),t=e.data||{openApiUrl:"",innerApiUrl:""};r(t)})()},[]);let i=`curl -X 'POST' \
    '${t.openApiUrl}/v1/chat/completions' \
    -H 'accept: application/json' \
    -H 'Authorization: Bearer ${e?.token}' \
    -H 'Content-Type: application/json' \
    -d '{
      "messages":[
          {
              "role": "user",
              "content": "请问世界最高峰是什么？"
          }
      ],
      "stream": false,
      "max_tokens": 1024
  }'`;return(0,a.jsxs)("div",{style:{width:"33%"},children:[a.jsx(n.Title,{order:4,mb:8,children:"访问接入"}),(0,a.jsxs)(n.Paper,{shadow:"xs",p:"md",withBorder:!0,children:[a.jsx(n.Title,{order:5,size:"h5",children:"API访问"}),(0,a.jsxs)(n.Box,{maw:m.cy,pl:4,pr:4,children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:[a.jsx(n.Text,{color:"cyan",weight:700,children:"公网API访问地址："}),a.jsx(_.Z,{value:t.openApiUrl,content:t.openApiUrl})," "]}),a.jsx("span",{})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{style:{wordBreak:"break-all"},children:[a.jsx(n.Text,{color:"cyan",weight:700,children:"API访问token："}),a.jsx(_.Z,{value:e?.token,content:e?.token})]}),a.jsx("span",{})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{style:{wordBreak:"break-all"},children:[a.jsx(n.Text,{color:"cyan",weight:700,children:"API文档访问："}),a.jsx("a",{href:`${t.openApiUrl}/docs`,target:"_blank",children:`${t.openApiUrl}/docs`})]}),a.jsx("span",{})]})]}),a.jsx(n.Divider,{my:"sm"}),a.jsx(n.Title,{order:5,size:"h5",children:"API调用示例"}),a.jsx(n.Box,{maw:m.cy,pl:4,pr:4,children:a.jsx(j.Z,{textContent:`\`\`\`shell
${i}`,value:i})}),a.jsx(n.Divider,{my:"sm"}),a.jsx(n.Title,{order:5,size:"h5",children:"效果测试"}),a.jsx(n.Box,{maw:m.cy,pl:4,pr:4,children:a.jsx(n.Group,{grow:!0,children:e?.token?a.jsx(n.Button,{color:"grape",variant:"filled",size:"xs",onClick:()=>{s(!0)},mr:4,children:"问答测试"}):a.jsx(n.Tooltip,{label:"需要成访问令牌才可以访问此能力",children:a.jsx(n.Button,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})})})})]})]})}function DetailPage({appId:e,knowledgeBaseId:t}){let r=(0,h.s6)().loading,s=(0,h.s6)().updateCurrentKnowledgeBase,i=[{title:"应用列表",href:"/app"},{title:"知识库",href:`/app/${e}/knowledgeBase`},{title:"知识库详细",href:`/app/${e}/knowledgeBase/${t}/detail`}].map((e,t)=>a.jsx(n.Anchor,{href:e.href,children:e.title},t));return(0,l.useEffect)(()=>{(async()=>{let e=await (0,h.IV)(t);s(e)})()},[t]),(0,a.jsxs)(n.Box,{pos:"relative",children:[a.jsx(n.LoadingOverlay,{visible:r,overlayOpacity:.3}),a.jsx(n.Breadcrumbs,{children:i}),a.jsx(u.Z,{title:"知识库详情",description:"您可以查看修改知识库内容，以及查看API调用"}),a.jsx(ChatDrawer,{}),(0,a.jsxs)(n.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[a.jsx(APIAccess,{}),a.jsx(KnowledgeBaseForm,{appId:e})]})]})}[o,d,c,h,j]=g.then?(await g)():g,function(e){e[e.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",e[e.CHAT=2]="CHAT"}(i||(i={})),s()}catch(e){s(e)}})},8791:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>IndexPage,getServerSideProps:()=>getServerSideProps});var i=r(997),a=r(3478),l=e([a]);function getServerSideProps(e){let{params:t}=e,r=t.id,s=t.knowledgeBaseId;return{props:{appId:r,knowledgeBaseId:s}}}function IndexPage({appId:e,knowledgeBaseId:t}){return i.jsx(a.Hb,{appId:e,knowledgeBaseId:t})}a=(l.then?(await l)():l)[0],s()}catch(e){s(e)}})},2247:e=>{e.exports=require("@mantine/core")},9445:e=>{e.exports=require("@mantine/form")},32:e=>{e.exports=require("@mantine/hooks")},1280:e=>{e.exports=require("@mantine/modals")},914:e=>{e.exports=require("@mantine/notifications")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},580:e=>{e.exports=require("prop-types")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},727:e=>{e.exports=require("react-syntax-highlighter")},4794:e=>{e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},997:e=>{e.exports=require("react/jsx-runtime")},4827:e=>{e.exports=import("@fortaine/fetch-event-source")},1024:e=>{e.exports=import("mermaid")},5611:e=>{e.exports=import("nanoid")},3135:e=>{e.exports=import("react-markdown")},4921:e=>{e.exports=import("rehype-highlight")},9521:e=>{e.exports=import("rehype-katex")},7984:e=>{e.exports=import("remark-breaks")},6809:e=>{e.exports=import("remark-gfm")},9832:e=>{e.exports=import("remark-math")},9890:e=>{e.exports=import("zustand")},3602:e=>{e.exports=import("zustand/middleware")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[2761,5021,9209,8450,5913,2394,918,1939,249,5641,4105],()=>__webpack_exec__(900));module.exports=r})();