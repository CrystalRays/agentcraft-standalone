"use strict";(()=>{var e={};e.id=4650,e.ids=[4650,2888,660],e.modules={7530:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>g,default:()=>p,getServerSideProps:()=>m,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>j,routeModule:()=>y,unstable_getServerProps:()=>q,unstable_getServerSideProps:()=>I,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>w,unstable_getStaticProps:()=>f});var i=r(7093),a=r(5244),l=r(1323),n=r(9209),o=r.n(n),d=r(5913),c=r(8321),u=e([d,c]);[d,c]=u.then?(await u)():u;let p=(0,l.l)(c,"default"),h=(0,l.l)(c,"getStaticProps"),x=(0,l.l)(c,"getStaticPaths"),m=(0,l.l)(c,"getServerSideProps"),g=(0,l.l)(c,"config"),j=(0,l.l)(c,"reportWebVitals"),f=(0,l.l)(c,"unstable_getStaticProps"),w=(0,l.l)(c,"unstable_getStaticPaths"),S=(0,l.l)(c,"unstable_getStaticParams"),q=(0,l.l)(c,"unstable_getServerProps"),I=(0,l.l)(c,"unstable_getServerSideProps"),y=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/dataset/[id]/datasource",pathname:"/dataset/[id]/datasource",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:c});s()}catch(e){s(e)}})},6097:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Y:()=>Datasource});var i=r(997),a=r(6689),l=r(1163),n=r(2247),o=r(9445),d=r(1280),c=r(918),u=r(904),p=r(2386),h=r(5590),x=r(3962),m=r(5288),g=r(1008),j=r(6105),f=e([h]);function DocumentForm({form:e}){return(0,i.jsxs)(n.Box,{maw:j.hE,mx:"auto",children:[i.jsx(n.TextInput,{withAsterisk:!0,label:"标题",placeholder:"",...e.getInputProps("title")}),i.jsx(n.Textarea,{withAsterisk:!0,label:"内容",placeholder:"",...e.getInputProps("content")}),i.jsx(n.TextInput,{label:"来源url",placeholder:"",...e.getInputProps("url")}),i.jsx(n.NumberInput,{label:"文档切片大小",placeholder:"",...e.getInputProps("chunk_size")})]})}function QuestionForm({form:e}){return(0,i.jsxs)(n.Box,{maw:j.hE,mx:"auto",children:[i.jsx(n.TextInput,{withAsterisk:!0,label:"标题",placeholder:"",...e.getInputProps("title")}),i.jsx(n.Textarea,{withAsterisk:!0,label:"问题",placeholder:"",...e.getInputProps("question")}),i.jsx(n.Textarea,{withAsterisk:!0,label:"答案",placeholder:"",...e.getInputProps("answer")}),i.jsx(n.TextInput,{label:"来源url",placeholder:"",...e.getInputProps("url")})]})}function AddOrUpdate(){let e=(0,l.useRouter)(),t=(0,h.qo)().open,r=(0,h.qo)().setOpen,s=(0,h.qo)().setLoading,d=(0,h.qo)().isEdit,c=(0,h.qo)().setIsEdit,u=(0,h.qo)().currentDataSource,{query:p}=e,m=p.dataSetType,f=p.id,w=(0,o.useForm)({initialValues:{title:"",content:"",url:"",chunk_size:g.V,ext:"txt",tag:f},validate:{title:e=>e?null:"标题必填",content:e=>e?null:"内容必填"}}),S=(0,o.useForm)({initialValues:{title:"",question:"",answer:"",tag:f,url:""},validate:{title:e=>e?null:"标题必填",question:e=>e?null:"问题必填",answer:e=>e?null:"答案必填"}}),q=m==x.I.DOCUMENT?w:S;return(0,a.useEffect)(()=>{d&&(m==x.I.DOCUMENT&&w.setValues({title:u.title,content:u.doc_chunk,url:u.url,chunk_size:u.token_size,ext:"txt",tag:f}),m==x.I.QUESTION&&S.setValues({title:u.title,question:u.question,answer:u.doc_chunk,tag:f,url:u.url}))},[d,u]),(0,i.jsxs)(n.Modal,{opened:t,onClose:()=>{r(!1),c(!1)},title:d?"编辑数据源":"新增数据源",centered:!0,children:[m==x.I.DOCUMENT?i.jsx(DocumentForm,{form:w}):i.jsx(QuestionForm,{form:S}),i.jsx(n.Box,{maw:j.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:i.jsx(n.Button,{onClick:async()=>{if(q.validate(),q.isValid())try{s(!0);let e=q.values;d?await (0,h.oe)({dataSetId:f,dataSetType:m,dataSourceId:u.id},e):await (0,h.J_)({dataSetId:f,dataSetType:m},e),await (0,h.z9)(f,m)}catch(e){console.log(e)}finally{r(!1),s(!1)}},children:"确认"})})]})}function UploadDataSource(){let e=(0,l.useRouter)(),t=(0,h.qo)().openUploadModel,r=(0,h.qo)().setOpenUploadModel,s=(0,h.qo)().setLoading,a=(0,h.qo)().setIsEdit,{query:d}=e,c=d.dataSetType,p=d.id,x=(0,o.useForm)({initialValues:{title:"",url:"",chunk_size:g.V,ext:"txt",tag:p},validate:{title:e=>e?null:"标题必填"}});return(0,i.jsxs)(n.Modal,{opened:t,onClose:()=>{r(!1),a(!1)},title:"上传数据集文档",centered:!0,children:[i.jsx(n.FileInput,{withAsterisk:!0,accept:".md,.txt,.html,.pdf",name:"file",label:"选择文档",description:"选择本地文件上传，支持 .txt,.md,.html文件",placeholder:"点击上传文档",icon:i.jsx(u.Z,{size:(0,n.rem)(14)}),...x.getInputProps("file")}),i.jsx(n.TextInput,{withAsterisk:!0,label:"标题",description:"标题内容作为检索的数据来源，用来展示检索结果",placeholder:"",...x.getInputProps("title")}),i.jsx(n.NumberInput,{withAsterisk:!0,label:"文档切片大小",description:"",placeholder:"",...x.getInputProps("chunk_size")}),i.jsx(n.TextInput,{label:"来源url",placeholder:"",...x.getInputProps("url")}),i.jsx(n.Box,{maw:j.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:i.jsx(n.Button,{onClick:async()=>{if(x.validate(),x.isValid())try{s(!0);let e=await x.values,t=new FormData;t.append("file",e.file),t.append("title",e.title),t.append("chunk_size",e.chunk_size),t.append("url",e.url),await (0,h.$s)({dataSetId:p},t),await (0,h.z9)(p,c)}catch(e){console.log(e)}finally{r(!1),s(!1)}},children:"确认"})})]})}function List({dataSetId:e,dataSetType:t}){let r=(0,h.qo)().dataSourceList,s=(0,h.qo)().setLoading,l=(0,h.qo)().setIsEdit,o=(0,h.qo)().setOpen,u=(0,h.qo)().setCurrentDataSource,removeDataDataSource=r=>{let{id:a,title:l}=r,o=`确定删除 ${l}?`;d.modals.openConfirmModal({title:"删除数据集",centered:!0,children:i.jsx(n.Text,{size:"sm",children:i.jsx(n.Highlight,{highlight:l,children:o})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{s(!0),await (0,h.xU)({dataSetId:e,dataSetType:t,dataSourceId:a}),await (0,h.z9)(e,t),s(!1)}})},p=r.map(e=>(0,i.jsxs)("tr",{children:[i.jsx("td",{style:{width:80},children:e.id}),i.jsx("td",{style:{width:240},children:e.title}),i.jsx("td",{style:{width:140},children:e.url?i.jsx(c.Z,{value:e.url,content:e.url,truncate:!0,width:120}):null}),t==x.I.QUESTION?i.jsx("td",{style:{width:120},children:i.jsx(c.Z,{value:e.question,content:e.question,truncate:!0})}):null,i.jsx("td",{width:550,children:i.jsx(c.Z,{value:e.doc_chunk,content:e.doc_chunk,width:550})}),i.jsx("td",{style:{width:120},children:(0,m.o0)(e.created)}),i.jsx("td",{style:{width:120},children:(0,m.o0)(e.modified)}),(0,i.jsxs)("td",{style:{width:140},children:[i.jsx(n.Button,{variant:"filled",color:"red",size:"xs",onClick:()=>removeDataDataSource(e),mr:4,children:"删除"}),i.jsx(n.Button,{variant:"filled",size:"xs",onClick:()=>{o(!0),l(!0),u(e)},children:"编辑"})]})]},e.id)),getDatasource=async()=>{s(!0);try{await (0,h.z9)(e,t)}catch(e){}s(!1)};return(0,a.useEffect)(()=>{getDatasource()},[e,t]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:["共计",r.length,"条数据"]}),(0,i.jsxs)(n.Table,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[i.jsx("thead",{children:(0,i.jsxs)("tr",{children:[i.jsx("th",{children:"编号"}),i.jsx("th",{children:"标题"}),i.jsx("th",{children:"源访问地址"}),t==x.I.QUESTION?i.jsx("th",{children:"问题"}):null,i.jsx("th",{children:t==x.I.QUESTION?"答案":"文档内容"}),i.jsx("th",{children:"创建时间"}),i.jsx("th",{children:"修改时间"}),i.jsx("th",{children:"操作"})]})}),i.jsx("tbody",{children:p})]})]})}function Datasource(){let e=(0,l.useRouter)(),{query:t}=e,r=t.dataSetType,s=t.id,a=[{title:"AgentCraft",href:"/"},{title:"数据集",href:"/dataset"},{title:"数据源",href:`/dataset/${s}/datasource`}].map((e,t)=>i.jsx(n.Anchor,{href:e.href,children:e.title},t)),o=(0,h.qo)().loading,d=(0,h.qo)().setOpen,c=(0,h.qo)().setIsEdit,u=(0,h.qo)().setOpenUploadModel;return(0,i.jsxs)(i.Fragment,{children:[i.jsx(n.Breadcrumbs,{children:a}),i.jsx(n.Box,{mt:12,children:(0,i.jsxs)(n.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[i.jsx(n.Button,{onClick:()=>{c(!1),d(!0)},children:"新建单条数据源"}),i.jsx(n.Space,{h:"md"}),r==x.I.DOCUMENT?i.jsx(n.Button,{onClick:()=>u(!0),variant:"filled",leftIcon:i.jsx(p.Z,{size:"1rem"}),children:"上传文件"}):null]})}),(0,i.jsxs)(n.Box,{children:[i.jsx(n.LoadingOverlay,{visible:o,overlayOpacity:.3}),i.jsx(AddOrUpdate,{}),i.jsx(UploadDataSource,{}),i.jsx(List,{dataSetId:s,dataSetType:r})]})]})}h=(f.then?(await f)():f)[0],s()}catch(e){s(e)}})},8321:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>IndexPage,getServerSideProps:()=>getServerSideProps});var i=r(997),a=r(6097),l=e([a]);function getServerSideProps(e){let{params:t}=e,r=t.id;return{props:{datasetId:r}}}function IndexPage(){return i.jsx(a.Y,{})}a=(l.then?(await l)():l)[0],s()}catch(e){s(e)}})},2247:e=>{e.exports=require("@mantine/core")},9445:e=>{e.exports=require("@mantine/form")},32:e=>{e.exports=require("@mantine/hooks")},1280:e=>{e.exports=require("@mantine/modals")},914:e=>{e.exports=require("@mantine/notifications")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},580:e=>{e.exports=require("prop-types")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},727:e=>{e.exports=require("react-syntax-highlighter")},4794:e=>{e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},997:e=>{e.exports=require("react/jsx-runtime")},5611:e=>{e.exports=import("nanoid")},3135:e=>{e.exports=import("react-markdown")},4921:e=>{e.exports=import("rehype-highlight")},9521:e=>{e.exports=import("rehype-katex")},1871:e=>{e.exports=import("rehype-raw")},7984:e=>{e.exports=import("remark-breaks")},6809:e=>{e.exports=import("remark-gfm")},9832:e=>{e.exports=import("remark-math")},9890:e=>{e.exports=import("zustand")},3602:e=>{e.exports=import("zustand/middleware")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[2761,5464,9209,8450,7797,5913,918,1937],()=>__webpack_exec__(7530));module.exports=r})();