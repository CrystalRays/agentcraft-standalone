"use strict";(()=>{var e={};e.id=4650,e.ids=[4650,2888,660],e.modules={7530:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>j,default:()=>p,getServerSideProps:()=>m,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>g,routeModule:()=>P,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>w,unstable_getStaticProps:()=>f});var a=r(7093),i=r(5244),l=r(1323),n=r(9209),o=r.n(n),d=r(5913),c=r(8321),u=e([d,c]);[d,c]=u.then?(await u)():u;let p=(0,l.l)(c,"default"),h=(0,l.l)(c,"getStaticProps"),x=(0,l.l)(c,"getStaticPaths"),m=(0,l.l)(c,"getServerSideProps"),j=(0,l.l)(c,"config"),g=(0,l.l)(c,"reportWebVitals"),f=(0,l.l)(c,"unstable_getStaticProps"),w=(0,l.l)(c,"unstable_getStaticPaths"),S=(0,l.l)(c,"unstable_getStaticParams"),b=(0,l.l)(c,"unstable_getServerProps"),y=(0,l.l)(c,"unstable_getServerSideProps"),P=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/dataset/[id]/datasource",pathname:"/dataset/[id]/datasource",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:c});s()}catch(e){s(e)}})},6097:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Y:()=>Datasource});var a=r(997),i=r(6689),l=r(1163),n=r(2247),o=r(9445),d=r(1280),c=r(918),u=r(904),p=r(2386),h=r(5590),x=r(3962),m=r(5288),j=r(6105),g=e([h]);function DocumentForm({form:e}){return(0,a.jsxs)(n.Box,{maw:j.hE,mx:"auto",children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"标题",placeholder:"",...e.getInputProps("title")}),a.jsx(n.Textarea,{withAsterisk:!0,label:"内容",placeholder:"",...e.getInputProps("content")}),a.jsx(n.TextInput,{label:"来源url",placeholder:"",...e.getInputProps("url")}),a.jsx(n.NumberInput,{label:"文档切片大小",placeholder:"",...e.getInputProps("chunk_size")})]})}function QuestionForm({form:e}){return(0,a.jsxs)(n.Box,{maw:j.hE,mx:"auto",children:[a.jsx(n.TextInput,{withAsterisk:!0,label:"标题",placeholder:"",...e.getInputProps("title")}),a.jsx(n.Textarea,{withAsterisk:!0,label:"问题",placeholder:"",...e.getInputProps("question")}),a.jsx(n.Textarea,{withAsterisk:!0,label:"答案",placeholder:"",...e.getInputProps("answer")}),a.jsx(n.TextInput,{label:"来源url",placeholder:"",...e.getInputProps("url")})]})}function Add(){let e=(0,l.useRouter)(),t=(0,h.s6)().open,r=(0,h.s6)().setOpen,s=(0,h.s6)().setLoading,{query:i}=e,d=i.dataSetType,c=i.id,u=(0,o.useForm)({initialValues:{title:"",content:"",url:"",chunk_size:1024,ext:"txt",tag:c},validate:{title:e=>e?null:"标题必填",content:e=>e?null:"内容必填"}}),p=(0,o.useForm)({initialValues:{title:"",question:"",answer:"",tag:c,url:""},validate:{title:e=>e?null:"标题必填",question:e=>e?null:"问题必填",answer:e=>e?null:"答案必填"}}),m=d==x.I.DOCUMENT?u:p;return(0,a.jsxs)(n.Modal,{opened:t,onClose:()=>{r(!1)},title:"创建数据集",centered:!0,children:[d==x.I.DOCUMENT?a.jsx(DocumentForm,{form:u}):a.jsx(QuestionForm,{form:p}),a.jsx(n.Box,{maw:j.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:a.jsx(n.Button,{onClick:async()=>{if(m.validate(),m.isValid())try{s(!0);let e=m.values;await (0,h.J_)({dataSetId:c,dataSetType:d},e),await (0,h.z9)(c,d)}catch(e){console.log(e)}finally{r(!1),s(!1)}},children:"确认"})})]})}function UploadDataSource(){let e=(0,l.useRouter)(),t=(0,h.s6)().openUploadModel,r=(0,h.s6)().setOpenUploadModel,s=(0,h.s6)().setLoading,{query:i}=e,d=i.dataSetType,c=i.id,p=(0,o.useForm)({initialValues:{title:"",url:"",chunk_size:512,ext:"txt",tag:c},validate:{title:e=>e?null:"标题必填"}});return(0,a.jsxs)(n.Modal,{opened:t,onClose:()=>{r(!1)},title:"上传数据集文档",centered:!0,children:[a.jsx(n.FileInput,{withAsterisk:!0,accept:".md,.txt,.html,.pdf",name:"file",label:"选择文档",description:"选择本地文件上传，支持 .txt,.md,.html文件",placeholder:"点击上传文档",icon:a.jsx(u.Z,{size:(0,n.rem)(14)}),...p.getInputProps("file")}),a.jsx(n.TextInput,{withAsterisk:!0,label:"标题",description:"标题内容作为检索的数据来源，用来展示检索结果",placeholder:"",...p.getInputProps("title")}),a.jsx(n.NumberInput,{withAsterisk:!0,label:"文档切片大小",description:"",placeholder:"",...p.getInputProps("chunk_size")}),a.jsx(n.TextInput,{label:"来源url",placeholder:"",...p.getInputProps("url")}),a.jsx(n.Box,{maw:j.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:a.jsx(n.Button,{onClick:async()=>{if(p.validate(),p.isValid())try{s(!0);let e=await p.values,t=new FormData;t.append("file",e.file),t.append("title",e.title),t.append("chunk_size",e.chunk_size),t.append("url",e.url),await (0,h.$s)({dataSetId:c},t),await (0,h.z9)(c,d)}catch(e){console.log(e)}finally{r(!1),s(!1)}},children:"确认"})})]})}function List({dataSetId:e,dataSetType:t}){let r=(0,h.s6)().dataSourceList,s=(0,h.s6)().setLoading,removeDataDataSource=r=>{let{id:i,title:l}=r,o=`确定删除 ${l}?`;d.modals.openConfirmModal({title:"删除数据集",centered:!0,children:a.jsx(n.Text,{size:"sm",children:a.jsx(n.Highlight,{highlight:l,children:o})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{s(!0),await (0,h.xU)({dataSetId:e,dataSetType:t,dataSourceId:i}),await (0,h.z9)(e,t),s(!1)}})},l=r.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{style:{width:80},children:e.id}),a.jsx("td",{style:{width:240},children:e.title}),a.jsx("td",{style:{width:240},children:e.url?a.jsx(c.Z,{value:e.url,content:e.url,truncate:!0}):null}),t==x.I.QUESTION?a.jsx("td",{style:{width:120},children:a.jsx(c.Z,{value:e.question,content:e.question,truncate:!0})}):null,a.jsx("td",{width:550,children:a.jsx(c.Z,{value:e.doc_chunk,content:e.doc_chunk,width:550})}),a.jsx("td",{style:{width:120},children:(0,m.o0)(e.created)}),a.jsx("td",{style:{width:120},children:(0,m.o0)(e.modified)}),(0,a.jsxs)("td",{style:{width:80},children:[" ",a.jsx(n.Button,{variant:"filled",color:"red",size:"xs",onClick:()=>removeDataDataSource(e),children:"删除"})]})]},e.id)),getDatasource=async()=>{s(!0);try{await (0,h.z9)(e,t)}catch(e){}s(!1)};return(0,i.useEffect)(()=>{getDatasource()},[e,t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["共计",r.length,"条数据"]}),(0,a.jsxs)(n.Table,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"编号"}),a.jsx("th",{children:"标题"}),a.jsx("th",{children:"源访问地址"}),t==x.I.QUESTION?a.jsx("th",{children:"问题"}):null,a.jsx("th",{children:t==x.I.QUESTION?"答案":"文档内容"}),a.jsx("th",{children:"创建时间"}),a.jsx("th",{children:"修改时间"}),a.jsx("th",{children:"操作"})]})}),a.jsx("tbody",{children:l})]})]})}function Datasource(){let e=(0,l.useRouter)(),{query:t}=e,r=t.dataSetType,s=t.id,i=[{title:"AgentCraft",href:"/"},{title:"数据集",href:"/dataset"},{title:"数据源",href:`/dataset/${s}/datasource`}].map((e,t)=>a.jsx(n.Anchor,{href:e.href,children:e.title},t)),o=(0,h.s6)().loading,d=(0,h.s6)().setOpen,c=(0,h.s6)().setOpenUploadModel;return(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.Breadcrumbs,{children:i}),a.jsx(n.Box,{mt:12,children:(0,a.jsxs)(n.Flex,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[a.jsx(n.Button,{onClick:()=>d(!0),children:"新建单条数据源"}),a.jsx(n.Space,{h:"md"}),r==x.I.DOCUMENT?a.jsx(n.Button,{onClick:()=>c(!0),variant:"filled",leftIcon:a.jsx(p.Z,{size:"1rem"}),children:"上传文件"}):null]})}),(0,a.jsxs)(n.Box,{children:[a.jsx(n.LoadingOverlay,{visible:o,overlayOpacity:.3}),a.jsx(Add,{}),a.jsx(UploadDataSource,{}),a.jsx(List,{dataSetId:s,dataSetType:r})]})]})}h=(g.then?(await g)():g)[0],s()}catch(e){s(e)}})},8321:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>IndexPage,getServerSideProps:()=>getServerSideProps});var a=r(997),i=r(6097),l=e([i]);function getServerSideProps(e){let{params:t}=e,r=t.id;return{props:{datasetId:r}}}function IndexPage(){return a.jsx(i.Y,{})}i=(l.then?(await l)():l)[0],s()}catch(e){s(e)}})},2247:e=>{e.exports=require("@mantine/core")},9445:e=>{e.exports=require("@mantine/form")},32:e=>{e.exports=require("@mantine/hooks")},1280:e=>{e.exports=require("@mantine/modals")},914:e=>{e.exports=require("@mantine/notifications")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},580:e=>{e.exports=require("prop-types")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},727:e=>{e.exports=require("react-syntax-highlighter")},4794:e=>{e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},997:e=>{e.exports=require("react/jsx-runtime")},5611:e=>{e.exports=import("nanoid")},3135:e=>{e.exports=import("react-markdown")},7984:e=>{e.exports=import("remark-breaks")},6809:e=>{e.exports=import("remark-gfm")},9832:e=>{e.exports=import("remark-math")},9890:e=>{e.exports=import("zustand")},3602:e=>{e.exports=import("zustand/middleware")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[2761,5021,9209,8450,7797,5913,918,773],()=>__webpack_exec__(7530));module.exports=r})();