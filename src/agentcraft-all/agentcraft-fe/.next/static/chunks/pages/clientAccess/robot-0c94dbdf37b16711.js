(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[398],{19901:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/clientAccess/robot",function(){return n(76911)}])},918:function(e,t,n){"use strict";n.d(t,{Z:function(){return CopyToClipboard}});var i=n(85893),o=n(67294),a=n(55652),r=n(69876),c=n(95117),l=n(49834),s=n(88198),d=n(93625),p=n(90589),u=n.n(p);function CopyToClipboard(e){let{value:t,content:n,truncate:p,width:g="auto"}=e,h=function(){let{timeout:e=2e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,o.useState)(null),[i,a]=(0,o.useState)(!1),[r,c]=(0,o.useState)(null),handleCopyResult=t=>{clearTimeout(r),c(setTimeout(()=>a(!1),e)),a(t)};return{copy:e=>{if("clipboard"in navigator)navigator.clipboard.writeText(e).then(()=>handleCopyResult(!0)).catch(e=>n(e));else{let t=document.createElement("textarea");t.value=e,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(e){console.error(e)}finally{t.remove(),handleCopyResult(!0)}}},reset:()=>{a(!1),n(null),clearTimeout(r)},error:t,copied:i}}({timeout:500});return(0,i.jsx)(a.u,{label:h.copied?"已复制":"复制",withArrow:!0,position:"right",children:(0,i.jsxs)(r.k,{onClick:()=>h.copy(t),mih:50,style:{width:g},gap:"xs",justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",children:[n?(0,i.jsx)(c.x,{truncate:p,className:u()["copy-to-clipboard-content"],children:n}):null,(0,i.jsx)(l.A,{color:h.copied?"teal":"gray",children:h.copied?(0,i.jsx)(s.Z,{size:"1rem"}):(0,i.jsx)(d.Z,{size:"1rem"})})]})})}},2394:function(e,t,n){"use strict";n.d(t,{Z:function(){return FeatureDescription}});var i=n(85893),o=n(92716),a=n(95117),r=n(64523),c=n(69876),l=n(19236),s=n(91759);function InfoDetail(e){let{detail:t,title:n}=e,[r,{open:c,close:l}]=(0,s.q)(!1);return(0,i.jsx)(i.Fragment,{children:t?(0,i.jsxs)("div",{children:[(0,i.jsx)(o.d,{opened:r,onClose:l,title:n,children:(0,i.jsx)(a.x,{children:t})}),(0,i.jsx)(a.x,{onClick:()=>c(),children:"信息"})]}):null})}function FeatureDescription(e){let{title:t,description:n,detail:o,mt:s,mb:d}=e;return(0,i.jsxs)(r.x,{mt:s||24,mb:d||24,children:[(0,i.jsxs)(c.k,{mih:20,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,i.jsx)(l.D,{order:2,children:t}),(0,i.jsx)(InfoDetail,{title:t,detail:o})]}),n?(0,i.jsx)(a.x,{lineClamp:4,children:n}):null]})}},7374:function(e,t,n){"use strict";var i,o,a,r,c;n.d(t,{KJ:function(){return o},Pw:function(){return x},TN:function(){return l},Vg:function(){return h},W8:function(){return w},X_:function(){return p},bb:function(){return a},fC:function(){return f},kg:function(){return i},l1:function(){return b},wm:function(){return s},xr:function(){return d}}),(r=i||(i={})).DING_TALK="dingtalk",r.WECHAT="wechat",(o||(o={})).CHATGPT_NEXTJS_WEB="chatgpt-next-web";let l=[{label:"钉钉机器人",value:"dingtalk",image:"https://img.alicdn.com/imgextra/i2/O1CN019OiHSB1tMIXnlm4k0_!!6000000005887-2-tps-200-200.png",description:"钉钉机器人"},{label:"微信个人机器人",value:"wechat",image:"https://img.alicdn.com/imgextra/i1/O1CN01bhGQ8126xw6OOzOxN_!!6000000007729-2-tps-200-200.png",description:"微信个人机器人"}],s=[{label:"chatgpt-next-web应用模板",value:"chatgpt-next-web",image:"https://img.alicdn.com/imgextra/i3/O1CN010n937P22NW91SAmvB_!!6000000007108-0-tps-1678-958.jpg",description:"chatgpt-next-web"}],d="cn-hangzhou",p="AGENTCRAFT_CLIENT",u="agentcraft-client-dingtalk",g="agentcraft-client-wechat";(c=a||(a={}))[c.AGENT_SERVICE=0]="AGENT_SERVICE",c[c.SERVICE_CONFIG_PREVIEW=1]="SERVICE_CONFIG_PREVIEW",c[c.ROBOT_WEBHOOK=2]="ROBOT_WEBHOOK";let h={[u]:"钉钉机器人",[g]:"微信机器人（个人版）"},x={dingtalk:u,wechat:g},f={dingtalk:"agentcraft-dingtalk-agent-server",wechat:"agentcraft-wechat-agent-server"},b={"chatgpt-next-web":"agentcraft-client-web"},w={"chatgpt-next-web":"agentcraft-web-frontend"}},76911:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return IndexPage}});var i=n(85893),o=n(67294),a=n(53416),r=n(11163),c=n(77248),l=n(54685),s=n(93284),d=n(70157),p=n(49737),u=n(69876),g=n(20966),h=n(71232),x=n(67841),f=n(26373),b=n(5638),w=n(57472),y=n(43726),m=n(29235),v=n(99985),C=n(95117),j=n(82623),_=n(19236),k=n(64523),A=n(28855),E=n(52615),S=n(71346),T=n(7374);let I=(0,o.forwardRef)((e,t)=>{let{image:n,label:o,description:a,...r}=e;return(0,i.jsx)("div",{ref:t,...r,children:(0,i.jsxs)(h.Z,{noWrap:!0,children:[(0,i.jsx)(v.q,{src:n}),(0,i.jsxs)("div",{children:[(0,i.jsx)(C.x,{size:"sm",children:o}),(0,i.jsx)(C.x,{size:"xs",opacity:.65,children:a})]})]})})});function SetProxyService(e){let{form:t}=e,n=(0,S.qr)().appList,a=(0,m.I1)().knowledgeBaseList,getApp=async()=>{await (0,S.RV)()},getKonwledgeBase=async e=>{try{await (0,m.Co)(e)}catch(e){console.log(e)}};(0,o.useEffect)(()=>{getApp()},[]);let r=n.map(e=>({label:e.name,value:e.id})),c=a.map(e=>({label:e.name,value:e.id}));return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(j.X,{shadow:"xs",p:"xl",children:[(0,i.jsx)(_.D,{order:5,children:"配置机器人代理服务"}),(0,i.jsxs)(k.x,{mx:"auto",children:[(0,i.jsx)(A.Ph,{withAsterisk:!0,data:T.TN,itemComponent:I,description:"选择您要接入的机器人类型",label:"选择机器人类型",filter:(e,t)=>t.label.toLowerCase().includes(e.toLowerCase().trim())||t.description.toLowerCase().includes(e.toLowerCase().trim()),placeholder:"",...t.getInputProps("chatBotType")}),(0,i.jsx)(A.Ph,{withAsterisk:!0,data:r,description:"选择要交付的应用",label:"应用",placeholder:"",...t.getInputProps("appId"),onChange:e=>{t.setFieldValue("appId",e),getKonwledgeBase(e)}}),(0,i.jsx)(A.Ph,{withAsterisk:!0,data:c,description:"选择要交付的知识库智能体",label:"选择知识库智能体",placeholder:"",...t.getInputProps("agentId")}),(0,i.jsx)(E.g,{label:"机器人代理服务描述",description:"",placeholder:"",...t.getInputProps("description")})]})]})})}var O=n(20050),N=n(918);function ServiceConfigPreview(){let{robotConfig:e}=(0,b.iZ)(),{robotProxyServiceConfig:t}=e,{serviceUrl:n,token:o}=t;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.D,{order:5,children:"代理服务配置信息"}),(0,i.jsxs)(k.x,{mx:"auto",children:[(0,i.jsxs)(O.r,{children:[(0,i.jsx)(O.r.Col,{span:4,children:"Outgoing Post地址"}),(0,i.jsx)(O.r.Col,{span:8,className:"copy_container",children:(0,i.jsx)(u.k,{justify:"flex-start",align:"center",direction:"row",children:n?(0,i.jsx)(N.Z,{value:n,content:n}):null})})]}),(0,i.jsxs)(O.r,{children:[(0,i.jsx)(O.r.Col,{span:4,children:"Outgoing Token"}),(0,i.jsx)(O.r.Col,{span:8,children:(0,i.jsx)(u.k,{justify:"flex-start",align:"center",direction:"row",children:o?(0,i.jsx)(N.Z,{value:o,content:o}):null})})]})]})]})}var B=n(12593);function RobotWebhookConfig(e){let{form:t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(j.X,{shadow:"xs",p:"xl",children:[(0,i.jsx)(_.D,{order:5,children:"配置钉钉机器人webhook"}),(0,i.jsxs)(B.P,{title:"系统配置",mb:12,mt:12,withCloseButton:!1,radius:"xs",children:["使用该功能请先开通 ",(0,i.jsx)(l.e,{href:"https://common-buy.aliyun.com/?commodityCode=eventbridge_post_public_cn",target:"_blank",children:"Eventbridge"})]}),(0,i.jsxs)(k.x,{mx:"auto",children:[(0,i.jsx)(E.g,{label:"Webhook",description:"",placeholder:"",...t.getInputProps("webhook")}),(0,i.jsx)(E.g,{label:"访问令牌",description:"",placeholder:"",...t.getInputProps("token")})]})]})})}var W=n(2394),P=n(42474),L=n.n(P);let R=L().createECDH("secp256k1");function Robot(){let e=(0,r.useRouter)(),{activeStep:t,setActiveStep:n,robotStepStatus:o,setRobotStepStatus:v,robotConfig:C,setRobotConfig:j}=(0,b.iZ)(),_=(0,w.Po)().completeConfig,k=[{title:"AgentCraft",href:"/"},{title:"客户端接入",href:"/clientAccess"}].map((e,t)=>(0,i.jsx)(l.e,{href:e.href,children:e.title},t)),A=(0,c.c)({initialValues:{chatBotType:T.kg.DING_TALK,appId:"",agentId:"",description:"桥接AgentCraft智能体到钉钉/微信的代理服务"},validate:{chatBotType:e=>e?null:"请选择一个机器人类型",appId:e=>e?null:"请选择应用",agentId:e=>e?null:"请选择一个智能体"}}),E=(0,c.c)({initialValues:{webhook:"",token:""},validate:{webhook:e=>e?null:"请输入钉钉机器人webhook",token:e=>e?null:"请输入认证令牌"}}),{chatBotType:S}=A.values,createProxyService=async()=>{if(A.validate(),A.isValid()){try{o.robot_proxy_service_create_loading=!0,v(o);let{agentId:e,description:r}=A.values,c=await (0,m.IV)(e),l=c.token,s=await (0,m.Sk)(),d=s.data||{openApiUrl:"",innerApiUrl:""},p=await (0,b.xn)(T.Pw[S],{region:_.regionId||T.xr,TOKEN:l,BASE_LLM_SERVER:d.openApiUrl,name:"".concat(T.X_,"_").concat((0,a.x0)()),description:r});if(p){var t,n,i;let e=await (0,y.p)(p),o=null==e?void 0:null===(t=e.output)||void 0===t?void 0:t.deploy.domain,a=null==e?void 0:null===(i=e.output)||void 0===i?void 0:null===(n=i.deploy[T.fC[S]])||void 0===n?void 0:n.functionName;if(S===T.kg.DING_TALK){let e=o.domainName,t=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let n=0;n<32;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();C.robotProxyServiceConfig={serviceUrl:"http://".concat(e,"/chat"),token:t,agentFunctionName:a},j(C)}f.N9.show({title:"机器人服务创建成功",message:"您已完成机器人服务创建",color:"green"})}}catch(e){f.N9.show({title:"异常",message:e.message,color:"red"})}o.robot_proxy_service_create_loading=!1,v(o),S===T.kg.DING_TALK?nextStepAction():e.push("/clientAccess")}},createWebhook=async()=>{if(E.validate(),E.isValid()){try{o.robot_webhook_create_loading=!0,v(o);let{webhook:t,token:n}=E.values,i=C.robotProxyServiceConfig;await (0,b.Ow)({region:_.regionId||T.xr,webhook:t,token:n,functionName:i.agentFunctionName}),C.robotWebhookConfig={webhook:t,token:n},j(C),f.N9.show({title:"机器人Webhook创建成功",message:"您已完成机器人Webhook创建",color:"green"}),e.push("/clientAccess")}catch(e){f.N9.show({title:"异常",message:e.message,color:"red"})}o.robot_webhook_create_loading=!1,v(o),nextStepAction()}},nextStepAction=()=>{let e=t<2?t+1:t;n(e)},nextStep=async()=>{t===T.bb.AGENT_SERVICE&&await createProxyService(),t===T.bb.ROBOT_WEBHOOK&&await createWebhook()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.O,{children:k}),(0,i.jsx)(W.Z,{title:"机器人接入",description:"将智能体服务接入机器人"}),(0,i.jsxs)(d.v,{active:t,onStepClick:n,children:[(0,i.jsx)(d.v.Step,{label:"配置机器人服务",description:"",loading:o.robot_proxy_service_create_loading,children:(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)(p.f,{loader:(0,i.jsx)(u.k,{align:"center",direction:"column",children:(0,i.jsxs)(u.k,{align:"center",children:["部署机器人服务大约需要1分钟，请耐心等待",(0,i.jsx)(g.a,{variant:"bars",color:"pink",ml:12})]})}),overlayOpacity:.3,overlayColor:"#c5c5c5",visible:o.robot_proxy_service_create_loading}),(0,i.jsx)("div",{style:{padding:20},children:(0,i.jsx)(SetProxyService,{form:A})})]})}),S===T.kg.DING_TALK&&(0,i.jsx)(d.v.Step,{label:"机器人信息展示",description:"",children:(0,i.jsx)(ServiceConfigPreview,{})}),S===T.kg.DING_TALK&&(0,i.jsx)(d.v.Step,{label:"配置机器人Webhook",description:"",loading:o.robot_webhook_create_loading,children:(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)(p.f,{overlayOpacity:.3,overlayColor:"#c5c5c5",visible:o.robot_webhook_create_loading}),(0,i.jsx)("div",{style:{padding:20},children:(0,i.jsx)(RobotWebhookConfig,{form:E})})]})})]}),(0,i.jsx)(h.Z,{mt:"xl",children:S===T.kg.WECHAT?(0,i.jsx)(x.z,{onClick:nextStep,children:"确定"}):(0,i.jsxs)(i.Fragment,{children:[t>T.bb.AGENT_SERVICE?(0,i.jsx)(x.z,{variant:"default",onClick:()=>{let e=t>0?t-1:t;n(e)},children:"上一步"}):null,t===T.bb.AGENT_SERVICE?(0,i.jsx)(x.z,{onClick:nextStep,children:"下一步"}):null,t===T.bb.SERVICE_CONFIG_PREVIEW?(0,i.jsx)(x.z,{onClick:nextStepAction,children:"下一步"}):null,t===T.bb.ROBOT_WEBHOOK?(0,i.jsx)(x.z,{onClick:nextStep,children:"确定"}):null]})})]})}function IndexPage(){return(0,i.jsx)(Robot,{})}R.generateKeys(),R.getPublicKey("hex"),R.getPrivateKey("hex")},71346:function(e,t,n){"use strict";n.d(t,{E9:function(){return addApplication},RV:function(){return getApplications},qr:function(){return r},rw:function(){return deleteApplication}});var i=n(64529),o=n(782),a=n(2393);let r=(0,i.Ue)()((0,o.mW)(e=>({appList:[],open:!1,loading:!1,updateAppList:t=>e(e=>({appList:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t}))})));async function getApplications(){let e=r.getState(),t=e.updateAppList,n=await (0,a.W)("/api/application/list"),i=n.data;i&&t(i)}async function deleteApplication(e){return await (0,a.W)("/api/application/delete?id=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function addApplication(e){return await (0,a.W)("/api/application/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}},5638:function(e,t,n){"use strict";n.d(t,{Ow:function(){return createEventbus},bc:function(){return getClientAccessList},i7:function(){return deleteClientAccess},iZ:function(){return l},xn:function(){return createChatBotBridgeService}});var i=n(64529),o=n(782),a=n(43726),r=n(7374),c=n(2393);let l=(0,i.Ue)((0,o.mW)(e=>({clientAccessList:[],loading:!1,activeStep:r.bb.AGENT_SERVICE,agents:[],selectedAgent:{},robotStepStatus:{robot_proxy_service_create_loading:!1,robot_webhook_create_loading:!1},robotConfig:{robotProxyServiceConfig:{},robotWebhookConfig:{}},setLoading:t=>e(()=>({loading:t})),setOpen:t=>e(()=>({open:t})),updateClientAccessList:t=>e(e=>({clientAccessList:t})),setActiveStep:t=>{e({activeStep:t})},setRobotConfig:t=>{e({robotConfig:t})},setRobotStepStatus:t=>{e({robotStepStatus:t})}})));async function createChatBotBridgeService(e,t){return await (0,a.H)(e,t)}async function createEventbus(e){return await (0,c.W)("/api/clientAccess/eventbus",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function getClientAccessList(){let e=l.getState(),t=e.updateClientAccessList,n=await (0,c.W)("/api/infra/alibaba-cloud/listApps?appFilter=".concat(r.X_)),i=n.data;i&&t(i)}async function deleteClientAccess(e){return await (0,c.W)("/api/infra/alibaba-cloud/deleteApp?appName=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}},43726:function(e,t,n){"use strict";n.d(t,{H:function(){return createServerlessApp},p:function(){return checkAppStatus}});var i=n(2393);function checkAppStatus(e){return new Promise((t,n)=>{let o=setInterval(async()=>{try{let n=await (0,i.W)("/api/infra/alibaba-cloud/getApp?appName=".concat(e)),a=n.data.lastRelease;"published"===a.status&&(clearInterval(o),t(a))}catch(e){}},4e3)})}async function createServerlessApp(e,t){var n;let o=await (0,i.W)("/api/infra/alibaba-cloud/createApp?template=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return(null==o?void 0:null===(n=o.data)||void 0===n?void 0:n.name)||""}},29235:function(e,t,n){"use strict";n.d(t,{CH:function(){return updateKnowledgeBase},Co:function(){return getKnowledgeBaseList},I1:function(){return r},IV:function(){return getKnowledgeBase},Sk:function(){return getAccessUrl},eV:function(){return deleteKnowledgeBase},g$:function(){return refreshToken},uA:function(){return addKnowledgeBase}});var i=n(64529),o=n(782),a=n(2393);let r=(0,i.Ue)()((0,o.mW)(e=>({knowledgeBaseList:[],knowledgeBaseChatList:[],open:!1,chatDrawer:!1,loading:!1,isEdit:!1,accessUrl:{openApiUrl:"",innerApiUrl:""},currentKnowledgeBase:void 0,updateCurrentKnowledgeBase:t=>e(e=>({currentKnowledgeBase:t})),setChatDrawer:t=>e(e=>({chatDrawer:t})),setAccessUrl:t=>e(e=>({accessUrl:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateKnowledgeBaseList:t=>e(e=>({knowledgeBaseList:t}))})));async function getKnowledgeBaseList(e){let t=r.getState(),n=t.updateKnowledgeBaseList,i=await (0,a.W)("/api/knowledgeBase/list?appId=".concat(e)),o=i.data;o&&n(o)}async function getKnowledgeBase(e){let t=await (0,a.W)("/api/knowledgeBase/get?id=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});return t.data}async function addKnowledgeBase(e){return await (0,a.W)("/api/knowledgeBase/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function deleteKnowledgeBase(e){return await (0,a.W)("/api/knowledgeBase/delete?agentId=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function updateKnowledgeBase(e,t){return await (0,a.W)("/api/knowledgeBase/update?id=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}async function refreshToken(e){return await (0,a.W)("/api/knowledgeBase/token?agentId=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}})}async function getAccessUrl(){let e=await (0,a.W)("/api/knowledgeBase/getAccessUrl",{method:"GET",headers:{"Content-Type":"application/json"}});return e}},90589:function(e){e.exports={"copy-to-clipboard-content":"CopyToClipboard_copy-to-clipboard-content__cxI0e"}}},function(e){e.O(0,[714,871,855,322,642,516,13,774,888,179],function(){return e(e.s=19901)}),_N_E=e.O()}]);