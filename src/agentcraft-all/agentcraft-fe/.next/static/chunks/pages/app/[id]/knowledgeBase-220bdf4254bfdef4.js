(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{9049:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase",function(){return n(98617)}])},30372:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var s=n(85893),i=n(67294),a=n(88393),r=n(69876),l=n(95117),o=n(49834),c=n(88198),d=n(93625),u=n(37044),p=n.n(u);function h(e){let{value:t,content:n,truncate:u,width:h=300}=e,m=function(){let{timeout:e=2e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,i.useState)(null),[s,a]=(0,i.useState)(!1),[r,l]=(0,i.useState)(null),o=t=>{clearTimeout(r),l(setTimeout(()=>a(!1),e)),a(t)},c=e=>{if("clipboard"in navigator)navigator.clipboard.writeText(e).then(()=>o(!0)).catch(e=>n(e));else{let t=document.createElement("textarea");t.value=e,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(e){console.error(e)}finally{t.remove(),o(!0)}}},d=()=>{a(!1),n(null),clearTimeout(r)};return{copy:c,reset:d,error:t,copied:s}}({timeout:500});return(0,s.jsx)(a.u,{label:m.copied?"已复制":"复制",withArrow:!0,position:"right",children:(0,s.jsxs)(r.k,{onClick:()=>m.copy(t),mih:50,style:{width:h},gap:"xs",justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",children:[n?(0,s.jsx)(l.x,{truncate:u,className:p()["copy-to-clipboard-content"],children:n}):null,(0,s.jsx)(o.A,{color:m.copied?"teal":"gray",children:m.copied?(0,s.jsx)(c.Z,{size:"1rem"}):(0,s.jsx)(d.Z,{size:"1rem"})})]})})}},3658:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var s=n(85893),i=n(92716),a=n(95117),r=n(64523),l=n(69876),o=n(19236),c=n(91759);function d(e){let{detail:t,title:n}=e,[r,{open:l,close:o}]=(0,c.q)(!1);return(0,s.jsx)(s.Fragment,{children:t?(0,s.jsxs)("div",{children:[(0,s.jsx)(i.d,{opened:r,onClose:o,title:n,children:(0,s.jsx)(a.x,{children:t})}),(0,s.jsx)(a.x,{onClick:()=>l(),children:"信息"})]}):null})}function u(e){let{title:t,description:n,detail:i,mt:c,mb:u}=e;return(0,s.jsxs)(r.x,{mt:c||24,mb:u||24,children:[(0,s.jsxs)(l.k,{mih:20,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,s.jsx)(o.D,{order:2,children:t}),(0,s.jsx)(d,{title:t,detail:i})]}),n?(0,s.jsx)(a.x,{lineClamp:4,children:n}):null]})}},98617:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return ea},default:function(){return er}});var s,i,a,r,l,o,c=n(85893),d=n(67294),u=n(41664),p=n.n(u),h=n(69876),m=n(19236),x=n(82623),_=n(64523),g=n(80061),y=n(52615),f=n(54777),j=n(71232),w=n(31194),v=n(28855),b=n(14127),k=n(67841),S=n(94491),C=n(88393),z=n(92716),E=n(95117),T=n(17789),I=n(95078),L=n(54685),N=n(49737),O=n(93284),A=n(77248),B=n(91759),D=n(24350),P=n(85417),U=n(48847),M=n(77194),W=n(3658),Z=n(53483),q=n(61407),R=n(30372),H=n(20966),F=n(55299),J=n(34209),K=n(84283);let V={dark:K.YC,light:K.vs},Y=e=>{let{textContent:t,darkMode:n,language:s="txt"}=e;return(0,c.jsx)(J.Z,{style:V.dark,language:s,PreTag:"div",children:String(t).replace(/\n$/,"")})};var G=n(99979),X=n.n(G);let Q=e=>{let{textContent:t,darkMode:n,className:s}=e,[i,a]=(0,d.useState)(!1),r=async e=>{try{await navigator.clipboard.writeText(e)}catch(n){let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.log(e)}document.body.removeChild(t)}};return(0,c.jsx)(F.D,{linkTarget:"_blank",className:s,components:{code(e){let{node:s,inline:l,className:o,children:u,...p}=e,h=/language-(\w+)/.exec(o||"");return!l&&h?(0,c.jsxs)("div",{className:X()["code-container"],onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[(0,c.jsx)("button",{className:X()["copy-btn"],style:{visibility:i?"visible":"hidden"},onClick:()=>r(t),children:"Copy"}),(0,c.jsx)(d.Suspense,{children:(0,c.jsx)(Y,{darkMode:n,language:h[1],...p,textContent:String(u).replace(/\n$/,"")})})]}):(0,c.jsx)("code",{className:o,...p,children:u})}},children:t})};var $=n(27342);function ee(e){let{fromChat:t=!1}=e,n=(0,Z.s6)().currentKnowledgeBase,[s,i]=(0,d.useState)(""),[a,l]=(0,d.useState)(!1),[o,u]=(0,d.useState)(n.system_message?[{message:n.system_message,sourceIdx:-1,type:r.SYSTEM,showFeedback:!1,liked:!1,disLiked:!1}]:[]),p=(0,d.useRef)(null),h=(0,d.useRef)(null);(0,d.useEffect)(()=>{let e=p.current;e.scrollTop=e.scrollHeight},[o]),(0,d.useEffect)(()=>{h.current.focus()},[]);let m=e=>{u(t=>[...t,{message:e.message,type:r.ASSISTANT,sourceIdx:-1,showFeedback:!1,liked:!1,disLiked:!1}]),l(!1),i("")},x=async e=>{if(e.preventDefault(),""===s.trim())return;let t=[...o,{message:s,type:r.USER,sourceIdx:-1,showFeedback:!1,liked:!1,disLiked:!1}];l(!0),u(t);try{let e=JSON.parse(JSON.stringify(t)),a={message:"",type:"assistant",sourceIdx:-1,showFeedback:!1,liked:!1,disLiked:!1};i(""),await (0,$.dr)({messages:[{role:"user",content:s}],config:{stream:!0,max_tokens:1024},onFinish:e=>{l(!1)},onUpdate:(t,n)=>{a.message+=n,console.log(n,"delta"),u([...e,a])}},n.token)}catch(e){m(e)}},_=e=>{13===e.keyCode&&s?!e.shiftKey&&s&&x(e):"Enter"===e.key&&e.preventDefault()};return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("main",{className:X().main,children:[(0,c.jsx)("div",{className:X().cloud,children:(0,c.jsx)("div",{ref:p,className:X().messagelist,children:o.map((e,t)=>(0,c.jsxs)("div",{className:e.type===r.USER&&a&&t===o.length-1?X().usermessagewaiting:e.type!==r.USER?X().apimessage:X().usermessage,children:[e.type!==r.USER?(0,c.jsx)("div",{className:X().avatar,onClick:m,children:(0,c.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2573",width:"24",height:"24",children:(0,c.jsx)("path",{fill:"#E4782C",d:"M512 1024c-80.64-74.88-77.354667-159.701333-77.354667-159.701333h154.709334S592.64 949.12 512 1024z m0-939.178667c-68.053333 89.856-200.234667 294.101333-200.234667 524.416 0 66.645333 12.501333 122.453333 25.130667 161.834667h350.208c12.629333-39.381333 25.130667-95.189333 25.130667-161.834667 0-230.314667-132.181333-434.56-200.234667-524.416z m253.866667 524.416c0 151.722667-58.154667 251.861333-58.154667 251.861334l-62.208-36.394667H378.496l-62.208 36.394667S258.133333 760.96 258.133333 609.237333C258.133333 275.029333 511.914667 0.085333 512 0c0.085333 0.085333 253.866667 275.029333 253.866667 609.237333z m35.114666 99.626667c0 58.154667-25.813333 121.386667-43.605333 148.053333h123.264l-13.653333-83.84-66.005334-64.213333zM157.013333 773.12l-13.653333 83.84h123.264c-17.834667-26.666667-43.605333-89.898667-43.605333-148.053333L157.013333 773.12z m306.645334-242.005333a11.946667 11.946667 0 1 0 0 23.808 11.946667 11.946667 0 0 0 0-23.808z m38.186666 0a11.946667 11.946667 0 1 0 0 23.808 11.946667 11.946667 0 0 0 0-23.808z m38.186667 0a11.946667 11.946667 0 1 0 0 23.808 11.946667 11.946667 0 0 0 0-23.808z m130.474667 150.698666a61.653333 61.653333 0 1 1-115.2-30.677333l-15.402667-21.034667a94.677333 94.677333 0 0 1-99.626667-14.72l-17.194666 14.933334a36.906667 36.906667 0 1 1-36.053334-29.184c4.437333 0 8.618667 0.896 12.544 2.346666l18.304-15.914666a94.592 94.592 0 0 1 8.277334-101.973334l-19.242667-20.906666c-1.408 0.170667-2.773333 0.426667-4.181333 0.426666a31.36 31.36 0 1 1 30.549333-24.490666l19.413333 21.12a94.592 94.592 0 0 1 95.872-1.536l16.426667-16.426667a48.810667 48.810667 0 1 1 30.293333 30.293333l-15.061333 15.061334a94.634667 94.634667 0 0 1-5.888 115.370666l14.037333 19.157334c6.442667-2.261333 13.312-3.584 20.522667-3.584a61.738667 61.738667 0 0 1 61.610667 61.738666z m-168.661334-63.957333a74.837333 74.837333 0 1 0 0-149.632 74.837333 74.837333 0 0 0 0 149.632z","p-id":"2574"})})}):(0,c.jsx)("div",{className:X().avatar,children:(0,c.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3538",width:"24",height:"24",children:(0,c.jsx)("path",{d:"M858.5 763.6c-18.9-44.8-46.1-85-80.6-119.5-34.5-34.5-74.7-61.6-119.5-80.6-0.4-0.2-0.8-0.3-1.2-0.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-0.4 0.2-0.8 0.3-1.2 0.5-44.8 18.9-85 46-119.5 80.6-34.5 34.5-61.6 74.7-80.6 119.5C146.9 807.5 137 854 136 901.8c-0.1 4.5 3.5 8.2 8 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c0.1 4.4 3.6 7.8 8 7.8h60c4.5 0 8.1-3.7 8-8.2-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z","p-id":"3539"})})}),(0,c.jsx)("div",{className:X().markdownanswer,children:(0,c.jsx)(Q,{textContent:e.message})})]},t))})}),(0,c.jsx)("div",{className:X().center,children:(0,c.jsx)("div",{className:X().cloudform,children:(0,c.jsxs)("form",{style:{width:"100%"},onSubmit:x,children:[(0,c.jsx)("textarea",{disabled:a,onKeyDown:_,ref:h,autoFocus:!1,rows:1,maxLength:512,id:"userInput",name:"userInput",placeholder:a?"等待回复中":"请输入你的问题",value:s,onChange:e=>i(e.target.value),className:X().textarea}),(0,c.jsx)("button",{type:"submit",disabled:a,className:X().generatebutton,children:a?(0,c.jsx)(H.a,{}):(0,c.jsx)("svg",{viewBox:"0 0 20 20",className:X().svgicon,xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})})})]})})}function et(e){let{appId:t,containerType:n}=e,s=(0,Z.s6)().setOpen,i=(0,Z.s6)().isEdit,a=(0,Z.s6)().currentKnowledgeBase,r=(0,Z.s6)().setLoading,l=(0,D.s6)().modelList,u=(0,P.s6)().dataSetList,p=(0,A.c)({initialValues:{name:"",description:"",prompt_template:"已知信息：【{context}】。你需要积极，简洁和专业地来回答```中的问题。如果问题和已知信息没有关系，或者问题存在争议性，请说 “抱歉，无法回答该问题”，不允许编造。问题是：```{query}```",app_id:parseInt(t),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:"",exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"知识库名必填"}});(0,d.useEffect)(()=>{if((0,D.fZ)(),(0,P.ln)(),i){let e=null==a?void 0:a.datasets;p.setValues({id:null==a?void 0:a.id,name:null==a?void 0:a.name,description:null==a?void 0:a.description,prompt_template:null==a?void 0:a.prompt_template,app_id:null==a?void 0:a.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===M.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===M.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==a?void 0:a.exact_search_limit,fuzzy_search_similarity:null==a?void 0:a.fuzzy_search_similarity,temperature:null==a?void 0:a.temperature,top_p:null==a?void 0:a.top_p,n_sequences:null==a?void 0:a.n_sequences,max_tokens:null==a?void 0:a.max_tokens,stop:null==a?void 0:a.stop,presence_penalty:null==a?void 0:a.presence_penalty,frequency_penalty:null==a?void 0:a.frequency_penalty,logit_bias:null==a?void 0:a.logit_bias,model_id:null==a?void 0:a.model_id,redis_ip_ex:null==a?void 0:a.redis_ip_ex,redis_history_ex:null==a?void 0:a.redis_history_ex,model_ip_limit:null==a?void 0:a.model_ip_limit,llm_history_len:null==a?void 0:a.llm_history_len,system_message:null==a?void 0:a.system_message,exact_search_limit:null==a?void 0:a.exact_search_limit,fuzzy_search_limit:null==a?void 0:a.fuzzy_search_limit})}},[a]);let S=l.map(e=>({label:e.name_alias,value:e.id})),C=u.filter(e=>e.dataset_type==M.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),z=u.filter(e=>e.dataset_type==M.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,c.jsxs)(h.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,c.jsxs)(h.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[(0,c.jsxs)("div",{style:{width:"50%"},children:[n!==o.CHAT?(0,c.jsx)(m.D,{order:4,mb:8,children:"基础设置"}):null,(0,c.jsxs)(x.X,{shadow:"xs",p:"md",withBorder:!0,children:[n!==o.CHAT?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.D,{order:5,size:"h5",children:"知识库"}),(0,c.jsxs)(_.x,{maw:q.cy,pl:4,pr:4,children:[(0,c.jsx)(g.o,{withAsterisk:!0,label:"名称",placeholder:"输入知识库名称",...p.getInputProps("name")}),(0,c.jsx)(y.g,{label:"描述",placeholder:"输入应用描述",...p.getInputProps("description")})]}),(0,c.jsx)(f.i,{my:"sm"})]}):null,(0,c.jsx)(m.D,{order:5,size:"h5",children:"提示词"}),(0,c.jsxs)(_.x,{maw:q.cy,pl:4,pr:4,children:[(0,c.jsx)(y.g,{label:"系统提示词",placeholder:"输入系统提示词",...p.getInputProps("system_message"),description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),(0,c.jsx)(y.g,{withAsterisk:!0,label:"提示词模板",placeholder:"",...p.getInputProps("prompt_template"),minRows:6,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),(0,c.jsx)(f.i,{my:"sm"}),(0,c.jsx)(m.D,{order:5,size:"h5",children:"数据集"}),(0,c.jsx)(_.x,{maw:q.cy,pl:4,pr:4,children:(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(w.NU,{data:C,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...p.getInputProps("fuzzy_datasets")}),(0,c.jsx)(w.NU,{data:z,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...p.getInputProps("exact_datasets")})]})}),(0,c.jsx)(f.i,{my:"sm"}),(0,c.jsx)(m.D,{order:5,size:"h5",children:"基础模型"}),(0,c.jsx)(_.x,{maw:q.cy,pl:4,pr:4,mb:12,children:(0,c.jsx)(v.Ph,{withAsterisk:!0,data:S,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...p.getInputProps("model_id")})}),(0,c.jsx)(f.i,{my:"sm"})]})]}),(0,c.jsxs)("div",{style:{width:"50%"},children:[n!==o.CHAT?(0,c.jsx)(m.D,{order:4,mb:8,children:"高级设置"}):null,(0,c.jsxs)(x.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,c.jsx)(m.D,{order:5,size:"h5",children:"答案召回"}),(0,c.jsxs)(_.x,{maw:q.cy,pl:4,pr:4,children:[(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(g.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...p.getInputProps("fuzzy_search_similarity")}),(0,c.jsx)(g.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...p.getInputProps("exact_search_similarity")})]}),(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(b.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...p.getInputProps("fuzzy_search_limit")}),(0,c.jsx)(b.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...p.getInputProps("exact_search_limit")})]})]}),(0,c.jsx)(f.i,{my:"sm"}),(0,c.jsx)(m.D,{order:5,size:"h5",children:"大语言模型参数"}),(0,c.jsxs)(_.x,{maw:q.cy,pl:4,pr:4,children:[(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(g.o,{withAsterisk:!0,label:"temperature",placeholder:"",...p.getInputProps("temperature")}),(0,c.jsx)(g.o,{withAsterisk:!0,label:"top_p",placeholder:"",...p.getInputProps("top_p")})]}),(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(g.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...p.getInputProps("n_sequences")}),(0,c.jsx)(g.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...p.getInputProps("max_tokens")})]}),(0,c.jsxs)(j.Z,{grow:!0,children:[(0,c.jsx)(g.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...p.getInputProps("presence_penalty")}),(0,c.jsx)(g.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...p.getInputProps("frequency_penalty")})]}),(0,c.jsx)(g.o,{label:"logit_bias",placeholder:"",...p.getInputProps("logit_bias"),width:"50%"})]}),(0,c.jsx)(f.i,{my:"sm"})]})]})]}),(0,c.jsx)(_.x,{maw:q.cy,pt:4,style:{textAlign:"center",width:"100%"},children:(0,c.jsx)(k.z,{style:{width:"100%"},onClick:async()=>{if(p.validate(),p.isValid()){r(!0);let e=p.values;i?await (0,Z.CH)(e.id,e):await (0,Z.uA)(e),await (0,Z.Co)(t),s(!1),r(!1)}},children:"确认"})})]})}function en(e){let{appId:t}=e,n=(0,Z.s6)().open,s=(0,Z.s6)().setOpen,i=(0,Z.s6)().isEdit,a=(0,Z.s6)().setEditStatus;return(0,c.jsx)(S.u,{opened:n,onClose:()=>{a(!1),s(!1)},title:i?"编辑知识库":"创建知识库",centered:!0,size:"55%",children:(0,c.jsx)(et,{appId:t})})}function es(e){let{appId:t}=e,n=(0,Z.s6)().knowledgeBaseList,s=(0,Z.s6)().setLoading,i=(0,Z.s6)().updateCurrentKnowledgeBase,a=(0,Z.s6)().setEditStatus,r=(0,Z.s6)().setOpen,[l,{open:u,close:m}]=(0,B.q)(!1),x=async e=>{try{s(!0),await (0,Z.g$)(e),await (0,Z.Co)(t)}catch(e){console.log(e)}finally{s(!1)}},_=n.map(e=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{style:{width:20},children:e.id}),(0,c.jsx)("td",{style:{width:100},children:(0,c.jsx)(p(),{href:"/app/".concat(t,"/knowledgeBase/").concat(e.id,"/detail"),children:e.name})}),(0,c.jsx)("td",{style:{width:100},children:e.description}),(0,c.jsx)("td",{style:{width:200},children:e.system_message}),(0,c.jsx)("td",{style:{width:300},children:(0,c.jsx)(R.Z,{value:e.prompt_template,content:e.prompt_template})}),(0,c.jsx)("td",{children:e.token?(0,c.jsx)(R.Z,{value:e.token,content:e.token,truncate:!0}):(0,c.jsx)(k.z,{color:"lime",size:"xs",compact:!0,onClick:()=>x(e.id),children:"生成访问令牌"})}),(0,c.jsx)("td",{children:(0,U.o)(e.created)}),(0,c.jsxs)("td",{children:[e.token?(0,c.jsx)(k.z,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{a(!0);let t=await (0,Z.IV)(e.id);i(t),u()},mr:4,children:"问答测试"}):(0,c.jsx)(C.u,{label:"需要成访问令牌才可以访问此能力",children:(0,c.jsx)(k.z,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),(0,c.jsx)(k.z,{variant:"filled",size:"xs",onClick:async()=>{a(!0);let t=await (0,Z.IV)(e.id);i(t),r(!0)},mr:4,children:"编辑"}),(0,c.jsx)(k.z,{variant:"filled",color:"red",size:"xs",onClick:()=>{},children:"删除"})]})]},e.id)),g=async()=>{s(!0);try{await (0,Z.Co)(t)}catch(e){}s(!1)};return(0,d.useEffect)(()=>{g()},[t]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(z.d,{opened:l,onClose:m,title:(0,c.jsxs)("div",{children:[(0,c.jsx)(E.x,{fz:"xl",children:"知识库调试"}),(0,c.jsx)(E.x,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整知识库问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,c.jsxs)(h.k,{mih:50,direction:"row",children:[(0,c.jsxs)("div",{style:{width:"60%"},children:[(0,c.jsx)("div",{style:{marginBottom:12},children:(0,c.jsx)(T.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"知识库参数设置"})}),(0,c.jsx)(et,{appId:t,containerType:o.CHAT})]}),(0,c.jsxs)("div",{style:{marginLeft:12,borderLeft:"1px solid #eee",paddingLeft:8,width:"40%"},children:[(0,c.jsx)("div",{children:(0,c.jsx)(T.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"知识库问答"})}),(0,c.jsx)(ee,{})]})]})}),(0,c.jsxs)(I.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"编号"}),(0,c.jsx)("th",{children:"名称"}),(0,c.jsx)("th",{children:"描述"}),(0,c.jsx)("th",{children:"系统提示词"}),(0,c.jsx)("th",{children:"完整提示词"}),(0,c.jsx)("th",{children:"访问token"}),(0,c.jsx)("th",{children:"创建时间"}),(0,c.jsx)("th",{children:"操作"})]})}),(0,c.jsx)("tbody",{children:_})]})]})}function ei(e){let{appId:t}=e,n=(0,Z.s6)().loading,s=[{title:"应用列表",href:"/app"},{title:"知识库",href:"/app/".concat(t,"/knowledgeBase")}].map((e,t)=>(0,c.jsx)(L.e,{href:e.href,children:e.title},t)),i=(0,Z.s6)().setOpen;return(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)(N.f,{visible:n,overlayOpacity:.3}),(0,c.jsx)(O.O,{children:s}),(0,c.jsx)(W.Z,{title:"知识库",description:"知识库使用RAG(Retrieval-Augmented Generation 检索增强生成)技术来将大语言模型跟数据进行结合，以实现更准确的预测"}),(0,c.jsx)(_.x,{children:(0,c.jsx)(k.z,{onClick:()=>i(!0),children:"新建知识库"})}),(0,c.jsx)(en,{appId:t}),(0,c.jsx)(es,{appId:t})]})}(s=r||(r={})).SYSTEM="system",s.USER="user",s.ASSISTANT="assistant",(i=l||(l={}))[i.NOTLABELED=0]="NOTLABELED",i[i.NEUTRAL=2]="NEUTRAL",i[i.POSITIVE=1]="POSITIVE",(a=o||(o={}))[a.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",a[a.CHAT=2]="CHAT";var ea=!0;function er(e){let{appId:t}=e;return(0,c.jsx)(ei,{appId:t})}},27342:function(e,t,n){"use strict";n.d(t,{dr:function(){return x},Ag:function(){return m},aK:function(){return h}});var s=n(33250),i={Error:{Unauthorized:"无权限"}};let a={cn:i},r=Object.keys(a),l=a[function(){let e=function(e){try{return localStorage.getItem(e)}catch(e){return null}}("lang");if(r.includes(null!=e?e:""))return e;let t=function(){try{return navigator.language.toLowerCase()}catch(e){return"cn"}}();for(let e of r)if(t.includes(e))return e;return"cn"}()];!function e(t,n){Object.keys(n).forEach(function(s){if(n[s]&&"object"==typeof n[s]){e(t[s]=t[s]||{},n[s]);return}t[s]=n[s]})}(i,l);var o=n(64529),c=n(61407),d=n(98597),u=n(782),p=n(71791);let h=(0,o.Ue)()((0,u.mW)(e=>({chatList:[],open:!1,loading:!1,isEdit:!1,currentChatItem:{},updateCurrentChatItem:t=>e(e=>({currentChatItem:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateChatList:t=>e(e=>({chatList:t}))})));async function m(e){let t=h.getState(),n=t.updateChatList,s=await (0,p.W)("/api/chat/chatlist?id=".concat(e)),i=s.data;i&&n(i)}async function x(e,t){var n;let a=new AbortController;null===(n=e.onController)||void 0===n||n.call(e,a);let r=await {method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:JSON.stringify(Object.assign({},e,{token:t}))},l=setTimeout(()=>a.abort(),c.tb),o="",u=!1,p=()=>{u||(e.onFinish(o),u=!0)};a.signal.onabort=p,(0,s.L)("/api/chat",{...r,async onopen(e){var t;clearTimeout(l);let n=e.headers.get("content-type");if(console.log("AgentCraft request response content type: ",n),null==n?void 0:n.startsWith("text/plain"))return o=await e.clone().text(),p();if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.startsWith(s.a))||200!==e.status){let t=[o],n=await e.clone().text();try{let t=await e.clone().json();n=(0,d.Bs)(t)}catch(e){}return 401===e.status&&t.push(i.Error.Unauthorized),n&&t.push(n),o=t.join("\n\n"),p()}},onmessage(t){if("[DONE]"===t.data||u)return p();let n=t.data;try{let t=JSON.parse(n),i=t.choices[0].delta.content;if(i){var s;o+=i,null===(s=e.onUpdate)||void 0===s||s.call(e,o,i)}}catch(e){console.error("[Request] parse error",n,t)}},onclose(){p()},onerror(t){var n;throw null===(n=e.onError)||void 0===n||n.call(e,t),t},openWhenHidden:!0})}},85417:function(e,t,n){"use strict";n.d(t,{cv:function(){return c},ln:function(){return l},s6:function(){return r},uo:function(){return o}});var s=n(64529),i=n(782),a=n(71791);let r=(0,s.Ue)()((0,i.mW)(e=>({dataSetList:[],open:!1,loading:!1,updateDataSetList:t=>e(e=>({dataSetList:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t}))})));async function l(){let e=r.getState(),t=e.updateDataSetList,n=await (0,a.W)("/api/dataset/list"),s=n.data;s&&t(s)}async function o(e){return await (0,a.W)("/api/dataset/delete?id=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function c(e){return await (0,a.W)("/api/dataset/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}},53483:function(e,t,n){"use strict";n.d(t,{CH:function(){return d},Co:function(){return l},IV:function(){return o},g$:function(){return u},s6:function(){return r},uA:function(){return c}});var s=n(64529),i=n(782),a=n(71791);let r=(0,s.Ue)()((0,i.mW)(e=>({knowledgeBaseList:[],knowledgeBaseChatList:[],open:!1,loading:!1,isEdit:!1,updateCurrentKnowledgeBase:t=>e(e=>({currentKnowledgeBase:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateKnowledgeBaseList:t=>e(e=>({knowledgeBaseList:t}))})));async function l(e){let t=r.getState(),n=t.updateKnowledgeBaseList,s=await (0,a.W)("/api/knowledgeBase/list?appId=".concat(e)),i=s.data;i&&n(i)}async function o(e){let t=await (0,a.W)("/api/knowledgeBase/get?id=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});return t.data}async function c(e){return await (0,a.W)("/api/knowledgeBase/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function d(e,t){return await (0,a.W)("/api/knowledgeBase/update?id=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}async function u(e){return await (0,a.W)("/api/knowledgeBase/token?agentId=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}})}},24350:function(e,t,n){"use strict";n.d(t,{$s:function(){return o},QB:function(){return d},fZ:function(){return l},mS:function(){return c},s6:function(){return r}});var s=n(64529),i=n(782),a=n(71791);let r=(0,s.Ue)()((0,i.mW)(e=>({modelList:[],loading:!1,open:!1,isEdit:!1,updateCurrentModel:t=>e(e=>({currentModel:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateModelList:t=>e(e=>({modelList:t}))})));async function l(){let e=r.getState(),t=e.updateModelList,n=await (0,a.W)("/api/model/list"),s=await n.data;s&&t(s)}async function o(e){return await (0,a.W)("/api/model/delete?id=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function c(e){return await (0,a.W)("/api/model/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function d(e,t){return await (0,a.W)("/api/model/update?id=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}},77194:function(e,t,n){"use strict";var s,i;n.d(t,{I:function(){return s}}),(i=s||(s={}))[i.QUESTION=1]="QUESTION",i[i.DOCUMENT=2]="DOCUMENT"},98597:function(e,t,n){"use strict";function s(e){let t=e;try{t=JSON.parse(e)}catch(e){console.error("Invalid URI sequence",e)}return t}function i(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}n.d(t,{Bs:function(){return i},pI:function(){return s}})},48847:function(e,t,n){"use strict";function s(e){let t=new Date(e),n=t.getFullYear(),s=(1+t.getMonth()).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),a=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),l=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(s,"-").concat(i," ").concat(a,":").concat(r,":").concat(l)}n.d(t,{o:function(){return s}})},37044:function(e){e.exports={"copy-to-clipboard-content":"CopyToClipboard_copy-to-clipboard-content__fv4wW"}},99979:function(e){e.exports={header:"chat_header__hHER5",apptitle:"chat_apptitle__B3npV",appdescription:"chat_appdescription__vZ9FM",avatar:"chat_avatar__wXfts",link:"chat_link__zjpnr",cloudform:"chat_cloudform__au_vs",textarea:"chat_textarea__9vQ_K",generatebutton:"chat_generatebutton__o27ml",loadingwheel:"chat_loadingwheel__Yow4D",svgicon:"chat_svgicon__tyh_s",messagelist:"chat_messagelist__JEIse",messagelistloading:"chat_messagelistloading__BHTi2",usermessage:"chat_usermessage__cXbBX",usermessagewaiting:"chat_usermessagewaiting__z1r1q",apimessage:"chat_apimessage__lAq52",fadein:"chat_fadein__CJeAc",markdownanswer:"chat_markdownanswer__5IpAO",boticon:"chat_boticon__YscfB",usericon:"chat_usericon__p8gNB",center:"chat_center__GrDZB",cloud:"chat_cloud__0GuLb",pointsnormal:"chat_pointsnormal__6Kvc9",pointsdim:"chat_pointsdim__Z33LI",footer:"chat_footer__GbVW_","code-container":"chat_code-container__Zkhic","copy-btn":"chat_copy-btn__dDi51","feedback-container":"chat_feedback-container__c1YR_","chat-container":"chat_chat-container__uSHvy","loading-gradient":"chat_loading-gradient__74jiP"}}},function(e){e.O(0,[121,586,871,664,946,855,194,775,774,888,179],function(){return e(e.s=9049)}),_N_E=e.O()}]);