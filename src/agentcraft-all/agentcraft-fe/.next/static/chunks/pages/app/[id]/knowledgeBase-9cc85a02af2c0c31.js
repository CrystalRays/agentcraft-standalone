(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{95033:function(e,t,l){"use strict";l.d(t,{y:function(){return w}});var i=l(67294),r=l(3241),s=l(48427),a=l(95117),n=(0,l(56817).k)((e,{color:t})=>({root:{backgroundColor:e.fn.themeColor(t,"dark"===e.colorScheme?5:2),color:"dark"===e.colorScheme?e.colors.dark[9]:"inherit"}})),o=l(64523),d=Object.defineProperty,c=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,l)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,__spreadValues=(e,t)=>{for(var l in t||(t={}))p.call(t,l)&&__defNormalProp(e,l,t[l]);if(c)for(var l of c(t))h.call(t,l)&&__defNormalProp(e,l,t[l]);return e},__objRest=(e,t)=>{var l={};for(var i in e)p.call(e,i)&&0>t.indexOf(i)&&(l[i]=e[i]);if(null!=e&&c)for(var i of c(e))0>t.indexOf(i)&&h.call(e,i)&&(l[i]=e[i]);return l};let m={color:"yellow"},x=(0,i.forwardRef)((e,t)=>{let l=(0,r.N4)("Mark",m,e),{color:s,className:a,unstyled:d,variant:c}=l,p=__objRest(l,["color","className","unstyled","variant"]),{classes:h,cx:x}=n({color:s},{unstyled:d,name:"Mark",variant:c});return i.createElement(o.x,__spreadValues({component:"mark",ref:t,className:x(h.root,a)},p))});function escapeRegex(e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}x.displayName="@mantine/core/Mark";var u=Object.defineProperty,_=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,Highlight_defNormalProp=(e,t,l)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,Highlight_spreadValues=(e,t)=>{for(var l in t||(t={}))g.call(t,l)&&Highlight_defNormalProp(e,l,t[l]);if(_)for(var l of _(t))j.call(t,l)&&Highlight_defNormalProp(e,l,t[l]);return e},Highlight_objRest=(e,t)=>{var l={};for(var i in e)g.call(e,i)&&0>t.indexOf(i)&&(l[i]=e[i]);if(null!=e&&_)for(var i of _(e))0>t.indexOf(i)&&j.call(e,i)&&(l[i]=e[i]);return l};let y={highlightColor:"yellow"},f=(0,i.forwardRef)((e,t)=>{let l=(0,r.N4)("Highlight",y,e),{children:s,highlight:n,highlightColor:o,highlightStyles:d,unstyled:c}=l,p=Highlight_objRest(l,["children","highlight","highlightColor","highlightStyles","unstyled"]),h=function(e,t){if(null==t)return[{chunk:e,highlighted:!1}];let l=Array.isArray(t)?t.map(escapeRegex):escapeRegex(t),i=Array.isArray(l)?l.filter(e=>e.trim().length>0).length>0:""!==l.trim();if(!i)return[{chunk:e,highlighted:!1}];let r="string"==typeof l?l.trim():l.filter(e=>0!==e.trim().length).map(e=>e.trim()).join("|"),s=RegExp(`(${r})`,"gi"),a=e.split(s).map(e=>({chunk:e,highlighted:s.test(e)})).filter(({chunk:e})=>e);return a}(s,n);return i.createElement(a.x,Highlight_spreadValues({unstyled:c,ref:t,__staticSelector:"Highlight"},p),h.map(({chunk:e,highlighted:t},l)=>t?i.createElement(x,{unstyled:c,key:l,color:o,sx:d,"data-highlight":e},e):i.createElement("span",{key:l},e)))});f.displayName="@mantine/core/Highlight";let w=(0,s.F)(f)},9049:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase",function(){return l(21551)}])},21551:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSP:function(){return Z},default:function(){return IndexPage}});var i,r,s=l(85893),a=l(67294),n=l(41664),o=l.n(n),d=l(69876),c=l(19236),p=l(82623),h=l(64523),m=l(80061),x=l(54777),u=l(52615),_=l(28855),g=l(71232),j=l(31194),y=l(14127),f=l(67841),w=l(94491),v=l(92716),b=l(95117),k=l(17789),z=l(95033),P=l(55652),I=l(95078),C=l(54685),O=l(49737),A=l(93284),E=l(77248),N=l(73344),L=l(91939),D=l(61494),B=l(25288),R=l(13962),H=l(2394),S=l(29235),T=l(86105),q=l(918),M=l(17120);function KnowledgeBaseForm(e){let{appId:t,containerType:l}=e,i=(0,S.s6)().setOpen,r=(0,S.s6)().isEdit,n=(0,S.s6)().currentKnowledgeBase,o=(0,S.s6)().setLoading,w=(0,L.s6)().modelList,v=(0,D.s6)().dataSetList,b=(0,E.c)({initialValues:{name:"",description:"",prompt_template:T.Gf,app_id:parseInt(t),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:T.cl,exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"智能体名必填"}});(0,a.useEffect)(()=>{if((0,L.fZ)(),(0,D.ln)(),r){let e=null==n?void 0:n.datasets;b.setValues({id:null==n?void 0:n.id,name:null==n?void 0:n.name,description:null==n?void 0:n.description,prompt_template:null==n?void 0:n.prompt_template,app_id:null==n?void 0:n.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===R.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===R.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==n?void 0:n.exact_search_limit,fuzzy_search_similarity:null==n?void 0:n.fuzzy_search_similarity,temperature:null==n?void 0:n.temperature,top_p:null==n?void 0:n.top_p,n_sequences:null==n?void 0:n.n_sequences,max_tokens:null==n?void 0:n.max_tokens,stop:null==n?void 0:n.stop,presence_penalty:null==n?void 0:n.presence_penalty,frequency_penalty:null==n?void 0:n.frequency_penalty,logit_bias:null==n?void 0:n.logit_bias,model_id:null==n?void 0:n.model_id,redis_ip_ex:null==n?void 0:n.redis_ip_ex,redis_history_ex:null==n?void 0:n.redis_history_ex,model_ip_limit:null==n?void 0:n.model_ip_limit,llm_history_len:null==n?void 0:n.llm_history_len,system_message:null==n?void 0:n.system_message,exact_search_limit:null==n?void 0:n.exact_search_limit,fuzzy_search_limit:null==n?void 0:n.fuzzy_search_limit})}},[n]);let k=w.map(e=>({label:e.name_alias,value:e.id})),z=v.filter(e=>e.dataset_type==R.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),P=v.filter(e=>e.dataset_type==R.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,s.jsxs)(d.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,s.jsxs)(d.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[(0,s.jsxs)("div",{style:{width:"50%"},children:[2!==l?(0,s.jsx)(c.D,{order:4,mb:8,children:"基础设置"}):null,(0,s.jsxs)(p.X,{shadow:"xs",p:"md",withBorder:!0,children:[2!==l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.D,{order:5,size:"h5",children:"智能体"}),(0,s.jsxs)(h.x,{maw:T.cy,pl:4,pr:4,children:[(0,s.jsx)(m.o,{withAsterisk:!0,label:"名称",placeholder:"输入智能体名称",...b.getInputProps("name")}),(0,s.jsx)(m.o,{label:"描述",placeholder:"输入应用描述",...b.getInputProps("description")})]}),(0,s.jsx)(x.i,{my:"sm"})]}):null,(0,s.jsx)(c.D,{order:5,size:"h5",children:"提示词"}),(0,s.jsxs)(h.x,{maw:T.cy,pl:4,pr:4,children:[(0,s.jsx)(u.g,{label:"系统提示词",placeholder:"输入系统提示词",...b.getInputProps("system_message"),minRows:2!==l?2:8,description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),(0,s.jsx)(u.g,{label:"提示词模板",placeholder:"",...b.getInputProps("prompt_template"),minRows:2!==l?6:8,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),(0,s.jsx)(x.i,{my:"sm"}),(0,s.jsx)(c.D,{order:5,size:"h5",children:"基础模型"}),(0,s.jsx)(h.x,{maw:T.cy,pl:4,pr:4,mb:12,children:(0,s.jsx)(_.Ph,{withAsterisk:!0,data:k,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...b.getInputProps("model_id")})}),(0,s.jsx)(x.i,{my:"sm"})]})]}),(0,s.jsxs)("div",{style:{width:"50%"},children:[2!==l?(0,s.jsx)(c.D,{order:4,mb:8,children:"高级设置"}):null,(0,s.jsxs)(p.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,s.jsx)(c.D,{order:5,size:"h5",children:"数据集"}),(0,s.jsx)(h.x,{maw:T.cy,pl:4,pr:4,children:(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(j.NU,{data:z,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...b.getInputProps("fuzzy_datasets")}),(0,s.jsx)(j.NU,{data:P,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...b.getInputProps("exact_datasets")})]})}),(0,s.jsx)(x.i,{my:"sm"}),(0,s.jsx)(c.D,{order:5,size:"h5",children:"答案召回"}),(0,s.jsxs)(h.x,{maw:T.cy,pl:4,pr:4,mt:4,children:[(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(m.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...b.getInputProps("fuzzy_search_similarity")}),(0,s.jsx)(m.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...b.getInputProps("exact_search_similarity")})]}),(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(y.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...b.getInputProps("fuzzy_search_limit")}),(0,s.jsx)(y.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...b.getInputProps("exact_search_limit")})]})]}),(0,s.jsx)(x.i,{my:"sm"}),(0,s.jsx)(c.D,{order:5,size:"h5",children:"大语言模型参数"}),(0,s.jsxs)(h.x,{maw:T.cy,pl:4,pr:4,mt:4,children:[(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(m.o,{withAsterisk:!0,label:"temperature",placeholder:"",...b.getInputProps("temperature")}),(0,s.jsx)(m.o,{withAsterisk:!0,label:"top_p",placeholder:"",...b.getInputProps("top_p")})]}),(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(m.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...b.getInputProps("n_sequences")}),(0,s.jsx)(m.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...b.getInputProps("max_tokens")})]}),(0,s.jsxs)(g.Z,{grow:!0,children:[(0,s.jsx)(m.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...b.getInputProps("presence_penalty")}),(0,s.jsx)(m.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...b.getInputProps("frequency_penalty")})]}),(0,s.jsx)(m.o,{label:"logit_bias",placeholder:"",...b.getInputProps("logit_bias"),width:"50%"})]}),(0,s.jsx)(x.i,{my:"sm"})]})]})]}),(0,s.jsx)(h.x,{maw:T.cy,pt:4,style:{textAlign:"center",width:"100%"},children:(0,s.jsx)(f.z,{style:{width:"100%"},onClick:async()=>{if(b.validate(),b.isValid()){o(!0);let e=b.values;r?await (0,S.CH)(e.id,e):await (0,S.uA)(e),await (0,S.Co)(t),i(!1),o(!1)}},children:"确认"})})]})}function AddOrUpdate(e){let{appId:t}=e,l=(0,S.s6)().open,i=(0,S.s6)().setOpen,r=(0,S.s6)().isEdit,a=(0,S.s6)().setEditStatus;return(0,s.jsx)(w.u,{opened:l,onClose:()=>{a(!1),i(!1)},title:r?"编辑智能体":"创建智能体",centered:!0,size:"55%",children:(0,s.jsx)(KnowledgeBaseForm,{appId:t})})}function ChatDrawer(e){let{appId:t}=e,l=(0,S.s6)().chatDrawer,i=(0,S.s6)().setChatDrawer;return(0,s.jsx)(v.d,{opened:l,onClose:()=>{i(!1)},title:(0,s.jsxs)("div",{children:[(0,s.jsx)(b.x,{fz:"xl",children:"智能体调试"}),(0,s.jsx)(b.x,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整智能体问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,s.jsxs)(d.k,{mih:50,direction:"row",children:[(0,s.jsxs)("div",{style:{width:"60%"},children:[(0,s.jsx)("div",{style:{marginBottom:12},children:(0,s.jsx)(k.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体参数设置"})}),(0,s.jsx)(KnowledgeBaseForm,{appId:t,containerType:2})]}),(0,s.jsxs)("div",{style:{marginLeft:12,borderLeft:"1px solid #eee",paddingLeft:8,width:"40%"},children:[(0,s.jsx)("div",{children:(0,s.jsx)(k.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体问答"})}),(0,s.jsx)(M.Z,{})]})]})})}function List(e){let{appId:t}=e,l=(0,S.s6)().knowledgeBaseList,i=(0,S.s6)().setLoading,r=(0,S.s6)().updateCurrentKnowledgeBase,n=(0,S.s6)().setEditStatus,d=(0,S.s6)().setOpen,c=(0,S.s6)().setChatDrawer,generateToken=async e=>{try{i(!0),await (0,S.g$)(e),await (0,S.Co)(t)}catch(e){console.log(e)}finally{i(!1)}},removeKnowledgeBase=e=>{let{id:l,name:r}=e;N.qk.openConfirmModal({title:"删除知识智能体",centered:!0,children:(0,s.jsx)(b.x,{size:"sm",children:(0,s.jsx)(z.y,{highlight:r,children:"确定删除 ".concat(r,"?")})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{i(!0),await (0,S.eV)(l),await (0,S.Co)(t),i(!1)}})},p=l.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{width:20},children:e.id}),(0,s.jsx)("td",{style:{width:120},children:(0,s.jsx)(o(),{href:"/app/".concat(t,"/knowledgeBase/").concat(e.id,"/detail"),children:e.name})}),(0,s.jsx)("td",{style:{width:180},children:e.description}),(0,s.jsx)("td",{style:{width:200},children:e.system_message?(0,s.jsx)(q.Z,{value:e.system_message,content:e.system_message,width:300}):null}),(0,s.jsx)("td",{style:{width:300},children:e.prompt_template?(0,s.jsx)(q.Z,{value:e.prompt_template,content:e.prompt_template,width:300}):null}),(0,s.jsx)("td",{children:e.token?(0,s.jsx)(q.Z,{value:e.token,content:e.token,truncate:!0,width:160}):(0,s.jsx)(f.z,{color:"lime",size:"xs",compact:!0,onClick:()=>generateToken(e.id),children:"生成访问令牌"})}),(0,s.jsx)("td",{children:(0,B.o0)(e.created)}),(0,s.jsxs)("td",{style:{width:220},children:[e.token?(0,s.jsx)(f.z,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{n(!0);let t=await (0,S.IV)(e.id);r(t),c(!0)},mr:4,children:"问答测试"}):(0,s.jsx)(P.u,{label:"需要成访问令牌才可以访问此能力",children:(0,s.jsx)(f.z,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),(0,s.jsx)(f.z,{variant:"filled",size:"xs",onClick:async()=>{n(!0);let t=await (0,S.IV)(e.id);r(t),d(!0)},mr:4,children:"编辑"}),(0,s.jsx)(f.z,{variant:"filled",color:"red",size:"xs",onClick:()=>{removeKnowledgeBase(e)},children:"删除"})]})]},e.id)),getKonwledgeBase=async()=>{i(!0);try{await (0,S.Co)(t)}catch(e){console.log(e)}i(!1)};return(0,a.useEffect)(()=>{getKonwledgeBase()},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ChatDrawer,{appId:t}),(0,s.jsxs)(I.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"编号"}),(0,s.jsx)("th",{children:"名称"}),(0,s.jsx)("th",{children:"描述"}),(0,s.jsx)("th",{children:"系统提示词"}),(0,s.jsx)("th",{children:"完整提示词"}),(0,s.jsx)("th",{children:"访问token"}),(0,s.jsx)("th",{children:"创建时间"}),(0,s.jsx)("th",{children:"操作"})]})}),(0,s.jsx)("tbody",{children:p})]})]})}function KnowledgeBasePage(e){let{appId:t}=e,l=(0,S.s6)().loading,i=[{title:"应用列表",href:"/app"},{title:"智能体",href:"/app/".concat(t,"/knowledgeBase")}].map((e,t)=>(0,s.jsx)(C.e,{href:e.href,children:e.title},t)),r=(0,S.s6)().setOpen;return(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)(O.f,{visible:l,overlayOpacity:.3}),(0,s.jsx)(A.O,{children:i}),(0,s.jsx)(H.Z,{title:"领域知识智能体",description:"领域知识智能体专注于传授知识，利用LLM对自然语言进行认知，结合RAG(Retrieval-Augmented Generation 检索增强生成)技术来将领域的信息进行有效的整合，然后通过图片，视频，可交互组件完成知识交付，"}),(0,s.jsx)(h.x,{children:(0,s.jsx)(f.z,{onClick:()=>r(!0),children:"新建领域知识智能体"})}),(0,s.jsx)(AddOrUpdate,{appId:t}),(0,s.jsx)(List,{appId:t})]})}(i=r||(r={}))[i.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",i[i.CHAT=2]="CHAT";var Z=!0;function IndexPage(e){let{appId:t}=e;return(0,s.jsx)(KnowledgeBasePage,{appId:t})}}},function(e){e.O(0,[774,797,241,880,871,754,664,855,322,194,671,426,888,179],function(){return e(e.s=9049)}),_N_E=e.O()}]);