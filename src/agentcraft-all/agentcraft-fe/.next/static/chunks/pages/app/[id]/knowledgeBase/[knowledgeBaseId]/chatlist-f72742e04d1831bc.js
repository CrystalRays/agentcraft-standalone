(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[846],{93284:function(e,t,r){"use strict";r.d(t,{O:function(){return f}});var n=r(67294),o=r(3241),a=r(24241),i=(0,r(56817).k)(e=>({root:{display:"flex",alignItems:"center"},breadcrumb:{lineHeight:1,whiteSpace:"nowrap",WebkitTapHighlightColor:"transparent"},separator:{marginLeft:e.spacing.xs,marginRight:e.spacing.xs,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[7],lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center"}})),s=r(95117),l=r(64523),c=Object.defineProperty,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))u.call(t,r)&&__defNormalProp(e,r,t[r]);if(d)for(var r of d(t))p.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__objRest=(e,t)=>{var r={};for(var n in e)u.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&d)for(var n of d(e))0>t.indexOf(n)&&p.call(e,n)&&(r[n]=e[n]);return r};let h={separator:"/"},f=(0,n.forwardRef)((e,t)=>{let r=(0,o.N4)("Breadcrumbs",h,e),{className:c,children:d,separator:u,classNames:p,styles:f,unstyled:g,variant:b}=r,y=__objRest(r,["className","children","separator","classNames","styles","unstyled","variant"]),{classes:m,cx:j}=i(null,{classNames:p,styles:f,unstyled:g,name:"Breadcrumbs",variant:b}),v=n.Children.toArray(d).reduce((e,t,r,o)=>{var i;let l=(0,a.k)(t)?n.cloneElement(t,{className:j(m.breadcrumb,null==(i=t.props)?void 0:i.className),key:r}):n.createElement("div",{className:m.breadcrumb,key:r},t);return e.push(l),r!==o.length-1&&e.push(n.createElement(s.x,{size:"sm",className:m.separator,key:`separator-${r}`},u)),e},[]);return n.createElement(l.x,__spreadValues({className:j(m.root,c),ref:t},y),v)});f.displayName="@mantine/core/Breadcrumbs"},95078:function(e,t,r){"use strict";r.d(t,{i:function(){return O}});var n=r(67294),o=r(3241),a=r(56817),i=r(96768),s=r(14258),l=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&__defNormalProp(e,r,t[r]);if(u)for(var r of u(t))h.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>c(e,d(t)),f=(0,a.k)((e,{captionSide:t,horizontalSpacing:r,verticalSpacing:n,fontSize:o,withBorder:a,withColumnBorders:l})=>{let c=`${(0,i.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:__spreadProps(__spreadValues({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:a?c:void 0,"& caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& thead tr th, & tfoot tr th, & tbody tr th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,s.a)({size:o,sizes:e.fontSizes}),padding:`${(0,s.a)({size:n,sizes:e.spacing})} ${(0,s.a)({size:r,sizes:e.spacing})}`},"& thead tr th":{borderBottom:c},"& tfoot tr th, & tbody tr th":{borderTop:c},"& tbody tr td":{padding:`${(0,s.a)({size:n,sizes:e.spacing})} ${(0,s.a)({size:r,sizes:e.spacing})}`,borderTop:c,fontSize:(0,s.a)({size:o,sizes:e.fontSizes})},"& tbody tr:first-of-type td, & tbody tr:first-of-type th":{borderTop:"none"},"& thead th, & tbody td":{borderRight:l?c:"none","&:last-of-type":{borderRight:"none",borderLeft:l?c:"none"}},"& tbody tr th":{borderRight:l?c:"none"},"&[data-striped] tbody tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] tbody tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),g=r(64523),b=Object.defineProperty,y=Object.defineProperties,m=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,Table_defNormalProp=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Table_spreadValues=(e,t)=>{for(var r in t||(t={}))v.call(t,r)&&Table_defNormalProp(e,r,t[r]);if(j)for(var r of j(t))x.call(t,r)&&Table_defNormalProp(e,r,t[r]);return e},Table_spreadProps=(e,t)=>y(e,m(t)),__objRest=(e,t)=>{var r={};for(var n in e)v.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&j)for(var n of j(e))0>t.indexOf(n)&&x.call(e,n)&&(r[n]=e[n]);return r};let w={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},O=(0,n.forwardRef)((e,t)=>{let r=(0,o.N4)("Table",w,e),{className:a,children:i,striped:s,highlightOnHover:l,captionSide:c,horizontalSpacing:d,verticalSpacing:u,fontSize:p,unstyled:h,withBorder:b,withColumnBorders:y,variant:m}=r,j=__objRest(r,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:v,cx:x}=f({captionSide:c,verticalSpacing:u,horizontalSpacing:d,fontSize:p,withBorder:b,withColumnBorders:y},{unstyled:h,name:"Table",variant:m});return n.createElement(g.x,Table_spreadProps(Table_spreadValues({},j),{component:"table",ref:t,className:x(v.root,a),"data-striped":s||void 0,"data-hover":l||void 0}),i)});O.displayName="@mantine/core/Table"},28792:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase/[knowledgeBaseId]/chatlist",function(){return r(55070)}])},2394:function(e,t,r){"use strict";r.d(t,{Z:function(){return FeatureDescription}});var n=r(85893),o=r(92716),a=r(95117),i=r(64523),s=r(69876),l=r(19236),c=r(91759);function InfoDetail(e){let{detail:t,title:r}=e,[i,{open:s,close:l}]=(0,c.q)(!1);return(0,n.jsx)(n.Fragment,{children:t?(0,n.jsxs)("div",{children:[(0,n.jsx)(o.d,{opened:i,onClose:l,title:r,children:(0,n.jsx)(a.x,{children:t})}),(0,n.jsx)(a.x,{onClick:()=>s(),children:"信息"})]}):null})}function FeatureDescription(e){let{title:t,description:r,detail:o,mt:c,mb:d}=e;return(0,n.jsxs)(i.x,{mt:c||24,mb:d||24,children:[(0,n.jsxs)(s.k,{mih:20,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,n.jsx)(l.D,{order:2,children:t}),(0,n.jsx)(InfoDetail,{title:t,detail:o})]}),r?(0,n.jsx)(a.x,{lineClamp:4,children:r}):null]})}},55070:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return f},default:function(){return IndexPage}});var n=r(85893),o=r(67294),a=r(67841),i=r(64523),s=r(49737),l=r(95078),c=r(54685),d=r(93284),u=r(47876),p=r(23062),h=r(2394);function List(e){let{knowledgeBaseId:t}=e,r=(0,u.aK)().chatList,c=(0,u.aK)().loading,d=(0,u.aK)().setLoading,h=(0,u.aK)().setOpen,getKnowledgeBaseChatList=async e=>{d(!0),await (0,u.Ag)(e),d(!1)},f=r.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:100,wordWrap:"break-word"},children:e.question})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:(0,p.pI)(e.answer)})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:e.prompt})}),(0,n.jsx)("td",{children:e.ip}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:JSON.stringify((0,p.pI)(e.source))})}),(0,n.jsx)("td",{children:e.model_name}),(0,n.jsx)("td",{children:e.created}),(0,n.jsx)("td",{children:(0,n.jsx)(a.z,{onClick:()=>{h(!0)},size:"xs",children:"编辑"})})]},e.id));return(0,o.useEffect)(()=>{getKnowledgeBaseChatList(t)},[t]),(0,n.jsxs)(i.x,{pos:"relative",children:[(0,n.jsx)(s.f,{visible:c,overlayOpacity:.3}),(0,n.jsxs)(l.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"编号"}),(0,n.jsx)("th",{children:"问题"}),(0,n.jsx)("th",{children:"答案"}),(0,n.jsx)("th",{children:"完整提示词"}),(0,n.jsx)("th",{children:"访问IP"}),(0,n.jsx)("th",{children:"知识库结果"}),(0,n.jsx)("th",{children:"使用模型"}),(0,n.jsx)("th",{children:"问答创建时间"}),(0,n.jsx)("th",{children:"操作"})]})}),(0,n.jsx)("tbody",{children:f})]})]})}function ChatListPage(e){let{appId:t,knowledgeBaseId:r}=e,o=(0,u.aK)().loading,a=[{title:"应用列表",href:"/app"},{title:"知识库",href:"/app/".concat(t,"/knowledgeBase")},{title:"问答记录",href:"/app/".concat(t,"/knowledgeBase/").concat(r,"/chatlist")}].map((e,t)=>(0,n.jsx)(c.e,{href:e.href,children:e.title},t));return(0,n.jsxs)(i.x,{pos:"relative",children:[(0,n.jsx)(s.f,{visible:o,overlayOpacity:.3}),(0,n.jsx)(d.O,{children:a}),(0,n.jsx)(h.Z,{title:"问答记录",description:"您可以在此查看该知识库的问答历史记录"}),(0,n.jsx)(List,{knowledgeBaseId:r})]})}var f=!0;function IndexPage(e){let{appId:t,knowledgeBaseId:r}=e;return(0,n.jsx)(ChatListPage,{appId:t,knowledgeBaseId:r})}},47876:function(e,t,r){"use strict";r.d(t,{dr:function(){return chatStream},Ag:function(){return getChatList},aK:function(){return h}});var n=r(33250),o={Error:{Unauthorized:"无权限"}};let a={cn:o},i=Object.keys(a),s=a[function(){let e=function(e){try{return localStorage.getItem(e)}catch(e){return null}}("lang");if(i.includes(null!=e?e:""))return e;let t=function(){try{return navigator.language.toLowerCase()}catch(e){return"cn"}}();for(let e of i)if(t.includes(e))return e;return"cn"}()];!function merge(e,t){Object.keys(t).forEach(function(r){if(t[r]&&"object"==typeof t[r]){merge(e[r]=e[r]||{},t[r]);return}e[r]=t[r]})}(o,s);var l=r(64529),c=r(86105),d=r(23062),u=r(782),p=r(23824);let h=(0,l.Ue)()((0,u.mW)(e=>({chatList:[],open:!1,loading:!1,isEdit:!1,currentChatItem:{},updateCurrentChatItem:t=>e(e=>({currentChatItem:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateChatList:t=>e(e=>({chatList:t}))})));async function getChatList(e){let t=h.getState(),r=t.updateChatList,n=await (0,p.W)("/api/chat/chatlist?id=".concat(e)),o=n.data;o&&r(o)}function chatStream(e,t){var r;let a=new AbortController;null===(r=e.onController)||void 0===r||r.call(e,a);let i={method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:JSON.stringify(Object.assign({stream:!0},e,{token:t}))},s=setTimeout(()=>a.abort(),c.tb),l="",u=!1,finish=()=>{u||(e.onFinish(l),u=!0)};a.signal.onabort=finish,(0,n.L)("/api/chat",{...i,async onopen(e){var t;clearTimeout(s);let r=e.headers.get("content-type");if(console.log("AgentCraft request response content type: ",r),null==r?void 0:r.startsWith("text/plain"))return l=await e.clone().text(),finish();if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.startsWith("application/octet-stream"))||200!==e.status){let t=[l],r=await e.clone().text();try{let t=await e.clone().json();r=(0,d.Bs)(t)}catch(e){console.log(e)}return 401===e.status&&t.push(o.Error.Unauthorized),r&&t.push(r),l=t.join("\n\n"),finish()}},onmessage(t){if("[DONE]"===t.data||u)return finish();let r=t.data;try{let t=JSON.parse(r),o=t.choices[0].delta.content;if(o){var n;l+=o,null===(n=e.onUpdate)||void 0===n||n.call(e,l,o)}}catch(e){console.error("[Request] parse error",r,t)}},onclose(){finish()},onerror(t){var r;throw null===(r=e.onError)||void 0===r||r.call(e,t),t},openWhenHidden:!0})}},23062:function(e,t,r){"use strict";function unicodeDecode(e){let t=e;try{t=JSON.parse(e)}catch(e){console.error("Invalid URI sequence",e)}return t}function prettyObject(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}r.d(t,{Bs:function(){return prettyObject},pI:function(){return unicodeDecode}})},33250:function(e,t,r){"use strict";async function getBytes(e,t){let r;let n=e.getReader();for(;!(r=await n.read()).done;)t(r.value)}function newMessage(){return{data:"",event:"",id:"",retry:void 0}}r.d(t,{L:function(){return fetchEventSource}});var __rest=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)0>t.indexOf(n[o])&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r};let n="text/event-stream",o="last-event-id";function fetchEventSource(e,t){var{signal:r,headers:a,onopen:i,onmessage:s,onclose:l,onerror:c,openWhenHidden:d,fetch:u}=t,p=__rest(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((t,h)=>{let f;let g=Object.assign({},a);function onVisibilityChange(){f.abort(),document.hidden||create()}g.accept||(g.accept=n),"undefined"==typeof document||d||document.addEventListener("visibilitychange",onVisibilityChange);let b=1e3,y=0;function dispose(){"undefined"==typeof document||d||document.removeEventListener("visibilitychange",onVisibilityChange),clearTimeout(y),f.abort()}null==r||r.addEventListener("abort",()=>{dispose(),t()});let m=null!=u?u:fetch,j=null!=i?i:defaultOnOpen;async function create(){var r,n;f=new AbortController;try{let r,a,i,c;let d=await m(e,Object.assign(Object.assign({},p),{headers:g,signal:f.signal}));await j(d),await getBytes(d.body,(n=function(e,t,r){let n=newMessage(),o=new TextDecoder;return function(a,i){if(0===a.length)null==e||e(n),n=newMessage();else if(i>0){let e=o.decode(a.subarray(0,i)),s=i+(32===a[i+1]?2:1),l=o.decode(a.subarray(s));switch(e){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":null==t||t(n.id=l);break;case"retry":let c=parseInt(l,10);isNaN(c)||null==r||r(n.retry=c)}}}}(s,e=>{e?g[o]=e:delete g[o]},e=>{b=e}),c=!1,function(e){void 0===r?(r=e,a=0,i=-1):r=function(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(r,e);let t=r.length,o=0;for(;a<t;){c&&(10===r[a]&&(o=++a),c=!1);let e=-1;for(;a<t&&-1===e;++a)switch(r[a]){case 58:-1===i&&(i=a-o);break;case 13:c=!0;case 10:e=a}if(-1===e)break;n(r.subarray(o,e),i),o=a,i=-1}o===t?r=void 0:0!==o&&(r=r.subarray(o),a-=o)})),null==l||l(),dispose(),t()}catch(e){if(!f.signal.aborted)try{let t=null!==(r=null==c?void 0:c(e))&&void 0!==r?r:b;clearTimeout(y),y=setTimeout(create,t)}catch(e){dispose(),h(e)}}}create()})}function defaultOnOpen(e){let t=e.headers.get("content-type");if(!(null==t?void 0:t.startsWith(n)))throw Error(`Expected content-type to be ${n}, Actual: ${t}`)}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=28792)}),_N_E=e.O()}]);