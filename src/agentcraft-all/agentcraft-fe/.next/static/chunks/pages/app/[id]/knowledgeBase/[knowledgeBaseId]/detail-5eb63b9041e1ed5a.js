(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{88301:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase/[knowledgeBaseId]/detail",function(){return l(14812)}])},14812:function(e,s,l){"use strict";l.r(s),l.d(s,{__N_SSP:function(){return N},default:function(){return IndexPage}});var t,i,r=l(85893),n=l(67294),a=l(69876),o=l(82623),d=l(19236),c=l(64523),p=l(80061),h=l(52615),x=l(28855),u=l(54777),_=l(71232),m=l(31194),j=l(14127),y=l(67841),w=l(92716),g=l(95117),f=l(17789),v=l(55652),I=l(54685),k=l(49737),z=l(93284),b=l(77248),P=l(17120),A=l(91939),D=l(61494),C=l(24888),B=l(13962),U=l(29235),Z=l(84222),L=l(2394),E=l(918),T=l(41217);function KnowledgeBaseForm(e){let{appId:s,containerType:l}=e,t=(0,U.I1)().currentKnowledgeBase,i=(0,U.I1)().setLoading,w=(0,A.s6)().modelList,g=(0,D.s6)().dataSetList,f=(0,b.c)({initialValues:{name:"",description:"",prompt_template:Z.Gv,app_id:parseInt(s),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:"",exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"智能体名必填"}});(0,n.useEffect)(()=>{(0,A.fZ)(),(0,D.ln)();let e=null==t?void 0:t.datasets;f.setValues({id:null==t?void 0:t.id,name:null==t?void 0:t.name,description:null==t?void 0:t.description,prompt_template:null==t?void 0:t.prompt_template,app_id:null==t?void 0:t.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===B.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===B.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==t?void 0:t.exact_search_limit,fuzzy_search_similarity:null==t?void 0:t.fuzzy_search_similarity,temperature:null==t?void 0:t.temperature,top_p:null==t?void 0:t.top_p,n_sequences:null==t?void 0:t.n_sequences,max_tokens:null==t?void 0:t.max_tokens,stop:null==t?void 0:t.stop,presence_penalty:null==t?void 0:t.presence_penalty,frequency_penalty:null==t?void 0:t.frequency_penalty,logit_bias:null==t?void 0:t.logit_bias,model_id:null==t?void 0:t.model_id,redis_ip_ex:null==t?void 0:t.redis_ip_ex,redis_history_ex:null==t?void 0:t.redis_history_ex,model_ip_limit:null==t?void 0:t.model_ip_limit,llm_history_len:null==t?void 0:t.llm_history_len,system_message:null==t?void 0:t.system_message,exact_search_limit:null==t?void 0:t.exact_search_limit,fuzzy_search_limit:null==t?void 0:t.fuzzy_search_limit})},[t]);let v=w.map(e=>({label:e.name_alias,value:e.id})),I=g.filter(e=>e.dataset_type==B.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),k=g.filter(e=>e.dataset_type==B.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,r.jsxs)("div",{style:{width:"100%"},children:[(0,r.jsxs)(a.k,{style:{alignItems:"stretch"},children:[2!==l?(0,r.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:"25%"},mr:12,children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"智能体信息"}),(0,r.jsxs)(c.x,{pl:4,pr:4,children:[(0,r.jsx)(p.o,{withAsterisk:!0,label:"名称",placeholder:"输入智能体名称",...f.getInputProps("name")}),(0,r.jsx)(h.g,{label:"描述",placeholder:"输入应用描述",description:"请输入智能体的描述信息",...f.getInputProps("description"),minRows:22})]})]}):null,(0,r.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:"25%"},mr:12,children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"调试指令"}),(0,r.jsxs)(c.x,{pl:4,pr:4,children:[(0,r.jsx)(x.Ph,{data:Z.Ti,description:"",defaultValue:Z.$$,label:"指令示例",placeholder:"",onChange:e=>{f.setValues({system_message:e})}}),(0,r.jsx)(h.g,{label:"系统提示词",placeholder:"输入系统提示词",...f.getInputProps("system_message"),description:"系统提示词可以作为对大语言模型的约束指令",minRows:22})]})]}),(0,r.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:"25%"},mr:12,children:[(0,r.jsxs)(a.k,{justify:"space-between",align:"center",children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"LLM服务"}),(0,r.jsx)(C.Z,{cursor:"pointer",onClick:A.fZ})]}),(0,r.jsx)(c.x,{pl:4,pr:4,mb:12,children:(0,r.jsx)(x.Ph,{withAsterisk:!0,data:v,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...f.getInputProps("model_id")})}),(0,r.jsx)(u.i,{my:"sm"}),(0,r.jsx)(d.D,{order:5,size:"h5",children:"大语言模型参数"}),(0,r.jsxs)(c.x,{pl:4,pr:4,children:[(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(p.o,{withAsterisk:!0,label:"temperature",placeholder:"",...f.getInputProps("temperature")}),(0,r.jsx)(p.o,{withAsterisk:!0,label:"top_p",placeholder:"",...f.getInputProps("top_p")})]}),(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(p.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...f.getInputProps("n_sequences")}),(0,r.jsx)(p.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...f.getInputProps("max_tokens")})]}),(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(p.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...f.getInputProps("presence_penalty")}),(0,r.jsx)(p.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...f.getInputProps("frequency_penalty")})]}),(0,r.jsx)(p.o,{label:"logit_bias",placeholder:"",...f.getInputProps("logit_bias"),width:"50%"})]})]}),(0,r.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:"25%"},children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"数据召回"}),(0,r.jsx)(h.g,{label:"召回提示词模板",placeholder:"",...f.getInputProps("prompt_template"),minRows:6,description:"召回提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"}),(0,r.jsxs)(a.k,{justify:"space-between",align:"center",children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"召回数据集"}),(0,r.jsx)(C.Z,{cursor:"pointer",onClick:D.ln})]}),(0,r.jsx)(c.x,{pl:4,pr:4,children:(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(m.NU,{data:I,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...f.getInputProps("fuzzy_datasets")}),(0,r.jsx)(m.NU,{data:k,description:"问答数据集用来做问题精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...f.getInputProps("exact_datasets")})]})}),(0,r.jsx)(u.i,{my:"sm"}),(0,r.jsx)(d.D,{order:5,size:"h5",children:"召回参数"}),(0,r.jsxs)(c.x,{pl:4,pr:4,children:[(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(p.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...f.getInputProps("fuzzy_search_similarity")}),(0,r.jsx)(p.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...f.getInputProps("exact_search_similarity")})]}),(0,r.jsxs)(_.Z,{grow:!0,children:[(0,r.jsx)(j.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...f.getInputProps("fuzzy_search_limit")}),(0,r.jsx)(j.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...f.getInputProps("exact_search_limit")})]})]}),(0,r.jsx)(u.i,{my:"sm"})]})]}),(0,r.jsx)(c.x,{pt:18,style:{textAlign:"center",width:"100%"},children:(0,r.jsx)(y.z,{style:{width:"100%"},onClick:async()=>{if(f.validate(),f.isValid()){i(!0);let e=f.values;await (0,U.CH)(e.id,e),i(!1)}},children:"确认修改"})})]})}function ChatDrawer(){let e=(0,U.I1)().chatDrawer,s=(0,U.I1)().setChatDrawer;return(0,r.jsxs)(w.d,{opened:e,onClose:()=>{s(!1)},title:(0,r.jsxs)("div",{children:[(0,r.jsx)(g.x,{fz:"xl",children:"智能体调试"}),(0,r.jsx)(g.x,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整智能体问答的效果"})]}),position:"right",size:"30%",overlayProps:{opacity:.5,blur:4},children:[(0,r.jsx)("div",{children:(0,r.jsx)(f.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体问答"})}),(0,r.jsx)(P.Z,{})]})}function APIAccess(){let e=(0,U.I1)().currentKnowledgeBase,s=(0,U.I1)().accessUrl,l=(0,U.I1)().setAccessUrl,t=(0,U.I1)().setChatDrawer;(0,n.useEffect)(()=>{(async()=>{let e=await (0,U.Sk)(),s=e.data||{openApiUrl:"",innerApiUrl:""};l(s)})()},[]);let i="curl -X 'POST'     '".concat(s.openApiUrl,"/v1/chat/completions'     -H 'accept: application/json'     -H 'Authorization: Bearer ").concat(null==e?void 0:e.token,'\'     -H \'Content-Type: application/json\'     -d \'{\n      "messages":[\n          {\n              "role": "user",\n              "content": "请问世界最高峰是什么？"\n          }\n      ],\n      "stream": false,\n      "max_tokens": 1024\n  }\'');return(0,r.jsxs)(a.k,{direction:"column",style:{width:"100%"},children:[(0,r.jsx)(d.D,{order:4,mb:8,children:"访问接入"}),(0,r.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,r.jsx)(d.D,{order:5,size:"h5",children:"API访问"}),(0,r.jsxs)(c.x,{pl:4,pr:4,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{children:[(0,r.jsx)(g.x,{color:"cyan",weight:700,children:"公网API访问地址："}),(0,r.jsx)(E.Z,{value:s.openApiUrl,content:s.openApiUrl})," "]}),(0,r.jsx)("span",{})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{style:{wordBreak:"break-all"},children:[(0,r.jsx)(g.x,{color:"cyan",weight:700,children:"API访问token："}),(0,r.jsx)(E.Z,{value:null==e?void 0:e.token,content:null==e?void 0:e.token})]}),(0,r.jsx)("span",{})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{style:{wordBreak:"break-all"},children:[(0,r.jsx)(g.x,{color:"cyan",weight:700,children:"API文档访问："}),(0,r.jsx)("a",{href:"".concat(s.openApiUrl,"/docs"),target:"_blank",children:"".concat(s.openApiUrl,"/docs")})]}),(0,r.jsx)("span",{})]})]}),(0,r.jsx)(u.i,{my:"sm"}),(0,r.jsx)(d.D,{order:5,size:"h5",children:"API调用示例"}),(0,r.jsx)("div",{style:{width:"95%",overflow:"hidden",margin:"0 auto"},children:(0,r.jsx)(T.Z,{textContent:"```shell\n".concat(i),value:i})}),(0,r.jsx)(u.i,{my:"sm"}),(0,r.jsx)(d.D,{order:5,size:"h5",children:"效果测试"}),(0,r.jsx)(c.x,{pl:4,pr:4,children:(0,r.jsx)(_.Z,{grow:!0,children:(null==e?void 0:e.token)?(0,r.jsx)(y.z,{color:"grape",variant:"filled",size:"xs",onClick:()=>{t(!0)},mr:4,children:"问答测试"}):(0,r.jsx)(v.u,{label:"需要成访问令牌才可以访问此能力",children:(0,r.jsx)(y.z,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})})})})]})]})}function DetailPage(e){let{appId:s,knowledgeBaseId:l}=e,t=(0,U.I1)().loading,i=(0,U.I1)().updateCurrentKnowledgeBase,o=[{title:"应用列表",href:"/app"},{title:"领域知识智能体",href:"/app/".concat(s,"/knowledgeBase")},{title:"智能体详细",href:"/app/".concat(s,"/knowledgeBase/").concat(l,"/detail")}].map((e,s)=>(0,r.jsx)(I.e,{href:e.href,children:e.title},s));return(0,n.useEffect)(()=>{(async()=>{let e=await (0,U.IV)(l);i(e)})()},[l]),(0,r.jsxs)(c.x,{pos:"relative",children:[(0,r.jsx)(k.f,{visible:t,overlayOpacity:.3}),(0,r.jsx)(z.O,{children:o}),(0,r.jsx)(L.Z,{title:"智能体详情",description:"您可以查看修改智能体内容，以及查看API调用"}),(0,r.jsx)(ChatDrawer,{}),(0,r.jsxs)(a.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",wrap:"nowrap",children:[(0,r.jsx)(APIAccess,{}),(0,r.jsx)(KnowledgeBaseForm,{appId:s})]})]})}(t=i||(i={}))[t.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",t[t.CHAT=2]="CHAT";var N=!0;function IndexPage(e){let{appId:s,knowledgeBaseId:l}=e;return(0,r.jsx)(DetailPage,{appId:s,knowledgeBaseId:l})}}},function(e){e.O(0,[774,797,241,880,871,855,322,754,642,194,104,958,888,179],function(){return e(e.s=88301)}),_N_E=e.O()}]);