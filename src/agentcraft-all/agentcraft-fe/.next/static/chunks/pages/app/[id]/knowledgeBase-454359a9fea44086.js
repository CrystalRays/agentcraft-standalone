(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{95033:function(e,r,t){"use strict";t.d(r,{y:function(){return j}});var l=t(67294),i=t(64761),a=t(48427),n=t(95117),o=(0,t(56817).k)((e,{color:r})=>({root:{backgroundColor:e.fn.themeColor(r,"dark"===e.colorScheme?5:2),color:"dark"===e.colorScheme?e.colors.dark[9]:"inherit"}})),s=t(64523),c=Object.defineProperty,d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,r,t)=>r in e?c(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,__spreadValues=(e,r)=>{for(var t in r||(r={}))p.call(r,t)&&__defNormalProp(e,t,r[t]);if(d)for(var t of d(r))h.call(r,t)&&__defNormalProp(e,t,r[t]);return e},__objRest=(e,r)=>{var t={};for(var l in e)p.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&d)for(var l of d(e))0>r.indexOf(l)&&h.call(e,l)&&(t[l]=e[l]);return t};let u={color:"yellow"},m=(0,l.forwardRef)((e,r)=>{let t=(0,i.N4)("Mark",u,e),{color:a,className:n,unstyled:c,variant:d}=t,p=__objRest(t,["color","className","unstyled","variant"]),{classes:h,cx:m}=o({color:a},{unstyled:c,name:"Mark",variant:d});return l.createElement(s.x,__spreadValues({component:"mark",ref:r,className:m(h.root,n)},p))});function escapeRegex(e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}m.displayName="@mantine/core/Mark";var f=Object.defineProperty,g=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,Highlight_defNormalProp=(e,r,t)=>r in e?f(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,Highlight_spreadValues=(e,r)=>{for(var t in r||(r={}))_.call(r,t)&&Highlight_defNormalProp(e,t,r[t]);if(g)for(var t of g(r))x.call(r,t)&&Highlight_defNormalProp(e,t,r[t]);return e},Highlight_objRest=(e,r)=>{var t={};for(var l in e)_.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&g)for(var l of g(e))0>r.indexOf(l)&&x.call(e,l)&&(t[l]=e[l]);return t};let y={highlightColor:"yellow"},b=(0,l.forwardRef)((e,r)=>{let t=(0,i.N4)("Highlight",y,e),{children:a,highlight:o,highlightColor:s,highlightStyles:c,unstyled:d}=t,p=Highlight_objRest(t,["children","highlight","highlightColor","highlightStyles","unstyled"]),h=function(e,r){if(null==r)return[{chunk:e,highlighted:!1}];let t=Array.isArray(r)?r.map(escapeRegex):escapeRegex(r),l=Array.isArray(t)?t.filter(e=>e.trim().length>0).length>0:""!==t.trim();if(!l)return[{chunk:e,highlighted:!1}];let i="string"==typeof t?t.trim():t.filter(e=>0!==e.trim().length).map(e=>e.trim()).join("|"),a=RegExp(`(${i})`,"gi"),n=e.split(a).map(e=>({chunk:e,highlighted:a.test(e)})).filter(({chunk:e})=>e);return n}(a,o);return l.createElement(n.x,Highlight_spreadValues({unstyled:d,ref:r,__staticSelector:"Highlight"},p),h.map(({chunk:e,highlighted:r},t)=>r?l.createElement(m,{unstyled:d,key:t,color:s,sx:c,"data-highlight":e},e):l.createElement("span",{key:t},e)))});b.displayName="@mantine/core/Highlight";let j=(0,a.F)(b)},12840:function(e,r,t){"use strict";t.d(r,{o:function(){return f}});var l=t(67294),i=t(64761),a=t(96768);let n={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};var o=(0,t(56817).k)((e,{transitionDuration:r})=>({control:{},root:{position:"relative"},content:{display:"flex",flexDirection:"column",overflow:"hidden",transitionProperty:"max-height",transitionTimingFunction:e.transitionTimingFunction,transitionDuration:`${r}ms`,"@media (prefers-reduced-motion)":{transitionDuration:e.respectReducedMotion?"0ms":void 0}}})),s=t(64523),c=t(54685),d=Object.defineProperty,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,r,t)=>r in e?d(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,__spreadValues=(e,r)=>{for(var t in r||(r={}))h.call(r,t)&&__defNormalProp(e,t,r[t]);if(p)for(var t of p(r))u.call(r,t)&&__defNormalProp(e,t,r[t]);return e},__objRest=(e,r)=>{var t={};for(var l in e)h.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&p)for(var l of p(e))0>r.indexOf(l)&&u.call(e,l)&&(t[l]=e[l]);return t};let m={maxHeight:100,transitionDuration:200,initialState:!1},f=(0,l.forwardRef)((e,r)=>{let t=(0,i.N4)("Spoiler",m,e),{className:d,children:p,maxHeight:h,hideLabel:u,showLabel:f,transitionDuration:g,controlRef:_,initialState:x,classNames:y,styles:b,unstyled:j,variant:w}=t,v=__objRest(t,["className","children","maxHeight","hideLabel","showLabel","transitionDuration","controlRef","initialState","classNames","styles","unstyled","variant"]),{classes:k,cx:I}=o({transitionDuration:g},{name:"Spoiler",classNames:y,styles:b,unstyled:j,variant:w}),[P,O]=(0,l.useState)(x),[S,z]=(0,l.useState)(x),{ref:N,height:C}=function(){let[e,{width:r,height:t}]=function(){let e=(0,l.useRef)(0),r=(0,l.useRef)(null),[t,i]=(0,l.useState)(n),a=(0,l.useMemo)(()=>"undefined"!=typeof window?new ResizeObserver(t=>{let l=t[0];l&&(cancelAnimationFrame(e.current),e.current=requestAnimationFrame(()=>{r.current&&i(l.contentRect)}))}):null,[]);return(0,l.useEffect)(()=>(r.current&&a.observe(r.current),()=>{a.disconnect(),e.current&&cancelAnimationFrame(e.current)}),[r.current]),[r,t]}();return{ref:e,width:r,height:t}}(),E=P?u:f;return(0,l.useEffect)(()=>{z(h<C)},[C,h,p]),l.createElement(s.x,__spreadValues({className:I(k.root,d),ref:r},v),l.createElement("div",{className:k.content,style:{maxHeight:P?C?(0,a.h)(C):void 0:(0,a.h)(h)}},l.createElement("div",{ref:N},p)),S&&l.createElement(c.e,{component:"button",ref:_,onClick:()=>O(e=>!e),className:k.control},E))});f.displayName="@mantine/core/Spoiler"},9049:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase",function(){return t(38114)}])},38114:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return e$},default:function(){return IndexPage}});var l,i,a=t(85893),n=t(67294),o=t(41664),s=t.n(o),c=t(69876),d=t(82623),p=t(19236),h=t(64523),u=t(80061),m=t(52615),f=t(28855),g=t(54777),_=t(71232),x=t(31194),y=t(14127),b=t(67841),j=t(94491),w=t(92716),v=t(95117),k=t(17789),I=t(83051),P=t(15851),O=t(64761);let S=(0,n.createContext)(null),z=S.Provider,useSwitchGroupContext=()=>(0,n.useContext)(S);var N=t(94151),C=Object.defineProperty,E=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,r,t)=>r in e?C(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,__spreadValues=(e,r)=>{for(var t in r||(r={}))R.call(r,t)&&__defNormalProp(e,t,r[t]);if(E)for(var t of E(r))L.call(r,t)&&__defNormalProp(e,t,r[t]);return e},__objRest=(e,r)=>{var t={};for(var l in e)R.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&E)for(var l of E(e))0>r.indexOf(l)&&L.call(e,l)&&(t[l]=e[l]);return t};let A={size:"sm"},D=(0,n.forwardRef)((e,r)=>{let t=(0,O.N4)("SwitchGroup",A,e),{children:l,value:i,defaultValue:a,onChange:o,size:s,wrapperProps:c}=t,d=__objRest(t,["children","value","defaultValue","onChange","size","wrapperProps"]),[p,h]=(0,P.C)({value:i,defaultValue:a,finalValue:[],onChange:o});return n.createElement(z,{value:{value:p,onChange:e=>{let r=e.currentTarget.value;h(p.includes(r)?p.filter(e=>e!==r):[...p,r])},size:s}},n.createElement(N.I.Wrapper,__spreadValues(__spreadValues({labelElement:"div",size:s,__staticSelector:"SwitchGroup",ref:r},c),d),l))});D.displayName="@mantine/core/SwitchGroup";var T=t(96768),V=t(56817),$=t(14258),B=Object.defineProperty,H=Object.defineProperties,F=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,Switch_styles_defNormalProp=(e,r,t)=>r in e?B(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,Switch_styles_spreadValues=(e,r)=>{for(var t in r||(r={}))Z.call(r,t)&&Switch_styles_defNormalProp(e,t,r[t]);if(M)for(var t of M(r))q.call(r,t)&&Switch_styles_defNormalProp(e,t,r[t]);return e},__spreadProps=(e,r)=>H(e,F(r));let K={xs:(0,T.h)(16),sm:(0,T.h)(20),md:(0,T.h)(24),lg:(0,T.h)(30),xl:(0,T.h)(36)},U={xs:(0,T.h)(32),sm:(0,T.h)(38),md:(0,T.h)(46),lg:(0,T.h)(56),xl:(0,T.h)(72)},G={xs:(0,T.h)(12),sm:(0,T.h)(14),md:(0,T.h)(18),lg:(0,T.h)(22),xl:(0,T.h)(28)},W={xs:(0,T.h)(5),sm:(0,T.h)(6),md:(0,T.h)(7),lg:(0,T.h)(9),xl:(0,T.h)(11)},X={xs:(0,T.h)(4),sm:(0,T.h)(5),md:(0,T.h)(6),lg:(0,T.h)(8),xl:(0,T.h)(10)};var Q=(0,V.k)((e,{radius:r,color:t,labelPosition:l,error:i},{size:a})=>{let n=(0,$.a)({size:a,sizes:G}),o=(0,$.a)({size:r,sizes:e.radius}),s=e.fn.variant({variant:"filled",color:t}),c=(0,$.a)({size:a,sizes:U}),d=(0,T.h)("xs"===a?1:2),p=e.fn.variant({variant:"filled",color:"red"}).background;return{input:{height:0,width:0,overflow:"hidden",whiteSpace:"nowrap",padding:0,WebkitClipPath:"inset(50%)",clipPath:"inset(50%)",position:"absolute"},track:__spreadProps(Switch_styles_spreadValues({},e.fn.focusStyles("input:focus + &")),{cursor:e.cursorType,overflow:"hidden",WebkitTapHighlightColor:"transparent",position:"relative",borderRadius:o,backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[2],border:`${(0,T.h)(1)} solid ${i?p:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`,height:(0,$.a)({size:a,sizes:K}),minWidth:c,margin:0,transitionProperty:"background-color, border-color",transitionTimingFunction:e.transitionTimingFunction,transitionDuration:"150ms",boxSizing:"border-box",appearance:"none",display:"flex",alignItems:"center",fontSize:(0,$.a)({size:a,sizes:W}),fontWeight:600,order:"left"===l?2:1,userSelect:"none",zIndex:0,lineHeight:0,color:"dark"===e.colorScheme?e.colors.dark[1]:e.colors.gray[6],transition:`color 150ms ${e.transitionTimingFunction}`,"input:checked + &":{backgroundColor:s.background,borderColor:s.background,color:e.white,transition:`color 150ms ${e.transitionTimingFunction}`},"input:disabled + &":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[2],borderColor:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[2],cursor:"not-allowed"}}),thumb:{position:"absolute",zIndex:1,borderRadius:o,boxSizing:"border-box",display:"flex",backgroundColor:e.white,height:n,width:n,border:`${(0,T.h)(1)} solid ${"dark"===e.colorScheme?e.white:e.colors.gray[3]}`,left:d,transition:`left 150ms ${e.transitionTimingFunction}`,"& > *":{margin:"auto"},"@media (prefers-reduced-motion)":{transitionDuration:e.respectReducedMotion?"0ms":""},"input:checked + * > &":{left:`calc(100% - ${n} - ${d})`,borderColor:e.white},"input:disabled + * > &":{borderColor:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[2],backgroundColor:"dark"===e.colorScheme?e.colors.dark[3]:e.colors.gray[0]}},trackLabel:{height:"100%",display:"grid",placeContent:"center",minWidth:`calc(${c} - ${n})`,paddingInline:(0,$.a)({size:a,sizes:X}),margin:`0 0 0 calc(${n} + ${d})`,transition:`margin 150ms ${e.transitionTimingFunction}`,"input:checked + * > &":{margin:`0 calc(${n} + ${d}) 0 0`}}}}),Y=t(12756),J=Object.defineProperty,ee=Object.defineProperties,er=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertySymbols,el=Object.prototype.hasOwnProperty,ei=Object.prototype.propertyIsEnumerable,InlineInput_styles_defNormalProp=(e,r,t)=>r in e?J(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,InlineInput_styles_spreadValues=(e,r)=>{for(var t in r||(r={}))el.call(r,t)&&InlineInput_styles_defNormalProp(e,t,r[t]);if(et)for(var t of et(r))ei.call(r,t)&&InlineInput_styles_defNormalProp(e,t,r[t]);return e},InlineInput_styles_spreadProps=(e,r)=>ee(e,er(r));let ea={xs:(0,T.h)(16),sm:(0,T.h)(20),md:(0,T.h)(24),lg:(0,T.h)(30),xl:(0,T.h)(36)};var en=(0,V.k)((e,{labelPosition:r},{size:t})=>({root:{},body:{display:"flex"},labelWrapper:InlineInput_styles_spreadProps(InlineInput_styles_spreadValues({},e.fn.fontStyles()),{display:"inline-flex",flexDirection:"column",WebkitTapHighlightColor:"transparent",fontSize:t in ea?(0,$.a)({size:t,sizes:e.fontSizes}):void 0,lineHeight:t in ea?(0,$.a)({size:t,sizes:ea}):void 0,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,cursor:e.cursorType,order:"left"===r?1:2}),description:{marginTop:`calc(${e.spacing.xs} / 2)`,["left"===r?"paddingRight":"paddingLeft"]:e.spacing.sm},error:{marginTop:`calc(${e.spacing.xs} / 2)`,["left"===r?"paddingRight":"paddingLeft"]:e.spacing.sm},label:{cursor:e.cursorType,["left"===r?"paddingRight":"paddingLeft"]:e.spacing.sm,"&[data-disabled]":{color:"dark"===e.colorScheme?e.colors.dark[3]:e.colors.gray[5]}}})),eo=Object.defineProperty,es=Object.getOwnPropertySymbols,ec=Object.prototype.hasOwnProperty,ed=Object.prototype.propertyIsEnumerable,InlineInput_defNormalProp=(e,r,t)=>r in e?eo(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,InlineInput_spreadValues=(e,r)=>{for(var t in r||(r={}))ec.call(r,t)&&InlineInput_defNormalProp(e,t,r[t]);if(es)for(var t of es(r))ed.call(r,t)&&InlineInput_defNormalProp(e,t,r[t]);return e},InlineInput_objRest=(e,r)=>{var t={};for(var l in e)ec.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&es)for(var l of es(e))0>r.indexOf(l)&&ed.call(e,l)&&(t[l]=e[l]);return t};function InlineInput(e){var{__staticSelector:r,className:t,classNames:l,styles:i,unstyled:a,children:o,label:s,description:c,id:d,disabled:p,error:u,size:m,labelPosition:f,variant:g}=e,_=InlineInput_objRest(e,["__staticSelector","className","classNames","styles","unstyled","children","label","description","id","disabled","error","size","labelPosition","variant"]);let{classes:x,cx:y}=en({labelPosition:f},{name:r,styles:i,classNames:l,unstyled:a,variant:g,size:m});return n.createElement(h.x,InlineInput_spreadValues({className:y(x.root,t)},_),n.createElement("div",{className:y(x.body)},o,n.createElement("div",{className:x.labelWrapper},s&&n.createElement("label",{className:x.label,"data-disabled":p||void 0,htmlFor:d},s),c&&n.createElement(N.I.Description,{className:x.description},c),u&&"boolean"!==u&&n.createElement(N.I.Error,{className:x.error},u))))}InlineInput.displayName="@mantine/core/InlineInput";var ep=Object.defineProperty,eh=Object.defineProperties,eu=Object.getOwnPropertyDescriptors,em=Object.getOwnPropertySymbols,ef=Object.prototype.hasOwnProperty,eg=Object.prototype.propertyIsEnumerable,Switch_defNormalProp=(e,r,t)=>r in e?ep(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,Switch_spreadValues=(e,r)=>{for(var t in r||(r={}))ef.call(r,t)&&Switch_defNormalProp(e,t,r[t]);if(em)for(var t of em(r))eg.call(r,t)&&Switch_defNormalProp(e,t,r[t]);return e},Switch_spreadProps=(e,r)=>eh(e,eu(r)),Switch_objRest=(e,r)=>{var t={};for(var l in e)ef.call(e,l)&&0>r.indexOf(l)&&(t[l]=e[l]);if(null!=e&&em)for(var l of em(e))0>r.indexOf(l)&&eg.call(e,l)&&(t[l]=e[l]);return t};let e_={offLabel:"",onLabel:"",size:"sm",radius:"xl",error:!1},ex=(0,n.forwardRef)((e,r)=>{var t;let l=(0,O.N4)("Switch",e_,e),{className:i,color:a,label:o,offLabel:s,onLabel:c,id:d,style:p,size:h,radius:u,wrapperProps:m,children:f,unstyled:g,styles:_,classNames:x,thumbIcon:y,sx:b,checked:j,defaultChecked:w,onChange:v,labelPosition:k,description:S,error:z,disabled:N,variant:C}=l,E=Switch_objRest(l,["className","color","label","offLabel","onLabel","id","style","size","radius","wrapperProps","children","unstyled","styles","classNames","thumbIcon","sx","checked","defaultChecked","onChange","labelPosition","description","error","disabled","variant"]),R=useSwitchGroupContext(),L=(null==R?void 0:R.size)||h,{classes:A}=Q({color:a,radius:u,labelPosition:k,error:!!z},{name:"Switch",classNames:x,styles:_,unstyled:g,size:L,variant:C}),{systemStyles:D,rest:T}=(0,Y.x)(E),V=(0,I.M)(d),$=R?{checked:R.value.includes(T.value),onChange:R.onChange}:{},[B,H]=(0,P.C)({value:null!=(t=$.checked)?t:j,defaultValue:w,finalValue:!1});return n.createElement(InlineInput,Switch_spreadValues(Switch_spreadValues({className:i,sx:b,style:p,id:V,size:(null==R?void 0:R.size)||h,labelPosition:k,label:o,description:S,error:z,disabled:N,__staticSelector:"Switch",classNames:x,styles:_,unstyled:g,"data-checked":$.checked||void 0,variant:C},D),m),n.createElement("input",Switch_spreadProps(Switch_spreadValues({},T),{disabled:N,checked:B,onChange:e=>{R?$.onChange(e):null==v||v(e),H(e.currentTarget.checked)},id:V,ref:r,type:"checkbox",className:A.input})),n.createElement("label",{htmlFor:V,className:A.track},n.createElement("div",{className:A.thumb},y),n.createElement("div",{className:A.trackLabel},B?c:s)))});ex.displayName="@mantine/core/Switch",ex.Group=D;var ey=t(95033),eb=t(12840),ej=t(55652),ew=t(95078),ev=t(54685),ek=t(49737),eI=t(93284),eP=t(77248),eO=t(73344),eS=t(24888),ez=t(91939),eN=t(61494),eC=t(25288),eE=t(13962),eR=t(2394),eL=t(29235),eA=t(86105),eD=t(84222),eT=t(918),eV=t(17120);function KnowledgeBaseForm(e){let{appId:r,containerType:t}=e,l=(0,eL.I1)().setOpen,i=(0,eL.I1)().isEdit,o=(0,eL.I1)().currentKnowledgeBase,s=(0,eL.I1)().setLoading,j=(0,ez.s6)().modelList,w=(0,eN.s6)().dataSetList,v=(0,eP.c)({initialValues:{name:"",description:"",prompt_template:eA.Gf,app_id:parseInt(r),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:eD.$$,exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"智能体名必填"}});(0,n.useEffect)(()=>{if((0,ez.fZ)(),(0,eN.ln)(),i){let e=null==o?void 0:o.datasets;v.setValues({id:null==o?void 0:o.id,name:null==o?void 0:o.name,description:null==o?void 0:o.description,prompt_template:null==o?void 0:o.prompt_template,app_id:null==o?void 0:o.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===eE.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===eE.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==o?void 0:o.exact_search_similarity,fuzzy_search_similarity:null==o?void 0:o.fuzzy_search_similarity,temperature:null==o?void 0:o.temperature,top_p:null==o?void 0:o.top_p,n_sequences:null==o?void 0:o.n_sequences,max_tokens:null==o?void 0:o.max_tokens,stop:null==o?void 0:o.stop,presence_penalty:null==o?void 0:o.presence_penalty,frequency_penalty:null==o?void 0:o.frequency_penalty,logit_bias:null==o?void 0:o.logit_bias,model_id:null==o?void 0:o.model_id,redis_ip_ex:null==o?void 0:o.redis_ip_ex,redis_history_ex:null==o?void 0:o.redis_history_ex,model_ip_limit:null==o?void 0:o.model_ip_limit,llm_history_len:null==o?void 0:o.llm_history_len,system_message:null==o?void 0:o.system_message,exact_search_limit:null==o?void 0:o.exact_search_limit,fuzzy_search_limit:null==o?void 0:o.fuzzy_search_limit})}},[o]);let k=j.map(e=>({label:e.name_alias,value:e.id})),I=w.filter(e=>e.dataset_type==eE.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),P=w.filter(e=>e.dataset_type==eE.I.QUESTION).map(e=>({label:e.name,value:e.id})),O=2!==t?"25%":"33.33%";return(0,a.jsxs)(c.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,a.jsxs)(c.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",style:{alignItems:"stretch"},children:[2!==t?(0,a.jsxs)(d.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:O},children:[(0,a.jsx)(p.D,{order:5,size:"h5",children:"智能体信息"}),(0,a.jsxs)(h.x,{pl:4,pr:4,children:[(0,a.jsx)(u.o,{withAsterisk:!0,label:"名称",placeholder:"输入智能体名称",...v.getInputProps("name")}),(0,a.jsx)(m.g,{label:"描述",placeholder:"输入应用描述",description:"请输入智能体的描述信息",...v.getInputProps("description"),minRows:22})]})]}):null,(0,a.jsxs)(d.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:O},children:[(0,a.jsx)(p.D,{order:5,size:"h5",children:"调试指令"}),(0,a.jsxs)(h.x,{pl:4,pr:4,children:[(0,a.jsx)(f.Ph,{data:eD.Ti,description:"",defaultValue:eD.$$,...v.getInputProps("system_message"),label:"指令示例",placeholder:"",onChange:e=>{v.setValues({system_message:e})}}),(0,a.jsx)(m.g,{withAsterisk:!0,label:"系统提示词",placeholder:"输入系统提示词",...v.getInputProps("system_message"),minRows:22,description:"系统提示词可以作为对大语言模型的约束指令"})]})]}),(0,a.jsxs)(d.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:O},children:[(0,a.jsxs)(c.k,{justify:"space-between",align:"center",children:[(0,a.jsx)(p.D,{order:5,size:"h5",children:"LLM服务"}),(0,a.jsx)(eS.Z,{cursor:"pointer",onClick:ez.fZ})]}),(0,a.jsx)(h.x,{pl:4,pr:4,mb:12,children:(0,a.jsx)(f.Ph,{withAsterisk:!0,data:k,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...v.getInputProps("model_id")})}),(0,a.jsx)(g.i,{my:"sm"}),(0,a.jsx)(p.D,{order:5,size:"h5",children:"LLM参数"}),(0,a.jsxs)(h.x,{pl:4,pr:4,mt:4,children:[(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(u.o,{withAsterisk:!0,label:"temperature",placeholder:"",...v.getInputProps("temperature")}),(0,a.jsx)(u.o,{withAsterisk:!0,label:"top_p",placeholder:"",...v.getInputProps("top_p")})]}),(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(u.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...v.getInputProps("n_sequences")}),(0,a.jsx)(u.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...v.getInputProps("max_tokens")})]}),(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(u.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...v.getInputProps("presence_penalty")}),(0,a.jsx)(u.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...v.getInputProps("frequency_penalty")})]}),(0,a.jsx)(u.o,{label:"logit_bias",placeholder:"",...v.getInputProps("logit_bias"),width:"50%"})]})]}),(0,a.jsxs)(d.X,{shadow:"xs",p:"md",withBorder:!0,style:{width:O},children:[(0,a.jsxs)(c.k,{justify:"space-between",align:"center",children:[(0,a.jsx)(p.D,{order:5,size:"h5",children:"数据召回"}),(0,a.jsx)(eS.Z,{cursor:"pointer",onClick:eN.ln})]}),(0,a.jsx)(h.x,{pl:4,pr:4,children:(0,a.jsx)(m.g,{label:"召回提示词模板",placeholder:"",...v.getInputProps("prompt_template"),minRows:2!==t?6:8,description:"召回提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})}),(0,a.jsx)(g.i,{my:"sm"}),(0,a.jsx)(p.D,{order:5,size:"h6",children:"召回数据集"}),(0,a.jsx)(h.x,{pl:4,pr:4,children:(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(x.NU,{data:I,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...v.getInputProps("fuzzy_datasets")}),(0,a.jsx)(x.NU,{data:P,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...v.getInputProps("exact_datasets")})]})}),(0,a.jsx)(g.i,{my:"sm"}),(0,a.jsx)(p.D,{order:5,size:"h6",children:"召回参数"}),(0,a.jsxs)(h.x,{pl:4,pr:4,mt:4,children:[(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(u.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...v.getInputProps("fuzzy_search_similarity")}),(0,a.jsx)(u.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...v.getInputProps("exact_search_similarity")})]}),(0,a.jsxs)(_.Z,{grow:!0,children:[(0,a.jsx)(y.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...v.getInputProps("fuzzy_search_limit")}),(0,a.jsx)(y.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...v.getInputProps("exact_search_limit")})]})]})]})]}),(0,a.jsx)(h.x,{pt:4,style:{textAlign:"center",width:"100%"},children:(0,a.jsx)(b.z,{style:{width:"100%"},onClick:async()=>{if(v.validate(),v.isValid()){s(!0);let e=v.values;i?await (0,eL.CH)(e.id,e):await (0,eL.uA)(e),await (0,eL.Co)(r),l(!1),s(!1)}},children:"确认"})})]})}function AddOrUpdate(e){let{appId:r}=e,t=(0,eL.I1)().open,l=(0,eL.I1)().setOpen,i=(0,eL.I1)().isEdit,n=(0,eL.I1)().setEditStatus;return(0,a.jsx)(j.u,{opened:t,onClose:()=>{n(!1),l(!1)},title:i?"编辑智能体":"创建智能体",centered:!0,size:"90%",children:(0,a.jsx)(KnowledgeBaseForm,{appId:r})})}function ChatDrawer(e){let{appId:r}=e,t=(0,eL.I1)().chatDrawer,l=(0,eL.I1)().setChatDrawer,[i,o]=(0,n.useState)(!0);return(0,a.jsx)(w.d,{opened:t,onClose:()=>{l(!1)},title:(0,a.jsxs)("div",{children:[(0,a.jsx)(v.x,{fz:"xl",children:"智能体调试"}),(0,a.jsx)(v.x,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整智能体问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,a.jsxs)(c.k,{mih:50,direction:"row",children:[(0,a.jsxs)("div",{style:{flex:"none",width:"64%",overflow:"hidden",borderRight:"1px solid #eee",paddingRight:8,marginRight:12,display:i?"block":"none"},children:[(0,a.jsx)("div",{style:{marginBottom:12},children:(0,a.jsx)(k.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体参数设置"})}),(0,a.jsx)(KnowledgeBaseForm,{appId:r,containerType:2})]}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsxs)(c.k,{justify:"space-between",children:[(0,a.jsx)(k.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体问答"}),(0,a.jsx)(ex,{label:i?"关闭智能体参数配置":"开启智能体参数配置",checked:i,onChange:e=>o(e.currentTarget.checked)})]}),(0,a.jsx)(eV.Z,{})]})]})})}function List(e){let{appId:r}=e,t=(0,eL.I1)().knowledgeBaseList,l=(0,eL.I1)().setLoading,i=(0,eL.I1)().updateCurrentKnowledgeBase,o=(0,eL.I1)().setEditStatus,c=(0,eL.I1)().setOpen,d=(0,eL.I1)().setChatDrawer,generateToken=async e=>{try{l(!0),await (0,eL.g$)(e),await (0,eL.Co)(r)}catch(e){console.log(e)}finally{l(!1)}},removeKnowledgeBase=e=>{let{id:t,name:i}=e;eO.qk.openConfirmModal({title:"删除知识智能体",centered:!0,children:(0,a.jsx)(v.x,{size:"sm",children:(0,a.jsx)(ey.y,{highlight:i,children:"确定删除 ".concat(i,"?")})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{l(!0),await (0,eL.eV)(t),await (0,eL.Co)(r),l(!1)}})},p=t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{style:{width:20},children:e.id}),(0,a.jsx)("td",{style:{width:120},children:(0,a.jsx)(s(),{href:"/app/".concat(r,"/knowledgeBase/").concat(e.id,"/detail"),children:e.name})}),(0,a.jsx)("td",{style:{width:180},children:e.description}),(0,a.jsx)("td",{style:{width:200},children:e.system_message?(0,a.jsx)(eT.Z,{value:e.system_message,content:(0,a.jsx)(eb.o,{maxHeight:80,showLabel:"显示更多",hideLabel:"隐藏",children:e.system_message}),width:300}):null}),(0,a.jsx)("td",{style:{width:300},children:e.prompt_template?(0,a.jsx)(eT.Z,{value:e.prompt_template,content:e.prompt_template,width:300}):null}),(0,a.jsx)("td",{children:e.token?(0,a.jsx)(eT.Z,{value:e.token,content:e.token,truncate:!0,width:160}):(0,a.jsx)(b.z,{color:"lime",size:"xs",compact:!0,onClick:()=>generateToken(e.id),children:"生成访问令牌"})}),(0,a.jsx)("td",{children:(0,eC.o0)(e.created)}),(0,a.jsxs)("td",{style:{width:220},children:[e.token?(0,a.jsx)(b.z,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{o(!0);let r=await (0,eL.IV)(e.id);i(r),d(!0)},mr:4,children:"问答测试"}):(0,a.jsx)(ej.u,{label:"需要成访问令牌才可以访问此能力",children:(0,a.jsx)(b.z,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),(0,a.jsx)(b.z,{variant:"filled",size:"xs",onClick:async()=>{o(!0);let r=await (0,eL.IV)(e.id);i(r),c(!0)},mr:4,children:"编辑"}),(0,a.jsx)(b.z,{variant:"filled",color:"red",size:"xs",onClick:()=>{removeKnowledgeBase(e)},children:"删除"})]})]},e.id)),getKonwledgeBase=async()=>{l(!0);try{await (0,eL.Co)(r)}catch(e){console.log(e)}l(!1)};return(0,n.useEffect)(()=>{getKonwledgeBase()},[r]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ChatDrawer,{appId:r}),(0,a.jsxs)(ew.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"编号"}),(0,a.jsx)("th",{children:"名称"}),(0,a.jsx)("th",{children:"描述"}),(0,a.jsx)("th",{children:"系统提示词"}),(0,a.jsx)("th",{children:"完整提示词"}),(0,a.jsx)("th",{children:"访问token"}),(0,a.jsx)("th",{children:"创建时间"}),(0,a.jsx)("th",{children:"操作"})]})}),(0,a.jsx)("tbody",{children:p})]})]})}function KnowledgeBasePage(e){let{appId:r}=e,t=(0,eL.I1)().loading,l=[{title:"应用列表",href:"/app"},{title:"智能体",href:"/app/".concat(r,"/knowledgeBase")}].map((e,r)=>(0,a.jsx)(ev.e,{href:e.href,children:e.title},r)),i=(0,eL.I1)().setOpen,n=(0,eL.I1)().setEditStatus;return(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)(ek.f,{visible:t,overlayOpacity:.3}),(0,a.jsx)(eI.O,{children:l}),(0,a.jsx)(eR.Z,{title:"领域知识智能体",description:"领域知识智能体专注于传授知识，利用LLM对自然语言进行认知，结合RAG(Retrieval-Augmented Generation 检索增强生成)技术来将领域的信息进行有效的整合，然后通过图片，视频，可交互组件完成知识交付，"}),(0,a.jsx)(h.x,{children:(0,a.jsx)(b.z,{onClick:()=>{n(!1),i(!0)},children:"新建领域知识智能体"})}),(0,a.jsx)(AddOrUpdate,{appId:r}),(0,a.jsx)(List,{appId:r})]})}(l=i||(i={}))[l.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",l[l.CHAT=2]="CHAT";var e$=!0;function IndexPage(e){let{appId:r}=e;return(0,a.jsx)(KnowledgeBasePage,{appId:r})}}},function(e){e.O(0,[774,797,241,880,871,855,322,754,664,642,194,104,958,888,179],function(){return e(e.s=9049)}),_N_E=e.O()}]);