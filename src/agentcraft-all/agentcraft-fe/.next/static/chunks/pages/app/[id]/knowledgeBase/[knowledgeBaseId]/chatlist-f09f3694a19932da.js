(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[846],{93284:function(e,t,r){"use strict";r.d(t,{O:function(){return g}});var n=r(67294),o=r(3241),a=r(24241),i=(0,r(56817).k)(e=>({root:{display:"flex",alignItems:"center"},breadcrumb:{lineHeight:1,whiteSpace:"nowrap",WebkitTapHighlightColor:"transparent"},separator:{marginLeft:e.spacing.xs,marginRight:e.spacing.xs,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[7],lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center"}})),l=r(95117),s=r(64523),c=Object.defineProperty,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,p=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t||(t={}))u.call(t,r)&&p(e,r,t[r]);if(d)for(var r of d(t))h.call(t,r)&&p(e,r,t[r]);return e},b=(e,t)=>{var r={};for(var n in e)u.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&d)for(var n of d(e))0>t.indexOf(n)&&h.call(e,n)&&(r[n]=e[n]);return r};let y={separator:"/"},g=(0,n.forwardRef)((e,t)=>{let r=(0,o.N4)("Breadcrumbs",y,e),{className:c,children:d,separator:u,classNames:h,styles:p,unstyled:g,variant:m}=r,j=b(r,["className","children","separator","classNames","styles","unstyled","variant"]),{classes:v,cx:x}=i(null,{classNames:h,styles:p,unstyled:g,name:"Breadcrumbs",variant:m}),w=n.Children.toArray(d).reduce((e,t,r,o)=>{var i;let s=(0,a.k)(t)?n.cloneElement(t,{className:x(v.breadcrumb,null==(i=t.props)?void 0:i.className),key:r}):n.createElement("div",{className:v.breadcrumb,key:r},t);return e.push(s),r!==o.length-1&&e.push(n.createElement(l.x,{size:"sm",className:v.separator,key:`separator-${r}`},u)),e},[]);return n.createElement(s.x,f({className:x(v.root,c),ref:t},j),w)});g.displayName="@mantine/core/Breadcrumbs"},95078:function(e,t,r){"use strict";r.d(t,{i:function(){return P}});var n=r(67294),o=r(3241),a=r(56817),i=r(96768),l=r(14258),s=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,f=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))h.call(t,r)&&f(e,r,t[r]);if(u)for(var r of u(t))p.call(t,r)&&f(e,r,t[r]);return e},y=(e,t)=>c(e,d(t)),g=(0,a.k)((e,{captionSide:t,horizontalSpacing:r,verticalSpacing:n,fontSize:o,withBorder:a,withColumnBorders:s})=>{let c=`${(0,i.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:y(b({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:a?c:void 0,"& caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& thead tr th, & tfoot tr th, & tbody tr th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,l.a)({size:o,sizes:e.fontSizes}),padding:`${(0,l.a)({size:n,sizes:e.spacing})} ${(0,l.a)({size:r,sizes:e.spacing})}`},"& thead tr th":{borderBottom:c},"& tfoot tr th, & tbody tr th":{borderTop:c},"& tbody tr td":{padding:`${(0,l.a)({size:n,sizes:e.spacing})} ${(0,l.a)({size:r,sizes:e.spacing})}`,borderTop:c,fontSize:(0,l.a)({size:o,sizes:e.fontSizes})},"& tbody tr:first-of-type td, & tbody tr:first-of-type th":{borderTop:"none"},"& thead th, & tbody td":{borderRight:s?c:"none","&:last-of-type":{borderRight:"none",borderLeft:s?c:"none"}},"& tbody tr th":{borderRight:s?c:"none"},"&[data-striped] tbody tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] tbody tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),m=r(64523),j=Object.defineProperty,v=Object.defineProperties,x=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,S=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t)=>{for(var r in t||(t={}))O.call(t,r)&&S(e,r,t[r]);if(w)for(var r of w(t))k.call(t,r)&&S(e,r,t[r]);return e},E=(e,t)=>v(e,x(t)),N=(e,t)=>{var r={};for(var n in e)O.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&w)for(var n of w(e))0>t.indexOf(n)&&k.call(e,n)&&(r[n]=e[n]);return r};let C={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},P=(0,n.forwardRef)((e,t)=>{let r=(0,o.N4)("Table",C,e),{className:a,children:i,striped:l,highlightOnHover:s,captionSide:c,horizontalSpacing:d,verticalSpacing:u,fontSize:h,unstyled:p,withBorder:f,withColumnBorders:b,variant:y}=r,j=N(r,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:v,cx:x}=g({captionSide:c,verticalSpacing:u,horizontalSpacing:d,fontSize:h,withBorder:f,withColumnBorders:b},{unstyled:p,name:"Table",variant:y});return n.createElement(m.x,E(z({},j),{component:"table",ref:t,className:x(v.root,a),"data-striped":l||void 0,"data-hover":s||void 0}),i)});P.displayName="@mantine/core/Table"},28792:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase/[knowledgeBaseId]/chatlist",function(){return r(18650)}])},3658:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(85893),o=r(92716),a=r(95117),i=r(64523),l=r(69876),s=r(19236),c=r(91759);function d(e){let{detail:t,title:r}=e,[i,{open:l,close:s}]=(0,c.q)(!1);return(0,n.jsx)(n.Fragment,{children:t?(0,n.jsxs)("div",{children:[(0,n.jsx)(o.d,{opened:i,onClose:s,title:r,children:(0,n.jsx)(a.x,{children:t})}),(0,n.jsx)(a.x,{onClick:()=>l(),children:"信息"})]}):null})}function u(e){let{title:t,description:r,detail:o,mt:c,mb:u}=e;return(0,n.jsxs)(i.x,{mt:c||24,mb:u||24,children:[(0,n.jsxs)(l.k,{mih:20,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,n.jsx)(s.D,{order:2,children:t}),(0,n.jsx)(d,{title:t,detail:o})]}),r?(0,n.jsx)(a.x,{lineClamp:4,children:r}):null]})}},18650:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return y},default:function(){return g}});var n=r(85893),o=r(67294),a=r(67841),i=r(64523),l=r(49737),s=r(95078),c=r(54685),d=r(93284),u=r(79629),h=r(98597),p=r(3658);function f(e){let{knowledgeBaseId:t}=e,r=(0,u.aK)().chatList,c=(0,u.aK)().loading,d=(0,u.aK)().setLoading,p=(0,u.aK)().setOpen,f=async e=>{d(!0),await (0,u.Ag)(e),d(!1)},b=r.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:100,wordWrap:"break-word"},children:e.question})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:(0,h.pI)(e.answer)})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:e.prompt})}),(0,n.jsx)("td",{children:e.ip}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{style:{width:200,wordWrap:"break-word"},children:JSON.stringify((0,h.pI)(e.source))})}),(0,n.jsx)("td",{children:e.model_name}),(0,n.jsx)("td",{children:e.created}),(0,n.jsx)("td",{children:(0,n.jsx)(a.z,{onClick:()=>{p(!0)},size:"xs",children:"编辑"})})]},e.id));return(0,o.useEffect)(()=>{f(t)},[t]),(0,n.jsxs)(i.x,{pos:"relative",children:[(0,n.jsx)(l.f,{visible:c,overlayOpacity:.3}),(0,n.jsxs)(s.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"编号"}),(0,n.jsx)("th",{children:"问题"}),(0,n.jsx)("th",{children:"答案"}),(0,n.jsx)("th",{children:"完整提示词"}),(0,n.jsx)("th",{children:"访问IP"}),(0,n.jsx)("th",{children:"知识库结果"}),(0,n.jsx)("th",{children:"使用模型"}),(0,n.jsx)("th",{children:"问答创建时间"}),(0,n.jsx)("th",{children:"操作"})]})}),(0,n.jsx)("tbody",{children:b})]})]})}function b(e){let{appId:t,knowledgeBaseId:r}=e,o=(0,u.aK)().loading,a=[{title:"应用列表",href:"/app"},{title:"知识库",href:"/app/".concat(t,"/knowledgeBase")},{title:"问答记录",href:"/app/".concat(t,"/knowledgeBase/").concat(r,"/chatlist")}].map((e,t)=>(0,n.jsx)(c.e,{href:e.href,children:e.title},t));return(0,n.jsxs)(i.x,{pos:"relative",children:[(0,n.jsx)(l.f,{visible:o,overlayOpacity:.3}),(0,n.jsx)(d.O,{children:a}),(0,n.jsx)(p.Z,{title:"问答记录",description:"您可以在此查看该知识库的问答历史记录"}),(0,n.jsx)(f,{knowledgeBaseId:r})]})}var y=!0;function g(e){let{appId:t,knowledgeBaseId:r}=e;return(0,n.jsx)(b,{appId:t,knowledgeBaseId:r})}},79629:function(e,t,r){"use strict";async function n(e,t){let r;let n=e.getReader();for(;!(r=await n.read()).done;)t(r.value)}function o(){return{data:"",event:"",id:"",retry:void 0}}r.d(t,{dr:function(){return v},Ag:function(){return j},aK:function(){return m}});var a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)0>t.indexOf(n[o])&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r};let i="text/event-stream",l="last-event-id";function s(e){let t=e.headers.get("content-type");if(!(null==t?void 0:t.startsWith(i)))throw Error(`Expected content-type to be ${i}, Actual: ${t}`)}var c={Error:{Unauthorized:"无权限"}};let d={cn:c},u=Object.keys(d),h=d[function(){let e=function(e){try{return localStorage.getItem(e)}catch(e){return null}}("lang");if(u.includes(null!=e?e:""))return e;let t=function(){try{return navigator.language.toLowerCase()}catch(e){return"cn"}}();for(let e of u)if(t.includes(e))return e;return"cn"}()];!function e(t,r){Object.keys(r).forEach(function(n){if(r[n]&&"object"==typeof r[n]){e(t[n]=t[n]||{},r[n]);return}t[n]=r[n]})}(c,h);var p=r(64529),f=r(61407),b=r(98597),y=r(782),g=r(71791);let m=(0,p.Ue)()((0,y.mW)(e=>({chatList:[],open:!1,loading:!1,isEdit:!1,currentChatItem:{},updateCurrentChatItem:t=>e(e=>({currentChatItem:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateChatList:t=>e(e=>({chatList:t}))})));async function j(e){let t=m.getState(),r=t.updateChatList,n=await (0,g.W)("/api/chat/chatlist?id=".concat(e)),o=n.data;o&&r(o)}async function v(e,t){var r;let d=new AbortController;null===(r=e.onController)||void 0===r||r.call(e,d);let u=await {method:"POST",headers:{"Content-Type":"application/json"},signal:d.signal,body:JSON.stringify(Object.assign({},e,{token:t}))},h=setTimeout(()=>d.abort(),f.tb),p="",y=!1,g=()=>{y||(e.onFinish(p),y=!0)};d.signal.onabort=g,function(e,t){var{signal:r,headers:c,onopen:d,onmessage:u,onclose:h,onerror:p,openWhenHidden:f,fetch:b}=t,y=a(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);new Promise((t,a)=>{let g;let m=Object.assign({},c);function j(){g.abort(),document.hidden||S()}m.accept||(m.accept=i),"undefined"==typeof document||f||document.addEventListener("visibilitychange",j);let v=1e3,x=0;function w(){"undefined"==typeof document||f||document.removeEventListener("visibilitychange",j),clearTimeout(x),g.abort()}null==r||r.addEventListener("abort",()=>{w(),t()});let O=null!=b?b:fetch,k=null!=d?d:s;async function S(){var r,i;g=new AbortController;try{let r,a,s,c;let d=await O(e,Object.assign(Object.assign({},y),{headers:m,signal:g.signal}));await k(d),await n(d.body,(i=function(e,t,r){let n=o(),a=new TextDecoder;return function(i,l){if(0===i.length)null==e||e(n),n=o();else if(l>0){let e=a.decode(i.subarray(0,l)),o=l+(32===i[l+1]?2:1),s=a.decode(i.subarray(o));switch(e){case"data":n.data=n.data?n.data+"\n"+s:s;break;case"event":n.event=s;break;case"id":null==t||t(n.id=s);break;case"retry":let c=parseInt(s,10);isNaN(c)||null==r||r(n.retry=c)}}}}(u,e=>{e?m[l]=e:delete m[l]},e=>{v=e}),c=!1,function(e){void 0===r?(r=e,a=0,s=-1):r=function(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(r,e);let t=r.length,n=0;for(;a<t;){c&&(10===r[a]&&(n=++a),c=!1);let e=-1;for(;a<t&&-1===e;++a)switch(r[a]){case 58:-1===s&&(s=a-n);break;case 13:c=!0;case 10:e=a}if(-1===e)break;i(r.subarray(n,e),s),n=a,s=-1}n===t?r=void 0:0!==n&&(r=r.subarray(n),a-=n)})),null==h||h(),w(),t()}catch(e){if(!g.signal.aborted)try{let t=null!==(r=null==p?void 0:p(e))&&void 0!==r?r:v;clearTimeout(x),x=setTimeout(S,t)}catch(e){w(),a(e)}}}S()})}("/api/chat",{...u,async onopen(e){var t;clearTimeout(h);let r=e.headers.get("content-type");if(console.log("AgentCraft request response content type: ",r),null==r?void 0:r.startsWith("text/plain"))return p=await e.clone().text(),g();if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.startsWith(i))||200!==e.status){let t=[p],r=await e.clone().text();try{let t=await e.clone().json();r=(0,b.Bs)(t)}catch(e){}return 401===e.status&&t.push(c.Error.Unauthorized),r&&t.push(r),p=t.join("\n\n"),g()}},onmessage(t){if("[DONE]"===t.data||y)return g();let r=t.data;try{let t=JSON.parse(r),o=t.choices[0].delta.content;if(o){var n;p+=o,null===(n=e.onUpdate)||void 0===n||n.call(e,p,o)}}catch(e){console.error("[Request] parse error",r,t)}},onclose(){g()},onerror(t){var r;throw null===(r=e.onError)||void 0===r||r.call(e,t),t},openWhenHidden:!0})}},98597:function(e,t,r){"use strict";function n(e){let t=e;try{t=JSON.parse(e)}catch(e){console.error("Invalid URI sequence",e)}return t}function o(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}r.d(t,{Bs:function(){return o},pI:function(){return n}})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=28792)}),_N_E=e.O()}]);