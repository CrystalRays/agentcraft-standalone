(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{88301:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase/[knowledgeBaseId]/detail",function(){return i(11674)}])},3658:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var s=i(85893),n=i(92716),a=i(95117),l=i(64523),r=i(69876),o=i(19236),d=i(91759);function c(e){let{detail:t,title:i}=e,[l,{open:r,close:o}]=(0,d.q)(!1);return(0,s.jsx)(s.Fragment,{children:t?(0,s.jsxs)("div",{children:[(0,s.jsx)(n.d,{opened:l,onClose:o,title:i,children:(0,s.jsx)(a.x,{children:t})}),(0,s.jsx)(a.x,{onClick:()=>r(),children:"信息"})]}):null})}function p(e){let{title:t,description:i,detail:n,mt:d,mb:p}=e;return(0,s.jsxs)(l.x,{mt:d||24,mb:p||24,children:[(0,s.jsxs)(r.k,{mih:20,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,s.jsx)(o.D,{order:2,children:t}),(0,s.jsx)(c,{title:t,detail:n})]}),i?(0,s.jsx)(a.x,{lineClamp:4,children:i}):null]})}},11674:function(e,t,i){"use strict";i.r(t),i.d(t,{__N_SSP:function(){return L},default:function(){return O}});var s,n,a=i(85893),l=i(67294),r=i(19236),o=i(82623),d=i(64523),c=i(80061),p=i(52615),u=i(54777),h=i(71232),x=i(31194),m=i(28855),_=i(14127),y=i(67841),j=i(54685),f=i(49737),w=i(93284),g=i(69876),v=i(77248),k=i(24350),I=i(85417),b=i(77194),T=i(53483),P=i(61407),z=i(3658);function C(e){let{appId:t,containerType:i}=e;(0,T.s6)().setOpen;let s=(0,T.s6)().currentKnowledgeBase,j=(0,T.s6)().setLoading,f=(0,k.s6)().modelList,w=(0,I.s6)().dataSetList,g=(0,v.c)({initialValues:{name:"",description:"",prompt_template:"已知信息：【{context}】。你需要积极，简洁和专业地来回答```中的问题。如果问题和已知信息没有关系，或者问题存在争议性，请说 “抱歉，无法回答该问题”，不允许编造。问题是：```{query}```",app_id:parseInt(t),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:"",exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"知识库名必填"}});(0,l.useEffect)(()=>{(0,k.fZ)(),(0,I.ln)();let e=null==s?void 0:s.datasets;g.setValues({id:null==s?void 0:s.id,name:null==s?void 0:s.name,description:null==s?void 0:s.description,prompt_template:null==s?void 0:s.prompt_template,app_id:null==s?void 0:s.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===b.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===b.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==s?void 0:s.exact_search_limit,fuzzy_search_similarity:null==s?void 0:s.fuzzy_search_similarity,temperature:null==s?void 0:s.temperature,top_p:null==s?void 0:s.top_p,n_sequences:null==s?void 0:s.n_sequences,max_tokens:null==s?void 0:s.max_tokens,stop:null==s?void 0:s.stop,presence_penalty:null==s?void 0:s.presence_penalty,frequency_penalty:null==s?void 0:s.frequency_penalty,logit_bias:null==s?void 0:s.logit_bias,model_id:null==s?void 0:s.model_id,redis_ip_ex:null==s?void 0:s.redis_ip_ex,redis_history_ex:null==s?void 0:s.redis_history_ex,model_ip_limit:null==s?void 0:s.model_ip_limit,llm_history_len:null==s?void 0:s.llm_history_len,system_message:null==s?void 0:s.system_message,exact_search_limit:null==s?void 0:s.exact_search_limit,fuzzy_search_limit:null==s?void 0:s.fuzzy_search_limit})},[s]);let z=f.map(e=>({label:e.name,value:e.id})),C=w.filter(e=>e.dataset_type==b.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),A=w.filter(e=>e.dataset_type==b.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{width:"33%"},children:[i!==n.CHAT?(0,a.jsx)(r.D,{order:4,mb:8,children:"基础设置"}):null,(0,a.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,children:[i!==n.CHAT?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.D,{order:5,size:"h5",children:"知识库"}),(0,a.jsxs)(d.x,{maw:P.cy,pl:4,pr:4,children:[(0,a.jsx)(c.o,{withAsterisk:!0,label:"名称",placeholder:"输入知识库名称",...g.getInputProps("name")}),(0,a.jsx)(p.g,{label:"描述",placeholder:"输入应用描述",...g.getInputProps("description")})]}),(0,a.jsx)(u.i,{my:"sm"})]}):null,(0,a.jsx)(r.D,{order:5,size:"h5",children:"提示词"}),(0,a.jsxs)(d.x,{maw:P.cy,pl:4,pr:4,children:[(0,a.jsx)(p.g,{label:"系统提示词",placeholder:"输入系统提示词",...g.getInputProps("system_message"),description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),(0,a.jsx)(p.g,{withAsterisk:!0,label:"提示词模板",placeholder:"",...g.getInputProps("prompt_template"),minRows:6,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),(0,a.jsx)(u.i,{my:"sm"}),(0,a.jsx)(r.D,{order:5,size:"h5",children:"数据集"}),(0,a.jsx)(d.x,{maw:P.cy,pl:4,pr:4,children:(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(x.NU,{data:C,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...g.getInputProps("fuzzy_datasets")}),(0,a.jsx)(x.NU,{data:A,description:"问答数据集用来做问题精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...g.getInputProps("exact_datasets")})]})}),(0,a.jsx)(u.i,{my:"sm"}),(0,a.jsx)(r.D,{order:5,size:"h5",children:"模型"}),(0,a.jsx)(d.x,{maw:P.cy,pl:4,pr:4,mb:12,children:(0,a.jsx)(m.Ph,{withAsterisk:!0,data:z,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...g.getInputProps("model_id")})}),(0,a.jsx)(u.i,{my:"sm"})]})]}),(0,a.jsxs)("div",{style:{width:"33%"},children:[i!==n.CHAT?(0,a.jsx)(r.D,{order:4,mb:8,children:"高级设置"}):null,(0,a.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,a.jsx)(r.D,{order:5,size:"h5",children:"答案召回"}),(0,a.jsxs)(d.x,{maw:P.cy,pl:4,pr:4,children:[(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(c.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...g.getInputProps("fuzzy_search_similarity")}),(0,a.jsx)(c.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...g.getInputProps("exact_search_similarity")})]}),(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(_.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...g.getInputProps("fuzzy_search_limit")}),(0,a.jsx)(_.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...g.getInputProps("exact_search_limit")})]})]}),(0,a.jsx)(u.i,{my:"sm"}),(0,a.jsx)(r.D,{order:5,size:"h5",children:"大语言模型参数"}),(0,a.jsxs)(d.x,{maw:P.cy,pl:4,pr:4,children:[(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(c.o,{withAsterisk:!0,label:"temperature",placeholder:"",...g.getInputProps("temperature")}),(0,a.jsx)(c.o,{withAsterisk:!0,label:"top_p",placeholder:"",...g.getInputProps("top_p")})]}),(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(c.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...g.getInputProps("n_sequences")}),(0,a.jsx)(c.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...g.getInputProps("max_tokens")})]}),(0,a.jsxs)(h.Z,{grow:!0,children:[(0,a.jsx)(c.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...g.getInputProps("presence_penalty")}),(0,a.jsx)(c.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...g.getInputProps("frequency_penalty")})]}),(0,a.jsx)(c.o,{label:"logit_bias",placeholder:"",...g.getInputProps("logit_bias"),width:"50%"})]}),(0,a.jsx)(u.i,{my:"sm"})]}),(0,a.jsx)(d.x,{maw:P.cy,pt:24,style:{textAlign:"center",width:"100%"},children:(0,a.jsx)(y.z,{style:{width:"100%"},onClick:async()=>{if(g.validate(),g.isValid()){j(!0);let e=g.values;await (0,T.CH)(e.id,e),j(!1)}},children:"确认修改"})})]})]})}function A(){let e=(0,T.s6)().currentKnowledgeBase;return(0,a.jsxs)("div",{style:{width:"33%"},children:[(0,a.jsx)(r.D,{order:4,mb:8,children:"访问接入"}),(0,a.jsxs)(o.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,a.jsx)(r.D,{order:5,size:"h5",children:"API访问"}),(0,a.jsxs)(d.x,{maw:P.cy,pl:4,pr:4,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"API访问地址："}),(0,a.jsx)("span",{})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{style:{wordBreak:"break-all"},children:["API访问token：",null==e?void 0:e.token]}),(0,a.jsx)("span",{})]})]}),(0,a.jsx)(u.i,{my:"sm"}),(0,a.jsx)(r.D,{order:5,size:"h5",children:"API调用示例"}),(0,a.jsx)(d.x,{maw:P.cy,pl:4,pr:4}),(0,a.jsx)(u.i,{my:"sm"}),(0,a.jsx)(r.D,{order:5,size:"h5",children:"效果测试"}),(0,a.jsx)(d.x,{maw:P.cy,pl:4,pr:4,children:(0,a.jsx)(h.Z,{grow:!0})})]})]})}function E(e){let{appId:t,knowledgeBaseId:i}=e,s=(0,T.s6)().loading,n=(0,T.s6)().updateCurrentKnowledgeBase,r=[{title:"应用列表",href:"/app"},{title:"知识库",href:"/app/".concat(t,"/knowledgeBase")},{title:"知识库详细",href:"/app/".concat(t,"/knowledgeBase/").concat(i,"/detail")}].map((e,t)=>(0,a.jsx)(j.e,{href:e.href,children:e.title},t));return(0,l.useEffect)(()=>{(async()=>{let e=await (0,T.IV)(i);n(e)})()},[i]),(0,a.jsxs)(d.x,{pos:"relative",children:[(0,a.jsx)(f.f,{visible:s,overlayOpacity:.3}),(0,a.jsx)(w.O,{children:r}),(0,a.jsx)(z.Z,{title:"知识库详情",description:"您可以查看修改知识库内容，以及查看API调用"}),(0,a.jsxs)(g.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[(0,a.jsx)(A,{}),(0,a.jsx)(C,{appId:t})]})]})}(s=n||(n={}))[s.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",s[s.CHAT=2]="CHAT";var L=!0;function O(e){let{appId:t,knowledgeBaseId:i}=e;return(0,a.jsx)(E,{appId:t,knowledgeBaseId:i})}},85417:function(e,t,i){"use strict";i.d(t,{cv:function(){return d},ln:function(){return r},s6:function(){return l},uo:function(){return o}});var s=i(64529),n=i(782),a=i(71791);let l=(0,s.Ue)()((0,n.mW)(e=>({dataSetList:[],open:!1,loading:!1,updateDataSetList:t=>e(e=>({dataSetList:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t}))})));async function r(){let e=l.getState(),t=e.updateDataSetList,i=await (0,a.W)("/api/dataset/list"),s=i.data;s&&t(s)}async function o(e){return await (0,a.W)("/api/dataset/delete?id=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function d(e){return await (0,a.W)("/api/dataset/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}},53483:function(e,t,i){"use strict";i.d(t,{CH:function(){return c},Co:function(){return r},IV:function(){return o},g$:function(){return p},s6:function(){return l},uA:function(){return d}});var s=i(64529),n=i(782),a=i(71791);let l=(0,s.Ue)()((0,n.mW)(e=>({knowledgeBaseList:[],knowledgeBaseChatList:[],open:!1,loading:!1,isEdit:!1,updateCurrentKnowledgeBase:t=>e(e=>({currentKnowledgeBase:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateKnowledgeBaseList:t=>e(e=>({knowledgeBaseList:t}))})));async function r(e){let t=l.getState(),i=t.updateKnowledgeBaseList,s=await (0,a.W)("/api/knowledgeBase/list?appId=".concat(e)),n=s.data;n&&i(n)}async function o(e){let t=await (0,a.W)("/api/knowledgeBase/get?id=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});return t.data}async function d(e){return await (0,a.W)("/api/knowledgeBase/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function c(e,t){return await (0,a.W)("/api/knowledgeBase/update?id=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}async function p(e){return await (0,a.W)("/api/knowledgeBase/token?agentId=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}})}},24350:function(e,t,i){"use strict";i.d(t,{$s:function(){return o},QB:function(){return c},fZ:function(){return r},mS:function(){return d},s6:function(){return l}});var s=i(64529),n=i(782),a=i(71791);let l=(0,s.Ue)()((0,n.mW)(e=>({modelList:[],loading:!1,open:!1,isEdit:!1,updateCurrentModel:t=>e(e=>({currentModel:t})),setEditStatus:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),updateModelList:t=>e(e=>({modelList:t}))})));async function r(){let e=l.getState(),t=e.updateModelList,i=await (0,a.W)("/api/model/list"),s=await i.data;s&&t(s)}async function o(e){return await (0,a.W)("/api/model/delete?id=".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function d(e){return await (0,a.W)("/api/model/create",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function c(e,t){return await (0,a.W)("/api/model/update?id=".concat(e),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}},77194:function(e,t,i){"use strict";var s,n;i.d(t,{I:function(){return s}}),(n=s||(s={}))[n.QUESTION=1]="QUESTION",n[n.DOCUMENT=2]="DOCUMENT"}},function(e){e.O(0,[121,586,871,946,855,194,774,888,179],function(){return e(e.s=88301)}),_N_E=e.O()}]);