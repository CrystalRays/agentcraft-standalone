(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{95078:function(e,t,r){"use strict";r.d(t,{i:function(){return v}});var s=r(67294),i=r(3241),l=r(56817),o=r(96768),a=r(14258),n=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))h.call(t,r)&&__defNormalProp(e,r,t[r]);if(p)for(var r of p(t))m.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>d(e,c(t)),x=(0,l.k)((e,{captionSide:t,horizontalSpacing:r,verticalSpacing:s,fontSize:i,withBorder:l,withColumnBorders:n})=>{let d=`${(0,o.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:__spreadProps(__spreadValues({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:l?d:void 0,"& caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& thead tr th, & tfoot tr th, & tbody tr th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,a.a)({size:i,sizes:e.fontSizes}),padding:`${(0,a.a)({size:s,sizes:e.spacing})} ${(0,a.a)({size:r,sizes:e.spacing})}`},"& thead tr th":{borderBottom:d},"& tfoot tr th, & tbody tr th":{borderTop:d},"& tbody tr td":{padding:`${(0,a.a)({size:s,sizes:e.spacing})} ${(0,a.a)({size:r,sizes:e.spacing})}`,borderTop:d,fontSize:(0,a.a)({size:i,sizes:e.fontSizes})},"& tbody tr:first-of-type td, & tbody tr:first-of-type th":{borderTop:"none"},"& thead th, & tbody td":{borderRight:n?d:"none","&:last-of-type":{borderRight:"none",borderLeft:n?d:"none"}},"& tbody tr th":{borderRight:n?d:"none"},"&[data-striped] tbody tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] tbody tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),_=r(64523),u=Object.defineProperty,y=Object.defineProperties,j=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,Table_defNormalProp=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Table_spreadValues=(e,t)=>{for(var r in t||(t={}))f.call(t,r)&&Table_defNormalProp(e,r,t[r]);if(g)for(var r of g(t))w.call(t,r)&&Table_defNormalProp(e,r,t[r]);return e},Table_spreadProps=(e,t)=>y(e,j(t)),__objRest=(e,t)=>{var r={};for(var s in e)f.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&g)for(var s of g(e))0>t.indexOf(s)&&w.call(e,s)&&(r[s]=e[s]);return r};let b={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},v=(0,s.forwardRef)((e,t)=>{let r=(0,i.N4)("Table",b,e),{className:l,children:o,striped:a,highlightOnHover:n,captionSide:d,horizontalSpacing:c,verticalSpacing:p,fontSize:h,unstyled:m,withBorder:u,withColumnBorders:y,variant:j}=r,g=__objRest(r,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:f,cx:w}=x({captionSide:d,verticalSpacing:p,horizontalSpacing:c,fontSize:h,withBorder:u,withColumnBorders:y},{unstyled:m,name:"Table",variant:j});return s.createElement(_.x,Table_spreadProps(Table_spreadValues({},g),{component:"table",ref:t,className:w(f.root,l),"data-striped":a||void 0,"data-hover":n||void 0}),o)});v.displayName="@mantine/core/Table"},9049:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/[id]/knowledgeBase",function(){return r(21551)}])},21551:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return q},default:function(){return IndexPage}});var s,i,l=r(85893),o=r(67294),a=r(41664),n=r.n(a),d=r(69876),c=r(19236),p=r(82623),h=r(64523),m=r(80061),x=r(54777),_=r(52615),u=r(28855),y=r(71232),j=r(31194),g=r(14127),f=r(67841),w=r(94491),b=r(92716),v=r(95117),z=r(17789),k=r(55652),P=r(95078),O=r(54685),I=r(49737),C=r(93284),S=r(77248),T=r(91939),A=r(61494),B=r(25288),D=r(13962),L=r(2394),N=r(29235),E=r(86105),R=r(918),Z=r(79731);function KnowledgeBaseForm(e){let{appId:t,containerType:r}=e,s=(0,N.s6)().setOpen,i=(0,N.s6)().isEdit,a=(0,N.s6)().currentKnowledgeBase,n=(0,N.s6)().setLoading,w=(0,T.s6)().modelList,b=(0,A.s6)().dataSetList,v=(0,S.c)({initialValues:{name:"",description:"",prompt_template:E.Gf,app_id:parseInt(t),exact_datasets:[],fuzzy_datasets:[],exact_search_similarity:.9,fuzzy_search_similarity:.6,temperature:.5,top_p:1,n_sequences:1,max_tokens:1024,stop:[],presence_penalty:0,frequency_penalty:0,logit_bias:"",model_id:"",redis_ip_ex:0,redis_history_ex:0,model_ip_limit:0,llm_history_len:0,system_message:E.cl,exact_search_limit:1,fuzzy_search_limit:3},validate:{name:e=>e?null:"智能体名必填"}});(0,o.useEffect)(()=>{if((0,T.fZ)(),(0,A.ln)(),i){let e=null==a?void 0:a.datasets;v.setValues({id:null==a?void 0:a.id,name:null==a?void 0:a.name,description:null==a?void 0:a.description,prompt_template:null==a?void 0:a.prompt_template,app_id:null==a?void 0:a.app_id,exact_datasets:null==e?void 0:e.filter(e=>e.dataset_type===D.I.QUESTION).map(e=>e.dataset_id),fuzzy_datasets:null==e?void 0:e.filter(e=>e.dataset_type===D.I.DOCUMENT).map(e=>e.dataset_id),exact_search_similarity:null==a?void 0:a.exact_search_limit,fuzzy_search_similarity:null==a?void 0:a.fuzzy_search_similarity,temperature:null==a?void 0:a.temperature,top_p:null==a?void 0:a.top_p,n_sequences:null==a?void 0:a.n_sequences,max_tokens:null==a?void 0:a.max_tokens,stop:null==a?void 0:a.stop,presence_penalty:null==a?void 0:a.presence_penalty,frequency_penalty:null==a?void 0:a.frequency_penalty,logit_bias:null==a?void 0:a.logit_bias,model_id:null==a?void 0:a.model_id,redis_ip_ex:null==a?void 0:a.redis_ip_ex,redis_history_ex:null==a?void 0:a.redis_history_ex,model_ip_limit:null==a?void 0:a.model_ip_limit,llm_history_len:null==a?void 0:a.llm_history_len,system_message:null==a?void 0:a.system_message,exact_search_limit:null==a?void 0:a.exact_search_limit,fuzzy_search_limit:null==a?void 0:a.fuzzy_search_limit})}},[a]);let z=w.map(e=>({label:e.name_alias,value:e.id})),k=b.filter(e=>e.dataset_type==D.I.DOCUMENT).map(e=>({label:e.name,value:e.id})),P=b.filter(e=>e.dataset_type==D.I.QUESTION).map(e=>({label:e.name,value:e.id}));return(0,l.jsxs)(d.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"column",children:[(0,l.jsxs)(d.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"nowrap",children:[(0,l.jsxs)("div",{style:{width:"50%"},children:[2!==r?(0,l.jsx)(c.D,{order:4,mb:8,children:"基础设置"}):null,(0,l.jsxs)(p.X,{shadow:"xs",p:"md",withBorder:!0,children:[2!==r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.D,{order:5,size:"h5",children:"智能体"}),(0,l.jsxs)(h.x,{maw:E.cy,pl:4,pr:4,children:[(0,l.jsx)(m.o,{withAsterisk:!0,label:"名称",placeholder:"输入智能体名称",...v.getInputProps("name")}),(0,l.jsx)(m.o,{label:"描述",placeholder:"输入应用描述",...v.getInputProps("description")})]}),(0,l.jsx)(x.i,{my:"sm"})]}):null,(0,l.jsx)(c.D,{order:5,size:"h5",children:"提示词"}),(0,l.jsxs)(h.x,{maw:E.cy,pl:4,pr:4,children:[(0,l.jsx)(_.g,{label:"系统提示词",placeholder:"输入系统提示词",...v.getInputProps("system_message"),minRows:2!==r?2:8,description:"系统提示词作为第一个输入给大语言模型的文本，往往用来设定角色"}),(0,l.jsx)(_.g,{label:"提示词模板",placeholder:"",...v.getInputProps("prompt_template"),minRows:2!==r?6:8,description:"提示词模板可以将检索的结果context和用户的输入query整合到一起，最后整体输入给大语言模型"})]}),(0,l.jsx)(x.i,{my:"sm"}),(0,l.jsx)(c.D,{order:5,size:"h5",children:"基础模型"}),(0,l.jsx)(h.x,{maw:E.cy,pl:4,pr:4,mb:12,children:(0,l.jsx)(u.Ph,{withAsterisk:!0,data:z,description:"LLM代理是大语言模型的代理服务，通过opneai范式的兼容，可以任意切换不同类型的LLM而不用修改业务代码",label:"LLM代理",placeholder:"",...v.getInputProps("model_id")})}),(0,l.jsx)(x.i,{my:"sm"})]})]}),(0,l.jsxs)("div",{style:{width:"50%"},children:[2!==r?(0,l.jsx)(c.D,{order:4,mb:8,children:"高级设置"}):null,(0,l.jsxs)(p.X,{shadow:"xs",p:"md",withBorder:!0,children:[(0,l.jsx)(c.D,{order:5,size:"h5",children:"数据集"}),(0,l.jsx)(h.x,{maw:E.cy,pl:4,pr:4,children:(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(j.NU,{data:k,description:"文档数据集用来做模型检索",label:"文档数据集",placeholder:"添加模糊数据集",...v.getInputProps("fuzzy_datasets")}),(0,l.jsx)(j.NU,{data:P,description:"问答数据集用来做精确匹配",label:"问答数据集",placeholder:"添加精准数据集",...v.getInputProps("exact_datasets")})]})}),(0,l.jsx)(x.i,{my:"sm"}),(0,l.jsx)(c.D,{order:5,size:"h5",children:"答案召回"}),(0,l.jsxs)(h.x,{maw:E.cy,pl:4,pr:4,mt:4,children:[(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(m.o,{withAsterisk:!0,description:"文档数据检索的精度，取值0-1之间，建议取0.6~0.8",label:"文档结果召回精度",placeholder:"",...v.getInputProps("fuzzy_search_similarity")}),(0,l.jsx)(m.o,{withAsterisk:!0,description:"问答数据检索的精度，取值0-1之间，建议取0.9~1",label:"问答结果召回精度",placeholder:"",...v.getInputProps("exact_search_similarity")})]}),(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(g.Y,{withAsterisk:!0,description:"文档结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"文档结果召回数量",placeholder:"",...v.getInputProps("fuzzy_search_limit")}),(0,l.jsx)(g.Y,{withAsterisk:!0,description:"问答结果的召回数量，数量越多信息越丰富，但是首先于LLM上下文长度，不宜过长",label:"问答结果召回数量",placeholder:"",...v.getInputProps("exact_search_limit")})]})]}),(0,l.jsx)(x.i,{my:"sm"}),(0,l.jsx)(c.D,{order:5,size:"h5",children:"大语言模型参数"}),(0,l.jsxs)(h.x,{maw:E.cy,pl:4,pr:4,mt:4,children:[(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(m.o,{withAsterisk:!0,label:"temperature",placeholder:"",...v.getInputProps("temperature")}),(0,l.jsx)(m.o,{withAsterisk:!0,label:"top_p",placeholder:"",...v.getInputProps("top_p")})]}),(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(m.o,{withAsterisk:!0,label:"n_sequences",placeholder:"",...v.getInputProps("n_sequences")}),(0,l.jsx)(m.o,{withAsterisk:!0,label:"max_tokens",placeholder:"",...v.getInputProps("max_tokens")})]}),(0,l.jsxs)(y.Z,{grow:!0,children:[(0,l.jsx)(m.o,{withAsterisk:!0,label:"presence_penalty",placeholder:"",...v.getInputProps("presence_penalty")}),(0,l.jsx)(m.o,{withAsterisk:!0,label:"frequency_penalty",placeholder:"",...v.getInputProps("frequency_penalty")})]}),(0,l.jsx)(m.o,{label:"logit_bias",placeholder:"",...v.getInputProps("logit_bias"),width:"50%"})]}),(0,l.jsx)(x.i,{my:"sm"})]})]})]}),(0,l.jsx)(h.x,{maw:E.cy,pt:4,style:{textAlign:"center",width:"100%"},children:(0,l.jsx)(f.z,{style:{width:"100%"},onClick:async()=>{if(v.validate(),v.isValid()){n(!0);let e=v.values;i?await (0,N.CH)(e.id,e):await (0,N.uA)(e),await (0,N.Co)(t),s(!1),n(!1)}},children:"确认"})})]})}function AddOrUpdate(e){let{appId:t}=e,r=(0,N.s6)().open,s=(0,N.s6)().setOpen,i=(0,N.s6)().isEdit,o=(0,N.s6)().setEditStatus;return(0,l.jsx)(w.u,{opened:r,onClose:()=>{o(!1),s(!1)},title:i?"编辑智能体":"创建智能体",centered:!0,size:"55%",children:(0,l.jsx)(KnowledgeBaseForm,{appId:t})})}function ChatDrawer(e){let{appId:t}=e,r=(0,N.s6)().chatDrawer,s=(0,N.s6)().setChatDrawer;return(0,l.jsx)(b.d,{opened:r,onClose:()=>{s(!1)},title:(0,l.jsxs)("div",{children:[(0,l.jsx)(v.x,{fz:"xl",children:"智能体调试"}),(0,l.jsx)(v.x,{fz:"sm",children:"您可以通过提示词调整，数据集切换，模型服务，以及切换模型参数来调整智能体问答的效果"})]}),position:"right",size:"90%",overlayProps:{opacity:.5,blur:4},children:(0,l.jsxs)(d.k,{mih:50,direction:"row",children:[(0,l.jsxs)("div",{style:{width:"60%"},children:[(0,l.jsx)("div",{style:{marginBottom:12},children:(0,l.jsx)(z.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体参数设置"})}),(0,l.jsx)(KnowledgeBaseForm,{appId:t,containerType:2})]}),(0,l.jsxs)("div",{style:{marginLeft:12,borderLeft:"1px solid #eee",paddingLeft:8,width:"40%"},children:[(0,l.jsx)("div",{children:(0,l.jsx)(z.C,{color:"orange",size:"lg",radius:"xs",variant:"filled",children:"智能体问答"})}),(0,l.jsx)(Z.Z,{})]})]})})}function List(e){let{appId:t}=e,r=(0,N.s6)().knowledgeBaseList,s=(0,N.s6)().setLoading,i=(0,N.s6)().updateCurrentKnowledgeBase,a=(0,N.s6)().setEditStatus,d=(0,N.s6)().setOpen,c=(0,N.s6)().setChatDrawer,generateToken=async e=>{try{s(!0),await (0,N.g$)(e),await (0,N.Co)(t)}catch(e){console.log(e)}finally{s(!1)}},p=r.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:{width:20},children:e.id}),(0,l.jsx)("td",{style:{width:120},children:(0,l.jsx)(n(),{href:"/app/".concat(t,"/knowledgeBase/").concat(e.id,"/detail"),children:e.name})}),(0,l.jsx)("td",{style:{width:180},children:e.description}),(0,l.jsx)("td",{style:{width:200},children:e.system_message?(0,l.jsx)(R.Z,{value:e.system_message,content:e.system_message,width:300}):null}),(0,l.jsx)("td",{style:{width:300},children:e.prompt_template?(0,l.jsx)(R.Z,{value:e.prompt_template,content:e.prompt_template,width:300}):null}),(0,l.jsx)("td",{children:e.token?(0,l.jsx)(R.Z,{value:e.token,content:e.token,truncate:!0,width:160}):(0,l.jsx)(f.z,{color:"lime",size:"xs",compact:!0,onClick:()=>generateToken(e.id),children:"生成访问令牌"})}),(0,l.jsx)("td",{children:(0,B.o0)(e.created)}),(0,l.jsxs)("td",{children:[e.token?(0,l.jsx)(f.z,{color:"grape",variant:"filled",size:"xs",onClick:async()=>{a(!0);let t=await (0,N.IV)(e.id);i(t),c(!0)},mr:4,children:"问答测试"}):(0,l.jsx)(k.u,{label:"需要成访问令牌才可以访问此能力",children:(0,l.jsx)(f.z,{color:"grape",variant:"filled",size:"xs",mr:4,children:"问答测试"})}),(0,l.jsx)(f.z,{variant:"filled",size:"xs",onClick:async()=>{a(!0);let t=await (0,N.IV)(e.id);i(t),d(!0)},mr:4,children:"编辑"}),(0,l.jsx)(f.z,{variant:"filled",color:"red",size:"xs",onClick:()=>{},children:"删除"})]})]},e.id)),getKonwledgeBase=async()=>{s(!0);try{await (0,N.Co)(t)}catch(e){console.log(e)}s(!1)};return(0,o.useEffect)(()=>{getKonwledgeBase()},[t]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ChatDrawer,{appId:t}),(0,l.jsxs)(P.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"编号"}),(0,l.jsx)("th",{children:"名称"}),(0,l.jsx)("th",{children:"描述"}),(0,l.jsx)("th",{children:"系统提示词"}),(0,l.jsx)("th",{children:"完整提示词"}),(0,l.jsx)("th",{children:"访问token"}),(0,l.jsx)("th",{children:"创建时间"}),(0,l.jsx)("th",{children:"操作"})]})}),(0,l.jsx)("tbody",{children:p})]})]})}function KnowledgeBasePage(e){let{appId:t}=e,r=(0,N.s6)().loading,s=[{title:"应用列表",href:"/app"},{title:"智能体",href:"/app/".concat(t,"/knowledgeBase")}].map((e,t)=>(0,l.jsx)(O.e,{href:e.href,children:e.title},t)),i=(0,N.s6)().setOpen;return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)(I.f,{visible:r,overlayOpacity:.3}),(0,l.jsx)(C.O,{children:s}),(0,l.jsx)(L.Z,{title:"领域知识智能体",description:"领域知识智能体专注于传授知识，利用LLM对自然语言进行认知，结合RAG(Retrieval-Augmented Generation 检索增强生成)技术来将领域的信息进行有效的整合，然后通过图片，视频，可交互组件完成知识交付，"}),(0,l.jsx)(h.x,{children:(0,l.jsx)(f.z,{onClick:()=>i(!0),children:"新建领域知识智能体"})}),(0,l.jsx)(AddOrUpdate,{appId:t}),(0,l.jsx)(List,{appId:t})]})}(s=i||(i={}))[s.ADD_OR_UPDATE=1]="ADD_OR_UPDATE",s[s.CHAT=2]="CHAT";var q=!0;function IndexPage(e){let{appId:t}=e;return(0,l.jsx)(KnowledgeBasePage,{appId:t})}}},function(e){e.O(0,[774,797,772,880,708,871,754,664,855,322,698,194,58,766,888,179],function(){return e(e.s=9049)}),_N_E=e.O()}]);