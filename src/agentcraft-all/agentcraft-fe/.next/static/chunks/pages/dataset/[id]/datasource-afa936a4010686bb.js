(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[650],{41030:function(e,t,r){"use strict";r.d(t,{S:function(){return k}});var a=r(67294),o=r(15851),l=(0,r(56817).k)(()=>({placeholder:{},input:{cursor:"pointer"}})),n=r(66261),i=r(80971),s=r(94151),c=r(3241),d=r(83979),p=r(80665),u=Object.defineProperty,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))f.call(t,r)&&__defNormalProp(e,r,t[r]);if(h)for(var r of h(t))m.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__objRest=(e,t)=>{var r={};for(var a in e)f.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&h)for(var a of h(e))0>t.indexOf(a)&&m.call(e,a)&&(r[a]=e[a]);return r};let y={multiple:!1},g=(0,a.forwardRef)((e,t)=>{let r=(0,c.N4)("FileButton",y,e),{onChange:o,children:l,multiple:n,accept:i,name:s,form:u,resetRef:h,disabled:f,capture:m,inputProps:g}=r,b=__objRest(r,["onChange","children","multiple","accept","name","form","resetRef","disabled","capture","inputProps"]),x=(0,a.useRef)();return(0,d.k)(h,()=>{x.current.value=""}),a.createElement(a.Fragment,null,l(__spreadValues({onClick:()=>{f||x.current.click()}},b)),a.createElement("input",__spreadValues({style:{display:"none"},type:"file",accept:i,multiple:n,onChange:e=>{n?o(Array.from(e.currentTarget.files)):o(e.currentTarget.files[0]||null)},ref:(0,p.Y)(t,x),name:s,form:u,capture:m},g)))});g.displayName="@mantine/core/FileButton";var b=r(95117),x=Object.defineProperty,_=Object.defineProperties,j=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,FileInput_defNormalProp=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,FileInput_spreadValues=(e,t)=>{for(var r in t||(t={}))v.call(t,r)&&FileInput_defNormalProp(e,r,t[r]);if(w)for(var r of w(t))O.call(t,r)&&FileInput_defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>_(e,j(t)),FileInput_objRest=(e,t)=>{var r={};for(var a in e)v.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&w)for(var a of w(e))0>t.indexOf(a)&&O.call(e,a)&&(r[a]=e[a]);return r};let S={size:"sm",valueComponent:({value:e})=>a.createElement(b.x,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},Array.isArray(e)?e.map(e=>e.name).join(", "):null==e?void 0:e.name)},P=(0,a.forwardRef)((e,t)=>{let r=(0,n.k)("FileInput",S,e),{inputProps:c,wrapperProps:d,placeholder:p,value:u,defaultValue:h,onChange:f,multiple:m,accept:y,name:b,form:x,classNames:_,styles:j,unstyled:w,valueComponent:v,rightSection:O,clearable:P,clearButtonProps:k,readOnly:I,capture:N,fileInputProps:C}=r,E=FileInput_objRest(r,["inputProps","wrapperProps","placeholder","value","defaultValue","onChange","multiple","accept","name","form","classNames","styles","unstyled","valueComponent","rightSection","clearable","clearButtonProps","readOnly","capture","fileInputProps"]),z=(0,a.useRef)(),{classes:T,cx:D}=l(null,{name:"FileInput",classNames:_,styles:j,unstyled:w}),[R,F]=(0,o.C)({value:u,defaultValue:h,onChange:f,finalValue:m?[]:null}),U=Array.isArray(R)?0!==R.length:null!==R,V=O||(P&&U&&!I?a.createElement(i.P,__spreadProps(FileInput_spreadValues({},k),{variant:"transparent",onClick:()=>F(m?[]:null),size:c.size,unstyled:w})):null);return(0,a.useEffect)(()=>{(Array.isArray(R)&&0===R.length||null===R)&&z.current()},[R]),a.createElement(s.I.Wrapper,__spreadProps(FileInput_spreadValues({},d),{__staticSelector:"FileInput"}),a.createElement(g,{onChange:F,multiple:m,accept:y,name:b,form:x,resetRef:z,disabled:I,capture:N,inputProps:C},e=>a.createElement(s.I,__spreadProps(FileInput_spreadValues(FileInput_spreadValues(FileInput_spreadValues({multiline:!0},e),c),E),{component:"button",type:"button",ref:t,__staticSelector:"FileInput",rightSection:V,classNames:__spreadProps(FileInput_spreadValues({},_),{input:D(T.input,null==_?void 0:_.input)})}),U?a.createElement(v,{value:R}):a.createElement(s.I.Placeholder,{className:T.placeholder},p))))});P.displayName="@mantine/core/FileInput";let k=P},95033:function(e,t,r){"use strict";r.d(t,{y:function(){return j}});var a=r(67294),o=r(3241),l=r(48427),n=r(95117),i=(0,r(56817).k)((e,{color:t})=>({root:{backgroundColor:e.fn.themeColor(t,"dark"===e.colorScheme?5:2),color:"dark"===e.colorScheme?e.colors.dark[9]:"inherit"}})),s=r(64523),c=Object.defineProperty,d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&__defNormalProp(e,r,t[r]);if(d)for(var r of d(t))u.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__objRest=(e,t)=>{var r={};for(var a in e)p.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&d)for(var a of d(e))0>t.indexOf(a)&&u.call(e,a)&&(r[a]=e[a]);return r};let h={color:"yellow"},f=(0,a.forwardRef)((e,t)=>{let r=(0,o.N4)("Mark",h,e),{color:l,className:n,unstyled:c,variant:d}=r,p=__objRest(r,["color","className","unstyled","variant"]),{classes:u,cx:f}=i({color:l},{unstyled:c,name:"Mark",variant:d});return a.createElement(s.x,__spreadValues({component:"mark",ref:t,className:f(u.root,n)},p))});function escapeRegex(e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}f.displayName="@mantine/core/Mark";var m=Object.defineProperty,y=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,Highlight_defNormalProp=(e,t,r)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Highlight_spreadValues=(e,t)=>{for(var r in t||(t={}))g.call(t,r)&&Highlight_defNormalProp(e,r,t[r]);if(y)for(var r of y(t))b.call(t,r)&&Highlight_defNormalProp(e,r,t[r]);return e},Highlight_objRest=(e,t)=>{var r={};for(var a in e)g.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&y)for(var a of y(e))0>t.indexOf(a)&&b.call(e,a)&&(r[a]=e[a]);return r};let x={highlightColor:"yellow"},_=(0,a.forwardRef)((e,t)=>{let r=(0,o.N4)("Highlight",x,e),{children:l,highlight:i,highlightColor:s,highlightStyles:c,unstyled:d}=r,p=Highlight_objRest(r,["children","highlight","highlightColor","highlightStyles","unstyled"]),u=function(e,t){if(null==t)return[{chunk:e,highlighted:!1}];let r=Array.isArray(t)?t.map(escapeRegex):escapeRegex(t),a=Array.isArray(r)?r.filter(e=>e.trim().length>0).length>0:""!==r.trim();if(!a)return[{chunk:e,highlighted:!1}];let o="string"==typeof r?r.trim():r.filter(e=>0!==e.trim().length).map(e=>e.trim()).join("|"),l=RegExp(`(${o})`,"gi"),n=e.split(l).map(e=>({chunk:e,highlighted:l.test(e)})).filter(({chunk:e})=>e);return n}(l,i);return a.createElement(n.x,Highlight_spreadValues({unstyled:d,ref:t,__staticSelector:"Highlight"},p),u.map(({chunk:e,highlighted:t},r)=>t?a.createElement(f,{unstyled:d,key:r,color:s,sx:c,"data-highlight":e},e):a.createElement("span",{key:r},e)))});_.displayName="@mantine/core/Highlight";let j=(0,l.F)(_)},95078:function(e,t,r){"use strict";r.d(t,{i:function(){return v}});var a=r(67294),o=r(3241),l=r(56817),n=r(96768),i=r(14258),s=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))u.call(t,r)&&__defNormalProp(e,r,t[r]);if(p)for(var r of p(t))h.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>c(e,d(t)),f=(0,l.k)((e,{captionSide:t,horizontalSpacing:r,verticalSpacing:a,fontSize:o,withBorder:l,withColumnBorders:s})=>{let c=`${(0,n.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:__spreadProps(__spreadValues({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:l?c:void 0,"& caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& thead tr th, & tfoot tr th, & tbody tr th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,i.a)({size:o,sizes:e.fontSizes}),padding:`${(0,i.a)({size:a,sizes:e.spacing})} ${(0,i.a)({size:r,sizes:e.spacing})}`},"& thead tr th":{borderBottom:c},"& tfoot tr th, & tbody tr th":{borderTop:c},"& tbody tr td":{padding:`${(0,i.a)({size:a,sizes:e.spacing})} ${(0,i.a)({size:r,sizes:e.spacing})}`,borderTop:c,fontSize:(0,i.a)({size:o,sizes:e.fontSizes})},"& tbody tr:first-of-type td, & tbody tr:first-of-type th":{borderTop:"none"},"& thead th, & tbody td":{borderRight:s?c:"none","&:last-of-type":{borderRight:"none",borderLeft:s?c:"none"}},"& tbody tr th":{borderRight:s?c:"none"},"&[data-striped] tbody tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] tbody tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),m=r(64523),y=Object.defineProperty,g=Object.defineProperties,b=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,Table_defNormalProp=(e,t,r)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Table_spreadValues=(e,t)=>{for(var r in t||(t={}))_.call(t,r)&&Table_defNormalProp(e,r,t[r]);if(x)for(var r of x(t))j.call(t,r)&&Table_defNormalProp(e,r,t[r]);return e},Table_spreadProps=(e,t)=>g(e,b(t)),__objRest=(e,t)=>{var r={};for(var a in e)_.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&x)for(var a of x(e))0>t.indexOf(a)&&j.call(e,a)&&(r[a]=e[a]);return r};let w={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},v=(0,a.forwardRef)((e,t)=>{let r=(0,o.N4)("Table",w,e),{className:l,children:n,striped:i,highlightOnHover:s,captionSide:c,horizontalSpacing:d,verticalSpacing:p,fontSize:u,unstyled:h,withBorder:y,withColumnBorders:g,variant:b}=r,x=__objRest(r,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:_,cx:j}=f({captionSide:c,verticalSpacing:p,horizontalSpacing:d,fontSize:u,withBorder:y,withColumnBorders:g},{unstyled:h,name:"Table",variant:b});return a.createElement(m.x,Table_spreadProps(Table_spreadValues({},x),{component:"table",ref:t,className:j(_.root,l),"data-striped":i||void 0,"data-hover":s||void 0}),n)});v.displayName="@mantine/core/Table"},30904:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var a=(0,r(30853).Z)("upload","IconUpload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]])},90939:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dataset/[id]/datasource",function(){return r(32598)}])},918:function(e,t,r){"use strict";r.d(t,{Z:function(){return CopyToClipboard}});var a=r(85893),o=r(67294),l=r(55652),n=r(69876),i=r(95117),s=r(49834),c=r(88198),d=r(93625),p=r(90589),u=r.n(p);function CopyToClipboard(e){let{value:t,content:r,truncate:p,width:h="auto"}=e,f=function(){let{timeout:e=2e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(null),[a,l]=(0,o.useState)(!1),[n,i]=(0,o.useState)(null),handleCopyResult=t=>{clearTimeout(n),i(setTimeout(()=>l(!1),e)),l(t)};return{copy:e=>{if("clipboard"in navigator)navigator.clipboard.writeText(e).then(()=>handleCopyResult(!0)).catch(e=>r(e));else{let t=document.createElement("textarea");t.value=e,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(e){console.error(e)}finally{t.remove(),handleCopyResult(!0)}}},reset:()=>{l(!1),r(null),clearTimeout(n)},error:t,copied:a}}({timeout:500});return(0,a.jsx)(l.u,{label:f.copied?"已复制":"复制",withArrow:!0,position:"right",children:(0,a.jsxs)(n.k,{onClick:()=>f.copy(t),mih:50,style:{width:h},gap:"xs",justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",children:[r?(0,a.jsx)(i.x,{truncate:p,className:u()["copy-to-clipboard-content"],children:r}):null,(0,a.jsx)(s.A,{color:f.copied?"teal":"gray",children:f.copied?(0,a.jsx)(c.Z,{size:"1rem"}):(0,a.jsx)(d.Z,{size:"1rem"})})]})})}},32598:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return U},default:function(){return IndexPage}});var a=r(85893),o=r(67294),l=r(11163),n=r(64523),i=r(80061),s=r(52615),c=r(14127),d=r(94491),p=r(67841),u=r(41030),h=r(96768),f=r(95117),m=r(95033),y=r(95078),g=r(54685),b=r(93284),x=r(69876),_=r(3241),j=Object.defineProperty,w=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))v.call(t,r)&&__defNormalProp(e,r,t[r]);if(w)for(var r of w(t))O.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__objRest=(e,t)=>{var r={};for(var a in e)v.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&w)for(var a of w(e))0>t.indexOf(a)&&O.call(e,a)&&(r[a]=e[a]);return r};let S={w:0,h:0},P=(0,o.forwardRef)((e,t)=>{let r=(0,_.N4)("Space",S,e),{w:a,h:l}=r,i=__objRest(r,["w","h"]);return o.createElement(n.x,__spreadValues({ref:t,w:a,miw:a,h:l,mih:l},i))});P.displayName="@mantine/core/Space";var k=r(49737),I=r(77248),N=r(73344),C=r(918),E=r(30904),z=(0,r(30853).Z)("file-upload","IconFileUpload",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 11v6",key:"svg-2"}],["path",{d:"M9.5 13.5l2.5 -2.5l2.5 2.5",key:"svg-3"}]]),T=r(15590),D=r(13962),R=r(25288),F=r(86105);function DocumentForm(e){let{form:t}=e;return(0,a.jsxs)(n.x,{maw:F.hE,mx:"auto",children:[(0,a.jsx)(i.o,{withAsterisk:!0,label:"标题",placeholder:"",...t.getInputProps("title")}),(0,a.jsx)(s.g,{withAsterisk:!0,label:"内容",placeholder:"",...t.getInputProps("content")}),(0,a.jsx)(i.o,{label:"来源url",placeholder:"",...t.getInputProps("url")}),(0,a.jsx)(c.Y,{label:"文档切片大小",placeholder:"",...t.getInputProps("chunk_size")})]})}function QuestionForm(e){let{form:t}=e;return(0,a.jsxs)(n.x,{maw:F.hE,mx:"auto",children:[(0,a.jsx)(i.o,{withAsterisk:!0,label:"标题",placeholder:"",...t.getInputProps("title")}),(0,a.jsx)(s.g,{withAsterisk:!0,label:"问题",placeholder:"",...t.getInputProps("question")}),(0,a.jsx)(s.g,{withAsterisk:!0,label:"答案",placeholder:"",...t.getInputProps("answer")}),(0,a.jsx)(i.o,{label:"来源url",placeholder:"",...t.getInputProps("url")})]})}function AddOrUpdate(){let e=(0,l.useRouter)(),t=(0,T.qo)().open,r=(0,T.qo)().setOpen,i=(0,T.qo)().setLoading,s=(0,T.qo)().isEdit,c=(0,T.qo)().setIsEdit,u=(0,T.qo)().currentDataSource,{query:h}=e,f=h.dataSetType,m=h.id,y=(0,I.c)({initialValues:{title:"",content:"",url:"",chunk_size:512,ext:"txt",tag:m},validate:{title:e=>e?null:"标题必填",content:e=>e?null:"内容必填"}}),g=(0,I.c)({initialValues:{title:"",question:"",answer:"",tag:m,url:""},validate:{title:e=>e?null:"标题必填",question:e=>e?null:"问题必填",answer:e=>e?null:"答案必填"}}),b=f==D.I.DOCUMENT?y:g;return(0,o.useEffect)(()=>{s&&(f==D.I.DOCUMENT&&y.setValues({title:u.title,content:u.doc_chunk,url:u.url,chunk_size:u.token_size,ext:"txt",tag:m}),f==D.I.QUESTION&&g.setValues({title:u.title,question:u.question,answer:u.doc_chunk,tag:m,url:u.url}))},[s,u]),(0,a.jsxs)(d.u,{opened:t,onClose:()=>{r(!1),c(!1)},title:s?"编辑数据源":"新增数据源",centered:!0,children:[f==D.I.DOCUMENT?(0,a.jsx)(DocumentForm,{form:y}):(0,a.jsx)(QuestionForm,{form:g}),(0,a.jsx)(n.x,{maw:F.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:(0,a.jsx)(p.z,{onClick:async()=>{if(b.validate(),b.isValid())try{i(!0);let e=b.values;s?await (0,T.oe)({dataSetId:m,dataSetType:f,dataSourceId:u.id},e):await (0,T.J_)({dataSetId:m,dataSetType:f},e),await (0,T.z9)(m,f)}catch(e){console.log(e)}finally{r(!1),i(!1)}},children:"确认"})})]})}function UploadDataSource(){let e=(0,l.useRouter)(),t=(0,T.qo)().openUploadModel,r=(0,T.qo)().setOpenUploadModel,o=(0,T.qo)().setLoading,s=(0,T.qo)().setIsEdit,{query:f}=e,m=f.dataSetType,y=f.id,g=(0,I.c)({initialValues:{title:"",url:"",chunk_size:512,ext:"txt",tag:y},validate:{title:e=>e?null:"标题必填"}});return(0,a.jsxs)(d.u,{opened:t,onClose:()=>{r(!1),s(!1)},title:"上传数据集文档",centered:!0,children:[(0,a.jsx)(u.S,{withAsterisk:!0,accept:".md,.txt,.html,.pdf",name:"file",label:"选择文档",description:"选择本地文件上传，支持 .txt,.md,.html文件",placeholder:"点击上传文档",icon:(0,a.jsx)(E.Z,{size:(0,h.h)(14)}),...g.getInputProps("file")}),(0,a.jsx)(i.o,{withAsterisk:!0,label:"标题",description:"标题内容作为检索的数据来源，用来展示检索结果",placeholder:"",...g.getInputProps("title")}),(0,a.jsx)(c.Y,{withAsterisk:!0,label:"文档切片大小",description:"",placeholder:"",...g.getInputProps("chunk_size")}),(0,a.jsx)(i.o,{label:"来源url",placeholder:"",...g.getInputProps("url")}),(0,a.jsx)(n.x,{maw:F.hE,mx:"auto",pt:12,style:{textAlign:"right"},children:(0,a.jsx)(p.z,{onClick:async()=>{if(g.validate(),g.isValid())try{o(!0);let e=await g.values,t=new FormData;t.append("file",e.file),t.append("title",e.title),t.append("chunk_size",e.chunk_size),t.append("url",e.url),await (0,T.$s)({dataSetId:y},t),await (0,T.z9)(y,m)}catch(e){console.log(e)}finally{r(!1),o(!1)}},children:"确认"})})]})}function List(e){let{dataSetId:t,dataSetType:r}=e,l=(0,T.qo)().dataSourceList,n=(0,T.qo)().setLoading,i=(0,T.qo)().setIsEdit,s=(0,T.qo)().setOpen,c=(0,T.qo)().setCurrentDataSource,removeDataDataSource=e=>{let{id:o,title:l}=e;N.qk.openConfirmModal({title:"删除数据集",centered:!0,children:(0,a.jsx)(f.x,{size:"sm",children:(0,a.jsx)(m.y,{highlight:l,children:"确定删除 ".concat(l,"?")})}),labels:{confirm:"确定",cancel:"取消"},onCancel:()=>console.log("Cancel"),confirmProps:{color:"red"},onConfirm:async()=>{n(!0),await (0,T.xU)({dataSetId:t,dataSetType:r,dataSourceId:o}),await (0,T.z9)(t,r),n(!1)}})},d=l.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{style:{width:80},children:e.id}),(0,a.jsx)("td",{style:{width:240},children:e.title}),(0,a.jsx)("td",{style:{width:140},children:e.url?(0,a.jsx)(C.Z,{value:e.url,content:e.url,truncate:!0,width:120}):null}),r==D.I.QUESTION?(0,a.jsx)("td",{style:{width:120},children:(0,a.jsx)(C.Z,{value:e.question,content:e.question,truncate:!0})}):null,(0,a.jsx)("td",{width:550,children:(0,a.jsx)(C.Z,{value:e.doc_chunk,content:e.doc_chunk,width:550})}),(0,a.jsx)("td",{style:{width:120},children:(0,R.o0)(e.created)}),(0,a.jsx)("td",{style:{width:120},children:(0,R.o0)(e.modified)}),(0,a.jsxs)("td",{style:{width:140},children:[(0,a.jsx)(p.z,{variant:"filled",color:"red",size:"xs",onClick:()=>removeDataDataSource(e),mr:4,children:"删除"}),(0,a.jsx)(p.z,{variant:"filled",size:"xs",onClick:()=>{s(!0),i(!0),c(e)},children:"编辑"})]})]},e.id)),getDatasource=async()=>{n(!0);try{await (0,T.z9)(t,r)}catch(e){}n(!1)};return(0,o.useEffect)(()=>{getDatasource()},[t,r]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["共计",l.length,"条数据"]}),(0,a.jsxs)(y.i,{striped:!0,withBorder:!0,withColumnBorders:!0,mt:12,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"编号"}),(0,a.jsx)("th",{children:"标题"}),(0,a.jsx)("th",{children:"源访问地址"}),r==D.I.QUESTION?(0,a.jsx)("th",{children:"问题"}):null,(0,a.jsx)("th",{children:r==D.I.QUESTION?"答案":"文档内容"}),(0,a.jsx)("th",{children:"创建时间"}),(0,a.jsx)("th",{children:"修改时间"}),(0,a.jsx)("th",{children:"操作"})]})}),(0,a.jsx)("tbody",{children:d})]})]})}function Datasource(){let e=(0,l.useRouter)(),{query:t}=e,r=t.dataSetType,o=t.id,i=[{title:"AgentCraft",href:"/"},{title:"数据集",href:"/dataset"},{title:"数据源",href:"/dataset/".concat(o,"/datasource")}].map((e,t)=>(0,a.jsx)(g.e,{href:e.href,children:e.title},t)),s=(0,T.qo)().loading,c=(0,T.qo)().setOpen,d=(0,T.qo)().setOpenUploadModel;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.O,{children:i}),(0,a.jsx)(n.x,{mt:12,children:(0,a.jsxs)(x.k,{mih:50,gap:"md",justify:"flex-start",align:"flex-start",direction:"row",wrap:"wrap",children:[(0,a.jsx)(p.z,{onClick:()=>c(!0),children:"新建单条数据源"}),(0,a.jsx)(P,{h:"md"}),r==D.I.DOCUMENT?(0,a.jsx)(p.z,{onClick:()=>d(!0),variant:"filled",leftIcon:(0,a.jsx)(z,{size:"1rem"}),children:"上传文件"}):null]})}),(0,a.jsxs)(n.x,{children:[(0,a.jsx)(k.f,{visible:s,overlayOpacity:.3}),(0,a.jsx)(AddOrUpdate,{}),(0,a.jsx)(UploadDataSource,{}),(0,a.jsx)(List,{dataSetId:o,dataSetType:r})]})]})}var U=!0;function IndexPage(){return(0,a.jsx)(Datasource,{})}},15590:function(e,t,r){"use strict";r.d(t,{$s:function(){return addDataSourceByUploadFile},J_:function(){return addDataSource},oe:function(){return updateDataSource},qo:function(){return n},xU:function(){return deleteDataSource},z9:function(){return getDataSourceList}});var a=r(64529),o=r(782),l=r(23824);let n=(0,a.Ue)()((0,o.mW)(e=>({dataSourceList:[],loading:!1,open:!1,isEdit:!1,openUploadModel:!1,currentDataSource:{},setCurrentDataSource:t=>e(e=>({currentDataSource:t})),setIsEdit:t=>e(e=>({isEdit:t})),setLoading:t=>e(e=>({loading:t})),setOpen:t=>e(e=>({open:t})),setOpenUploadModel:t=>e(e=>({openUploadModel:t})),updatedataSourceList:t=>e(e=>({dataSourceList:t}))})));async function getDataSourceList(e,t){let r=n.getState(),a=r.updatedataSourceList,o=await (0,l.W)("/api/dataset/".concat(e,"/datasource/list?dataSetType=").concat(t)),i=o.data;i&&a(i)}async function deleteDataSource(e){let{dataSetId:t,dataSetType:r,dataSourceId:a}=e,o=await (0,l.W)("/api/dataset/".concat(t,"/datasource/delete?dataSetType=").concat(r,"&dataSourceId=").concat(a),{method:"DELETE",headers:{"Content-Type":"application/json"}});await o}async function addDataSource(e,t){let{dataSetId:r,dataSetType:a}=e,o=await (0,l.W)("/api/dataset/".concat(r,"/datasource/create?dataSetType=").concat(a),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});await o}async function updateDataSource(e,t){let{dataSetId:r,dataSetType:a,dataSourceId:o}=e,n=await (0,l.W)("/api/dataset/".concat(r,"/datasource/update?dataSetType=").concat(a,"&dataSourceId=").concat(o),{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});await n}async function addDataSourceByUploadFile(e,t){let{dataSetId:r}=e,a=await (0,l.W)("/api/dataset/".concat(r,"/datasource/upload"),{method:"POST",body:t,headers:{}});await a}},13962:function(e,t,r){"use strict";var a,o;r.d(t,{I:function(){return a}}),(o=a||(a={}))[o.QUESTION=1]="QUESTION",o[o.DOCUMENT=2]="DOCUMENT"},90589:function(e){e.exports={"copy-to-clipboard-content":"CopyToClipboard_copy-to-clipboard-content__cxI0e"}}},function(e){e.O(0,[871,754,322,774,888,179],function(){return e(e.s=90939)}),_N_E=e.O()}]);